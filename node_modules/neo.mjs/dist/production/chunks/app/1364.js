"use strict";(self.webpackChunkneo_mjs=self.webpackChunkneo_mjs||[]).push([[1364],{1364:(e,t,n)=>{n.d(t,{A:()=>u});var i=n(3079),o=n(8754),a=n(9294);const s=/class\s+([a-zA-Z$_][a-zA-Z0-9$_]*)\s*(?:extends\s+[a-zA-Z$_][a-zA-Z0-9$_]*)?\s*{[\s\S]*?}/g,r=/export\s+(?:default\s+)?(?:const|let|var|class|function|async\s+function|generator\s+function|async\s+generator\s+function|(\{[\s\S]*?\}))/g,d=/import\s+([\w-]+)\s+from\s+['"]([^'"]+)['"]/;class l extends i.A{static activeViews=["preview","source"];static config={className:"Neo.code.LivePreview",ntype:"live-preview",activeView_:"source",baseCls:["neo-code-live-preview"],disableRunSource:!1,enableFullscreen:!0,height:400,layout:"fit",items:[{module:a.A,cls:["live-preview-container"],reference:"tab-container",removeInactiveCards:!1,items:[{module:o.A,hideLabel:!0,listeners:{editorChange:"up.onEditorChange"},style:{height:"100%"},reference:"editor",tabButtonConfig:{text:"Source"}},{module:i.A,reference:"preview",tabButtonConfig:{text:"Preview"}}]}],value_:null};previewContainer=null;get tabContainer(){return this.getItem("tab-container")}afterSetActiveView(e,t){this.tabContainer.activeIndex="source"===e?0:1}afterSetValue(e,t){e&&(this.getItem("editor").value=e?.trim())}beforeSetActiveView(e,t){return this.beforeSetEnumValue(e,t,"activeView")}async collapseExpand(e){let t,n=this,i=e.component,o="fas fa-compress"===i.iconCls,{vdom:a}=n;i.iconCls=o?"fas fa-expand":"fas fa-compress",o?(i.iconCls="fas fa-expand",t=n.collapseRect,delete n.collapseRect,Object.assign(a.style,{height:t.height+"px",left:t.x+"px",top:t.y+"px",width:t.width+"px"}),n.update(),await n.timeout(300),Object.assign(a.style,{position:null,zIndex:null})):(i.iconCls="fas fa-compress",t=await n.getDomRect(n.id),n.collapseRect=t,a.style=a.style||{},Object.assign(a.style,{height:t.height+"px",left:t.x+"px",position:"fixed",top:t.y+"px",width:t.width+"px",zIndex:100}),n.update(),await n.timeout(50),Object.assign(a.style,{height:"100%",left:0,top:0,width:"100%"})),n.update()}async createPopupWindow(){let e=this,t=await Neo.Main.getWindowData(),n=await e.getDomRect(e.getReference("preview").id),{height:i,left:o,top:a,width:s}=n;i-=50,o+=t.screenLeft,a+=t.outerHeight-t.innerHeight+t.screenTop,Neo.Main.windowOpen({url:`./childapps/preview/index.html?id=${e.id}`,windowFeatures:`height=${i},left=${o},top=${a},width=${s}`,windowName:e.id})}doRunSource(){if(this.disableRunSource)return;let e=this,t=e.editorValue||e.value,n=[],i=[],o=[],a=e.findLastClassName(t);t.split("\n").forEach((e=>{let t=e.match(d);if(t){let e=t[1],n=t[2];o.push({moduleName:e,path:n}),i.push(e)}else e.match(r)||n.push(`    ${e}`)}));var s=[],l=[];const u=["Promise.all([",`    ${o.map((e=>(s.push(`${e.moduleName}Module`),l.push(`    const ${e.moduleName} = ${e.moduleName}Module.default;`),`import('${e.path}')`))).join(",\n")}`,`]).then(([${s.join(", ")}]) => {`,`${l.join("\n")}`,`    ${n.join("\n")}`,"",`    if (${a} && Neo.component.Base.isPrototypeOf(${a})) {`,`        container.add({module:${a}})`,"    }","})",".catch(error => container.add({ntype:'component', html:error.message}));"].join("\n"),c=e.getPreviewContainer();c.removeAll();try{new Function("container",u)(c)}catch(e){c.add({ntype:"component",html:e.message})}}findLastClassName(e){let t,n=null;for(;null!==(t=s.exec(e));)n=t[1];return n}getPreviewContainer(){let e=this;return e.previewContainer?e.previewContainer:e.getReference("preview")}onActiveIndexChange(e){let t=this,n=t.getReference("collapse-expand-button"),i=1!==e.value;"preview"===e.item.reference&&t.doRunSource(),n&&(n.hidden=i),t.getReference("popout-window-button").hidden=i,t.disableRunSource=!1}onConstructed(){super.onConstructed();let e=this,t=[],{tabContainer:n}=e;e.enableFullscreen&&t.push({handler:e.collapseExpand.bind(e),hidden:1!==n.activeIndex,iconCls:"fas fa-expand",reference:"collapse-expand-button",ui:"ghost"}),t.push({handler:e.popoutPreview.bind(e),hidden:1!==n.activeIndex,iconCls:"far fa-window-maximize",reference:"popout-window-button",ui:"ghost"}),t[0].style={marginLeft:"auto"},n.getTabBar().add(t),n.getTabBar().update(),n.on("activeIndexChange",e.onActiveIndexChange,e),"preview"===e.activeView&&e.doRunSource()}onEditorChange(e){let t=this;t.editorValue=e.value,t.previewContainer&&t.doRunSource()}async popoutPreview(e){let t=this;e.component.disabled=!0,await t.createPopupWindow(),t.getController("viewport-controller")?.connectedApps.push(t.id)}}Neo.setupClass(l);const u=l},8754:(e,t,n)=>{n.d(t,{A:()=>a});var i=n(5608);class o extends i.A{static cursorBlinkings=["blink","expand","phase","smooth","solid"];static delayable={layoutEditor:{type:"buffer",timer:50}};static editorThemes=["hc-black","hc-light","vs","vs-dark"];static config={className:"Neo.component.wrapper.MonacoEditor",ntype:"monaco-editor",baseCls:["neo-monaco-editor"],contextmenu_:!1,cursorBlinking_:"blink",domReadOnly_:!1,editorTheme_:"vs",fontSize_:14,language_:"javascript",minimap_:{enabled:!1},options_:{},readOnly_:!1,scrollBeyondLastLine_:!1,showLineNumbers_:!0,value_:""};construct(e){super.construct(e);let t=this;t.addDomListeners({editorChange:t.onContentChange,resize:t.layoutEditor,scope:t})}afterSetContextmenu(e,t){this.updateOptions({contextmenu:e})}afterSetCursorBlinking(e,t){this.updateOptions({cursorBlinking:e})}afterSetDomReadOnly(e,t){this.updateOptions({domReadOnly:e})}afterSetMounted(e,t){super.afterSetMounted(e,t),e&&setTimeout((()=>{let e=this;Neo.main.addon.MonacoEditor.createInstance(e.getInitialOptions()).then((()=>{e.onEditorMounted?.()}))}),150)}afterSetEditorTheme(e,t){let n=this;n.mounted&&Neo.main.addon.MonacoEditor.setTheme({id:n.id,value:e,windowId:n.windowId})}afterSetFontSize(e,t){this.updateOptions({fontSize:e})}afterSetLanguage(e,t){let n=this;n.mounted&&Neo.main.addon.MonacoEditor.setLanguage({id:n.id,value:e,windowId:n.windowId})}afterSetMinimap(e,t){this.updateOptions({minimap:e})}afterSetOptions(e,t){this.updateOptions(e)}afterSetReadOnly(e,t){this.updateOptions({readOnly:e})}afterSetScrollBeyondLastLine(e,t){this.updateOptions({scrollBeyondLastLine:e})}afterSetShowLineNumbers(e,t){this.updateOptions({lineNumbers:e?"on":"off"})}afterSetValue(e,t){let n=this;n.mounted&&Neo.main.addon.MonacoEditor.setValue({id:n.id,value:n.stringifyValue(n.value),windowId:n.windowId})}beforeSetCursorBlinking(e,t){return this.beforeSetEnumValue(e,t,"cursorBlinking")}beforeSetEditorTheme(e,t){return this.beforeSetEnumValue(e,t,"editorTheme")}destroy(...e){let t=this;t.mounted&&Neo.main.addon.ResizeObserver.unregister({id:t.id,windowId:t.windowId}),Neo.main.addon.MonacoEditor.destroyInstance({id:t.id,windowId:t.windowId}),super.destroy(...e)}async getEditorValue(){return Neo.main.addon.MonacoEditor.getValue({id:this.id,windowId:this.windowId})}getInitialOptions(){let e=this;return{appName:e.appName,contextmenu:e.contextmenu,cursorBlinking:e.cursorBlinking,domReadOnly:e.domReadOnly,id:e.id,fontSize:e.fontSize,language:e.language,lineNumbers:e.showLineNumbers?"on":"off",minimap:e.minimap,readOnly:e.readOnly,scrollBeyondLastLine:e.scrollBeyondLastLine,theme:e.editorTheme,value:e.stringifyValue(e.value),...e.options}}layoutEditor(){let e=this;e.mounted&&Neo.main.addon.MonacoEditor.layoutEditor({id:e.id,windowId:e.windowId})}onContentChange(e){this.fire("editorChange",e)}stringifyValue(e){return Array.isArray(e)&&(e=e.join("\n")),e}updateOptions(e){let t=this;t.mounted&&Neo.main.addon.MonacoEditor.updateOptions({id:t.id,windowId:t.windowId,options:e})}}Neo.setupClass(o);const a=o}}]);