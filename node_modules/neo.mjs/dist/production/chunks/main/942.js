"use strict";(self.webpackChunkneo_mjs=self.webpackChunkneo_mjs||[]).push([[942],{942:(e,t,n)=>{n.r(t),n.d(t,{default:()=>c});var o=n(162),i=n(254),a=n(49),r=n(160);class s extends o.A{static config={className:"Neo.main.addon.Navigator",remote:{app:["subscribe","unsubscribe","navigateTo"]},singleton:!0};subscribe(e){const t=this,n=e.subject=i.A.getElement(e.id),o=e.eventSource=e.eventSource?i.A.getElement(e.eventSource):n;n.$navigator=e,e.activeCls||(e.activeCls="neo-navigator-active-item"),e.findFocusable=t=>a.A.closest(t,(t=>a.A.isFocusable(t)&&n.compcompareDocumentPosition(t)&Node.DOCUMENT_POSITION_CONTAINED_BY&&t.closest(e.selector))),e.treeWalker=document.createTreeWalker(n,NodeFilter.SHOW_ELEMENT,(n=>t.navigateNodeFilter(n,e))),(e.targetMutationMonitor=new MutationObserver((n=>t.navigateTargetChildListChange(n,e)))).observe(n,{childList:!0,subtree:!0}),o.addEventListener("keydown",e.l1=n=>t.navigateKeyDownHandler(n,e)),n.addEventListener("mousedown",e.l2=n=>t.navigateMouseDownHandler(n,e)),n.addEventListener("click",e.l3=n=>t.navigateClickHandler(n,e)),n.addEventListener("focusin",e.l4=n=>t.navigateFocusInHandler(n,e))}unsubscribe(e){const t=i.A.getElement(e.id);e=t?.$navigator,e&&(delete t.$navigator,e.targetMutationMonitor.disconnect(t),e.eventSource.removeEventListener("keydown",e.l1),t.removeEventListener("mousedown",e.l2),t.removeEventListener("click",e.l3),t.removeEventListener("focusin",e.l4))}navigateTargetChildListChange(e,t){if(t.activeItem&&!t.subject.contains(t.activeItem)){const e=t.subject.querySelectorAll(t.selector);e.length&&this.navigateTo(e[Math.max(Math.min(t.activeIndex,e.length-1),0)],t)}}navigateFocusInHandler(e,t){const n=e.target.closest(t.selector);n&&this.setActiveItem(n,t)}navigateClickHandler(e,t){const n=e.target.closest(t.selector);n&&!t.findFocusable(n)&&this.navigateTo(n,t)}navigateMouseDownHandler(e,t){const n=e.target.closest(t.selector);n&&!t.findFocusable(n)&&e.preventDefault()}navigateKeyDownHandler(e,t){const n=this,{subject:o,wrap:i}=t,a=o.querySelector(t.selector);if(!t.nextKey&&a){const e=getComputedStyle(o),n=getComputedStyle(a);"flex"===e.display&&"row"===e.flexDirection||"inline"===n.display||"inline-block"===n.display?(t.previousKey="ArrowLeft",t.nextKey="ArrowRight"):(t.previousKey="ArrowUp",t.nextKey="ArrowDown")}let r,{key:s}=e;switch(s){case t.previousKey:r=n.navigateGetAdjacent(-1,t),!r&&i&&(r=o.querySelector(`${t.selector}:last-of-type`));break;case t.nextKey:r=n.navigateGetAdjacent(1,t),!r&&i&&(r=o.querySelector(t.selector));break;case"Home":r=o.querySelector(t.selector);break;case"End":r=o.querySelector(`${t.selector}:last-of-type`);break;case"Enter":if(t.activeItem){const e=t.activeItem.getBoundingClientRect(),n=e.x+e.width/2,o=e.y+e.height/2;t.activeItem.dispatchEvent(new MouseEvent("click",{bubbles:!0,altKey:Neo.altKeyDown,ctrlKey:Neo.controlKeyDown,metaKey:Neo.metaKeyDown,shiftKey:Neo.shiftKeyDown,clientX:n,clientY:o}))}}r&&(e.preventDefault(),n.navigateTo(r,t))}navigateTo(e,t){if(!t.subject&&!(t=i.A.getElement(t.id)?.$navigator))return;if("number"==typeof e?e=t.subject.querySelectorAll(t.selector)?.[e]:"string"==typeof e&&(e=i.A.getElement(e)),!e)return;const n=[e,...e.querySelectorAll("*")].find(a.A.isFocusable);n?n.focus():this.setActiveItem(e,t)}setActiveItem(e,t){const n=Array.from(t.subject.querySelectorAll(t.selector));"number"==typeof e&&(e=n[Math.max(Math.min(e,n.length-1),0)]),t.previousActiveIndex=t.activeIndex,(t.previousActiveItem=t.activeItem)?.classList.remove(t.activeCls),(t.activeItem=e)?.classList.add(t.activeCls),t.activeIndex=e?n.indexOf(e):-1,e.scrollIntoView({block:"nearest",inline:"nearest",nehavior:"smooth"}),r.A.sendMessageToApp({type:"neonavigate",target:t.id,path:[{id:t.id}],activeItem:t.activeItem.id,previousActiveItem:t.previousActiveItem?.id,activeIndex:t.activeIndex,previousActiveIndex:t.previousActiveIndex,altKey:Neo.altKeyDown,ctrlKey:Neo.controlKeyDown,metaKey:Neo.metaKeyDown,shiftKey:Neo.shiftKeyDown})}navigateGetAdjacent(e=1,t){const{treeWalker:n}=t;if(n.currentNode=this.navigatorGetActiveItem(t)||t.subject,n[e<0?"previousNode":"nextNode"](),n.currentNode){if(n.currentNode!==t.activeItem)return n.currentNode}else if(!1!==t.wrap){const n=t.subject.querySelector(t.selector);return n[1===e?0:n.length-1]}}navigatorGetActiveItem(e){let t=e.activeItem&&i.A.getElement(e.activeItem.id);if(!t&&"activeIndex"in e){const n=e.subject.querySelectorAll(e.selector);t=n[Math.max(Math.min(e.activeIndex,n.length-1),0)]}return t}navigateNodeFilter(e,t){return e.offsetParent&&e.matches?.(t.selector)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}}const c=Neo.applyClassConfig(s)}}]);