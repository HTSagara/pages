"use strict";
(self["webpackChunkneo_mjs"] = self["webpackChunkneo_mjs"] || []).push([["vendors-src_component_Toast_mjs"],{

/***/ "./src/component/Toast.mjs":
/*!*********************************!*\
  !*** ./src/component/Toast.mjs ***!
  \*********************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _component_Base_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../component/Base.mjs */ "./src/component/Base.mjs");
/* harmony import */ var _util_Array_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../util/Array.mjs */ "./src/util/Array.mjs");
/* harmony import */ var _manager_Toast_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../manager/Toast.mjs */ "./src/manager/Toast.mjs");




/**
 * @class Neo.component.Toast
 * @extends Neo.component.Base
 *
 * @example
        Neo.toast({
            // mandatory
            appName         : this.component.appName,
            msg             : 'Alarm was set to 11:30 for journey into Neo development',
            // optional                        defaults
            closable        : true,         // false
            iconCls         : 'fa fa-bell', // null
            maxWidth        : 300,          // 250
            position        : 'br',         // 'tr'
            slideDirection  : 'right',      // 'right'
            title           : 'Alarm Clock' // null
        })
 */
class Toast extends _component_Base_mjs__WEBPACK_IMPORTED_MODULE_0__["default"] {
    /**
     * Valid values for positions
     * @member {String[]} positions = ['tl','tc','tr','bl','bc','br']
     * @protected
     * @static
     */
    static positions = ['tl', 'tc', 'tr', 'bl', 'bc', 'br']
    /**
     * True automatically applies the core/Observable.mjs mixin
     * @member {String[]} slideDirections = ['down','up','left','right']
     * @static
     */
    static slideDirections = ['down', 'up', 'left', 'right']

    static config = {
        /**
         * @member {String} className='Neo.component.Toast'
         * @protected
         */
        className: 'Neo.component.Toast',
        /**
         * @member {String} ntype='toast'
         * @protected
         */
        ntype: 'toast',
        /**
         * @member {String[]} baseCls=['neo-toast']
         * @protected
         */
        baseCls: ['neo-toast'],
        /**
         * If true makes the toast sticky and show a close icon
         * @member {Boolean} closable=false
         */
        closable_: false,
        /**
         * @member {Boolean} floating=true
         */
        floating: true,
        /**
         * If set, it shows this icon in front of the text
         * e.g. 'fa fa-cog'
         * @member {String|null} iconCls=null
         */
        iconCls_: null,
        /**
         * Limits the width of the Toast
         * @member {Number} maxWidth=250
         */
        maxWidth: 250,
        /**
         * Sets the minimum height of the Toast
         * @member {Number} minHeight=50
         */
        minHeight: 50,
        /**
         * Your message. You can also pass in an iconCls
         * @member {String|null} msg_=null
         */
        msg_: null,
        /**
         * Describes the position of the toast, e.g. bl=bottom-left
         * This creates a cls `noe-toast-position`
         * @member {'tl'|'tc'|'tr'|'bl'|'bc'|'br'} position='tr'
         */
        position_: 'tr',
        /**
         * Describes which direction from which side the toasts slides-in
         * This creates a cls `neo-toast-slide-${direction}-in`
         * @member {'down'|'up'|'left'|'right'} slideDirection_='right'
         */
        slideDirection_: 'right',
        /**
         * Adds a title to the toast
         * @member {Number} title_=null
         */
        title_: null,
        /**
         * @member {String|null} title=null
         */
        vdom:
        {cn: [{
            cls: 'neo-toast-inner', cn: [
                {cls: ['neo-toast-icon'], removeDom: true},
                {cls: 'neo-toast-text', cn: [
                    {cls: ['neo-toast-title'], removeDom: true},
                    {cls: 'neo-toast-msg'}
                ]},
                {cls: ['neo-toast-close', 'fa', 'fa-close'], removeDom: true}
            ]
        }]}
    }

    /**
     * Timeout in ms after which the toast is removed
     * @member {Number} removeDelay=3000
     */
    removeDelay = 3000
    /**
     * Used by the ToastManager
     * @member {Boolean} running=false
     * @private
     */
    running = false

    /**
     * @param {Object} config
     */
    construct(config) {
        super.construct(config);

        let me = this;

        // click listener for close
        me.addDomListeners([
            {click: {fn: me.destroy, delegate: '.neo-toast-close', scope: me}}
        ]);

        _manager_Toast_mjs__WEBPACK_IMPORTED_MODULE_2__["default"].register(me)
    }

    /**
     * @param {String|null} value
     * @param {String|null} oldValue
     */
    afterSetClosable(value, oldValue) {
        let vdom = this.getVdomInner().cn[2];

        vdom.removeDom = !value
    }

    /**
     * @param {String|null} value
     * @param {String|null} oldValue
     */
    afterSetIconCls(value, oldValue) {
        let vdom  = this.getVdomInner().cn[0],
            {cls} = vdom;

        vdom.removeDom = Neo.isEmpty(value);
        _util_Array_mjs__WEBPACK_IMPORTED_MODULE_1__["default"][value ? 'add' : 'remove'](cls, value)
    }

    /**
     * Using the afterSetMsg to trigger the setup of the dom
     * A new container is added as an item.
     * We cannot use the vdom here.
     * @param {String|null} value
     * @param {String|null} oldValue
     */
    afterSetMsg(value, oldValue) {
        let vdom = this.getTextRootVdom().cn[1];

        vdom.innerHTML = value
    }

    /**
     * Apply a cls, based on the position
     * @param {String} value
     * @param {String} oldValue
     */
    afterSetPosition(value, oldValue) {
        value && this.addCls(`neo-toast-${value}`)
    }

    /**
     * Apply a cls, based on the slideDirection
     * @param {String} value
     * @param {String} oldValue
     */
    afterSetSlideDirection(value, oldValue) {
        value && this.addCls(`neo-toast-slide-${value}-in`)
    }

    /**
     * Close the toast after the mounted if not closable
     * @param {Boolean} value
     * @param {Boolean} oldValue
     */
    afterSetMounted(value, oldValue) {
        super.afterSetMounted(value, oldValue);

        let me = this;

        if (!me.closable && value) {
            me.timeout(me.removeDelay).then(() => {
                me.destroy(true)
            })
        }
    }

    /**
     * @param {String|null} value
     * @param {String|null} oldValue
     */
    afterSetTitle(value, oldValue) {
        let vdom = this.getTextRootVdom().cn[0];

        vdom.removeDom = Neo.isEmpty(value);
        vdom.innerHTML = value;
        _util_Array_mjs__WEBPACK_IMPORTED_MODULE_1__["default"][value ? 'add' : 'remove'](vdom.cls, 'neo-toast-has-title')
    }

    /**
     * Triggered before the position config gets changed
     * @param {String} value
     * @param {String} oldValue
     * @protected
     */
    beforeSetPosition(value, oldValue) {
        return this.beforeSetEnumValue(value, oldValue, 'position')
    }

    /**
     * Triggered before the slideDirection config gets changed
     * @param {String} value
     * @param {String} oldValue
     * @protected
     */
    beforeSetSlideDirection(value, oldValue) {
        return this.beforeSetEnumValue(value, oldValue, 'slideDirection')
    }

    /**
     *
     */
    async destroy(...args) {
        let me = this;
        const superDestroy = super.destroy.bind(me);

        me.addDomListeners({
            animationend: function () {
                _manager_Toast_mjs__WEBPACK_IMPORTED_MODULE_2__["default"].removeToast(me.id);
                _manager_Toast_mjs__WEBPACK_IMPORTED_MODULE_2__["default"].unregister(me);
                superDestroy(...args);
            }
        });

        me.addCls('neo-toast-fade-out')
    }

    /**
     * This is a dialog, so we have to add an item to be able to
     * @returns {Object} vdom
     */
    getTextRootVdom() {
        return this.getVdomInner().cn[1]
    }

    /**
     * This is a dialog, so we have to add an item to be able to
     * @returns {Object} vdom
     */
    getVdomInner() {
        return this.vdom.cn[0]
    }
}

Neo.setupClass(Toast);

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Toast);


/***/ }),

/***/ "./src/manager/Toast.mjs":
/*!*******************************!*\
  !*** ./src/manager/Toast.mjs ***!
  \*******************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _Base_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./Base.mjs */ "./src/manager/Base.mjs");
/* harmony import */ var _util_Array_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../util/Array.mjs */ "./src/util/Array.mjs");



/**
 * See Neo.dialog.Toast for examples
 * @class Neo.manager.Toast
 * @extends Neo.manager.Base
 * @singleton
 */
class Toast extends _Base_mjs__WEBPACK_IMPORTED_MODULE_0__["default"] {
    static config = {
        /**
         * @member {String} className='Neo.manager.Toast'
         * @protected
         */
        className: 'Neo.manager.Toast',
        /**
         * @member {Boolean} singleton=true
         * @protected
         */
        singleton: true
    }

    /**
     * Using a default margin between the item
     * If you switch the distance to the top or bottom you have to change this value accordingly
     * @member {Number} defaultMargin=16
     */
    defaultMargin = 16
    /**
     * Currently only 1 is supported, because they would overlap
     * @member {Number} maxToasts=3
     */
    maxToasts = 3
    /**
     * Counts the currently running Toasts per area
     * @member {Object} running
     */
    running = {
        bc: [], bl: [], br: [],
        tc: [], tl: [], tr: []
    }
    /**
     * If you prefer your own class to open, override here
     * @member {String} toastClass='Neo.component.Toast'
     */
    toastClass = 'Neo.component.Toast'

    /**
     * @param {Object} config
     */
    construct(config) {
        super.construct(config);
        Neo.toast = this.createToast.bind(this);
    }

    /**
     * Create the Toast definition and pass it to the Collection
     * @param {Object} toast
     * @returns {String|null}
     */
    createToast(toast) {
        let me = this;

        if (toast.position && !me.running[toast.position]) {
            Neo.logError('[Neo.manager.Toast] Supported values for slideDirection are: tl, tc, tr, bl, bc, br');
            return null
        }

        if (!toast.msg || !toast.appName) {
            !toast.msg     && Neo.logError('[Neo.manager.Toast] Toast has to define a msg');
            !toast.appName && Neo.logError('[Neo.manager.Toast] Toast has to define an appName. Typically me.appName.');
            return null
        }

        toast = Neo.create({
            className: this.toastClass,
            ...toast
        });

        toast.on({
            mounted: me.updateItemsInPosition,
            scope  : me
        })

        return toast.id
    }

    /**
     * Find the first toast based on the maximum allowed toasts
     * @returns {*}
     * @private
     */
    findFirstToast() {
        let me = this,
            firstToast, item;

        me.filters = [{property: 'running', value: false}];

        for (item of me.map.values()) {
            if (me.running[item.position].length < me.maxToasts) {
                firstToast = item;
                firstToast.running = true;
                break
            }
        }

        me.clearFilters();

        return firstToast
    }

    /**
     * @param {Object} item
     */
    register(item) {
        super.register(item);
        this.runQueue()
    }

    /**
     * Removes a task from collection.
     * @param {String} toastId
     */
    removeToast(toastId) {
        let me    = this,
            toast = me.get(toastId),
            position;

        if (!toast) {
            return
        }

        position = toast.position;

        // decrease total of displayed toasts for a position
        _util_Array_mjs__WEBPACK_IMPORTED_MODULE_1__["default"].remove(me.running[position], toastId);

        me.updateItemsInPosition(toastId)
    }

    /**
     * Runs a ToastManager to show an item from collection.
     */
    runQueue() {
        let me = this,
            toast;

        if (me.getCount() > 0) {
            toast = me.findFirstToast();

            toast && me.showToast(toast)
        }
    }

    /**
     * @param {Neo.component.Toast} toast
     */
    showToast(toast) {
        toast.render(true);

        let me = this;

        // increase total of displayed toasts for a position
        me.running[toast.position].unshift(toast.id);

        // todo: we could use a mounted listener
        me.timeout(50).then(() => {
            me.updateItemsInPosition(toast.id)
        })
    }

    /**
     * Removes a collection item passed by reference or key
     * @param {Object|String} item
     */
    unregister(item) {
        super.unregister(item);
        this.runQueue()
    }

    /**
     * To handle multiple toasts we handle the exact position
     * from the top or bottom
     * @param {String} id
     * @returns {Promise<void>}
     */
    async updateItemsInPosition(id) {
        let me            = this,
            toast         = me.get(id),
            {position}    = toast,
            positionArray = me.running[position],
            acc           = 0,
            margin        = me.defaultMargin,
            moveTo        = position.substring(0, 1) === 't' ? 'top' : 'bottom',
            component, componentId, index, moveObj, rects;

        rects = await toast.getDomRect(positionArray);

        for ([index, componentId] of positionArray.entries()) {
            component = Neo.getComponent(componentId);
            moveObj   = {};

            acc = acc + margin;
            moveObj[moveTo] = acc + 'px';
            component.style = moveObj;
            component.update();

            // Sometimes the index is already reduced
            // so the last index might not be available
            if(rects[index]) {
                acc = acc + rects[index].height
            }
        }
    }
}

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Neo.setupClass(Toast));


/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2h1bmtzL2FwcC92ZW5kb3JzLXNyY19jb21wb25lbnRfVG9hc3RfbWpzLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBaUQ7QUFDSjtBQUNHOztBQUVoRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLG9CQUFvQiwyREFBSTtBQUN4QjtBQUNBO0FBQ0EsZ0JBQWdCLFVBQVU7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLFVBQVU7QUFDMUI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxvQkFBb0IsUUFBUTtBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixRQUFRO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLFVBQVU7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixTQUFTO0FBQzdCO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixTQUFTO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsYUFBYTtBQUNqQztBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixRQUFRO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLFFBQVE7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsYUFBYTtBQUNqQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLCtCQUErQjtBQUNuRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlEQUFpRCxVQUFVO0FBQzNELG9CQUFvQiw0QkFBNEI7QUFDaEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsUUFBUTtBQUM1QjtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsYUFBYTtBQUNqQztBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsaUJBQWlCLHlDQUF5QztBQUMxRCxpQkFBaUI7QUFDakIscUJBQXFC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QTs7QUFFQSx1QkFBdUIsa0NBQWtDOztBQUV6RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsZUFBZSxRQUFRO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGVBQWUsUUFBUTtBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLFFBQVEsdURBQVE7O0FBRWhCO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsZUFBZSxxQkFBcUI7QUFDcEM7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUOztBQUVBO0FBQ0E7QUFDQSxlQUFlLGVBQWU7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxlQUFlLFFBQVE7QUFDdkIsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYSxhQUFhO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsaUVBQWUscUJBQXFCLEVBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9uZW8ubWpzLy4vc3JjL2NvbXBvbmVudC9Ub2FzdC5tanMiLCJ3ZWJwYWNrOi8vbmVvLm1qcy8uL3NyYy9tYW5hZ2VyL1RvYXN0Lm1qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQmFzZSAgICAgICAgIGZyb20gJy4uL2NvbXBvbmVudC9CYXNlLm1qcyc7XG5pbXBvcnQgTmVvQXJyYXkgICAgIGZyb20gXCIuLi91dGlsL0FycmF5Lm1qc1wiO1xuaW1wb3J0IFRvYXN0TWFuYWdlciBmcm9tICcuLi9tYW5hZ2VyL1RvYXN0Lm1qcyc7XG5cbi8qKlxuICogQGNsYXNzIE5lby5jb21wb25lbnQuVG9hc3RcbiAqIEBleHRlbmRzIE5lby5jb21wb25lbnQuQmFzZVxuICpcbiAqIEBleGFtcGxlXG4gICAgICAgIE5lby50b2FzdCh7XG4gICAgICAgICAgICAvLyBtYW5kYXRvcnlcbiAgICAgICAgICAgIGFwcE5hbWUgICAgICAgICA6IHRoaXMuY29tcG9uZW50LmFwcE5hbWUsXG4gICAgICAgICAgICBtc2cgICAgICAgICAgICAgOiAnQWxhcm0gd2FzIHNldCB0byAxMTozMCBmb3Igam91cm5leSBpbnRvIE5lbyBkZXZlbG9wbWVudCcsXG4gICAgICAgICAgICAvLyBvcHRpb25hbCAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHRzXG4gICAgICAgICAgICBjbG9zYWJsZSAgICAgICAgOiB0cnVlLCAgICAgICAgIC8vIGZhbHNlXG4gICAgICAgICAgICBpY29uQ2xzICAgICAgICAgOiAnZmEgZmEtYmVsbCcsIC8vIG51bGxcbiAgICAgICAgICAgIG1heFdpZHRoICAgICAgICA6IDMwMCwgICAgICAgICAgLy8gMjUwXG4gICAgICAgICAgICBwb3NpdGlvbiAgICAgICAgOiAnYnInLCAgICAgICAgIC8vICd0cidcbiAgICAgICAgICAgIHNsaWRlRGlyZWN0aW9uICA6ICdyaWdodCcsICAgICAgLy8gJ3JpZ2h0J1xuICAgICAgICAgICAgdGl0bGUgICAgICAgICAgIDogJ0FsYXJtIENsb2NrJyAvLyBudWxsXG4gICAgICAgIH0pXG4gKi9cbmNsYXNzIFRvYXN0IGV4dGVuZHMgQmFzZSB7XG4gICAgLyoqXG4gICAgICogVmFsaWQgdmFsdWVzIGZvciBwb3NpdGlvbnNcbiAgICAgKiBAbWVtYmVyIHtTdHJpbmdbXX0gcG9zaXRpb25zID0gWyd0bCcsJ3RjJywndHInLCdibCcsJ2JjJywnYnInXVxuICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgKiBAc3RhdGljXG4gICAgICovXG4gICAgc3RhdGljIHBvc2l0aW9ucyA9IFsndGwnLCAndGMnLCAndHInLCAnYmwnLCAnYmMnLCAnYnInXVxuICAgIC8qKlxuICAgICAqIFRydWUgYXV0b21hdGljYWxseSBhcHBsaWVzIHRoZSBjb3JlL09ic2VydmFibGUubWpzIG1peGluXG4gICAgICogQG1lbWJlciB7U3RyaW5nW119IHNsaWRlRGlyZWN0aW9ucyA9IFsnZG93bicsJ3VwJywnbGVmdCcsJ3JpZ2h0J11cbiAgICAgKiBAc3RhdGljXG4gICAgICovXG4gICAgc3RhdGljIHNsaWRlRGlyZWN0aW9ucyA9IFsnZG93bicsICd1cCcsICdsZWZ0JywgJ3JpZ2h0J11cblxuICAgIHN0YXRpYyBjb25maWcgPSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtTdHJpbmd9IGNsYXNzTmFtZT0nTmVvLmNvbXBvbmVudC5Ub2FzdCdcbiAgICAgICAgICogQHByb3RlY3RlZFxuICAgICAgICAgKi9cbiAgICAgICAgY2xhc3NOYW1lOiAnTmVvLmNvbXBvbmVudC5Ub2FzdCcsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtTdHJpbmd9IG50eXBlPSd0b2FzdCdcbiAgICAgICAgICogQHByb3RlY3RlZFxuICAgICAgICAgKi9cbiAgICAgICAgbnR5cGU6ICd0b2FzdCcsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtTdHJpbmdbXX0gYmFzZUNscz1bJ25lby10b2FzdCddXG4gICAgICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgICAgICovXG4gICAgICAgIGJhc2VDbHM6IFsnbmVvLXRvYXN0J10sXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJZiB0cnVlIG1ha2VzIHRoZSB0b2FzdCBzdGlja3kgYW5kIHNob3cgYSBjbG9zZSBpY29uXG4gICAgICAgICAqIEBtZW1iZXIge0Jvb2xlYW59IGNsb3NhYmxlPWZhbHNlXG4gICAgICAgICAqL1xuICAgICAgICBjbG9zYWJsZV86IGZhbHNlLFxuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7Qm9vbGVhbn0gZmxvYXRpbmc9dHJ1ZVxuICAgICAgICAgKi9cbiAgICAgICAgZmxvYXRpbmc6IHRydWUsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJZiBzZXQsIGl0IHNob3dzIHRoaXMgaWNvbiBpbiBmcm9udCBvZiB0aGUgdGV4dFxuICAgICAgICAgKiBlLmcuICdmYSBmYS1jb2cnXG4gICAgICAgICAqIEBtZW1iZXIge1N0cmluZ3xudWxsfSBpY29uQ2xzPW51bGxcbiAgICAgICAgICovXG4gICAgICAgIGljb25DbHNfOiBudWxsLFxuICAgICAgICAvKipcbiAgICAgICAgICogTGltaXRzIHRoZSB3aWR0aCBvZiB0aGUgVG9hc3RcbiAgICAgICAgICogQG1lbWJlciB7TnVtYmVyfSBtYXhXaWR0aD0yNTBcbiAgICAgICAgICovXG4gICAgICAgIG1heFdpZHRoOiAyNTAsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTZXRzIHRoZSBtaW5pbXVtIGhlaWdodCBvZiB0aGUgVG9hc3RcbiAgICAgICAgICogQG1lbWJlciB7TnVtYmVyfSBtaW5IZWlnaHQ9NTBcbiAgICAgICAgICovXG4gICAgICAgIG1pbkhlaWdodDogNTAsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBZb3VyIG1lc3NhZ2UuIFlvdSBjYW4gYWxzbyBwYXNzIGluIGFuIGljb25DbHNcbiAgICAgICAgICogQG1lbWJlciB7U3RyaW5nfG51bGx9IG1zZ189bnVsbFxuICAgICAgICAgKi9cbiAgICAgICAgbXNnXzogbnVsbCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIERlc2NyaWJlcyB0aGUgcG9zaXRpb24gb2YgdGhlIHRvYXN0LCBlLmcuIGJsPWJvdHRvbS1sZWZ0XG4gICAgICAgICAqIFRoaXMgY3JlYXRlcyBhIGNscyBgbm9lLXRvYXN0LXBvc2l0aW9uYFxuICAgICAgICAgKiBAbWVtYmVyIHsndGwnfCd0Yyd8J3RyJ3wnYmwnfCdiYyd8J2JyJ30gcG9zaXRpb249J3RyJ1xuICAgICAgICAgKi9cbiAgICAgICAgcG9zaXRpb25fOiAndHInLFxuICAgICAgICAvKipcbiAgICAgICAgICogRGVzY3JpYmVzIHdoaWNoIGRpcmVjdGlvbiBmcm9tIHdoaWNoIHNpZGUgdGhlIHRvYXN0cyBzbGlkZXMtaW5cbiAgICAgICAgICogVGhpcyBjcmVhdGVzIGEgY2xzIGBuZW8tdG9hc3Qtc2xpZGUtJHtkaXJlY3Rpb259LWluYFxuICAgICAgICAgKiBAbWVtYmVyIHsnZG93bid8J3VwJ3wnbGVmdCd8J3JpZ2h0J30gc2xpZGVEaXJlY3Rpb25fPSdyaWdodCdcbiAgICAgICAgICovXG4gICAgICAgIHNsaWRlRGlyZWN0aW9uXzogJ3JpZ2h0JyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEFkZHMgYSB0aXRsZSB0byB0aGUgdG9hc3RcbiAgICAgICAgICogQG1lbWJlciB7TnVtYmVyfSB0aXRsZV89bnVsbFxuICAgICAgICAgKi9cbiAgICAgICAgdGl0bGVfOiBudWxsLFxuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7U3RyaW5nfG51bGx9IHRpdGxlPW51bGxcbiAgICAgICAgICovXG4gICAgICAgIHZkb206XG4gICAgICAgIHtjbjogW3tcbiAgICAgICAgICAgIGNsczogJ25lby10b2FzdC1pbm5lcicsIGNuOiBbXG4gICAgICAgICAgICAgICAge2NsczogWyduZW8tdG9hc3QtaWNvbiddLCByZW1vdmVEb206IHRydWV9LFxuICAgICAgICAgICAgICAgIHtjbHM6ICduZW8tdG9hc3QtdGV4dCcsIGNuOiBbXG4gICAgICAgICAgICAgICAgICAgIHtjbHM6IFsnbmVvLXRvYXN0LXRpdGxlJ10sIHJlbW92ZURvbTogdHJ1ZX0sXG4gICAgICAgICAgICAgICAgICAgIHtjbHM6ICduZW8tdG9hc3QtbXNnJ31cbiAgICAgICAgICAgICAgICBdfSxcbiAgICAgICAgICAgICAgICB7Y2xzOiBbJ25lby10b2FzdC1jbG9zZScsICdmYScsICdmYS1jbG9zZSddLCByZW1vdmVEb206IHRydWV9XG4gICAgICAgICAgICBdXG4gICAgICAgIH1dfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRpbWVvdXQgaW4gbXMgYWZ0ZXIgd2hpY2ggdGhlIHRvYXN0IGlzIHJlbW92ZWRcbiAgICAgKiBAbWVtYmVyIHtOdW1iZXJ9IHJlbW92ZURlbGF5PTMwMDBcbiAgICAgKi9cbiAgICByZW1vdmVEZWxheSA9IDMwMDBcbiAgICAvKipcbiAgICAgKiBVc2VkIGJ5IHRoZSBUb2FzdE1hbmFnZXJcbiAgICAgKiBAbWVtYmVyIHtCb29sZWFufSBydW5uaW5nPWZhbHNlXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBydW5uaW5nID0gZmFsc2VcblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjb25maWdcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3QoY29uZmlnKSB7XG4gICAgICAgIHN1cGVyLmNvbnN0cnVjdChjb25maWcpO1xuXG4gICAgICAgIGxldCBtZSA9IHRoaXM7XG5cbiAgICAgICAgLy8gY2xpY2sgbGlzdGVuZXIgZm9yIGNsb3NlXG4gICAgICAgIG1lLmFkZERvbUxpc3RlbmVycyhbXG4gICAgICAgICAgICB7Y2xpY2s6IHtmbjogbWUuZGVzdHJveSwgZGVsZWdhdGU6ICcubmVvLXRvYXN0LWNsb3NlJywgc2NvcGU6IG1lfX1cbiAgICAgICAgXSk7XG5cbiAgICAgICAgVG9hc3RNYW5hZ2VyLnJlZ2lzdGVyKG1lKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfG51bGx9IHZhbHVlXG4gICAgICogQHBhcmFtIHtTdHJpbmd8bnVsbH0gb2xkVmFsdWVcbiAgICAgKi9cbiAgICBhZnRlclNldENsb3NhYmxlKHZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICBsZXQgdmRvbSA9IHRoaXMuZ2V0VmRvbUlubmVyKCkuY25bMl07XG5cbiAgICAgICAgdmRvbS5yZW1vdmVEb20gPSAhdmFsdWVcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge1N0cmluZ3xudWxsfSB2YWx1ZVxuICAgICAqIEBwYXJhbSB7U3RyaW5nfG51bGx9IG9sZFZhbHVlXG4gICAgICovXG4gICAgYWZ0ZXJTZXRJY29uQ2xzKHZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICBsZXQgdmRvbSAgPSB0aGlzLmdldFZkb21Jbm5lcigpLmNuWzBdLFxuICAgICAgICAgICAge2Nsc30gPSB2ZG9tO1xuXG4gICAgICAgIHZkb20ucmVtb3ZlRG9tID0gTmVvLmlzRW1wdHkodmFsdWUpO1xuICAgICAgICBOZW9BcnJheVt2YWx1ZSA/ICdhZGQnIDogJ3JlbW92ZSddKGNscywgdmFsdWUpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVXNpbmcgdGhlIGFmdGVyU2V0TXNnIHRvIHRyaWdnZXIgdGhlIHNldHVwIG9mIHRoZSBkb21cbiAgICAgKiBBIG5ldyBjb250YWluZXIgaXMgYWRkZWQgYXMgYW4gaXRlbS5cbiAgICAgKiBXZSBjYW5ub3QgdXNlIHRoZSB2ZG9tIGhlcmUuXG4gICAgICogQHBhcmFtIHtTdHJpbmd8bnVsbH0gdmFsdWVcbiAgICAgKiBAcGFyYW0ge1N0cmluZ3xudWxsfSBvbGRWYWx1ZVxuICAgICAqL1xuICAgIGFmdGVyU2V0TXNnKHZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICBsZXQgdmRvbSA9IHRoaXMuZ2V0VGV4dFJvb3RWZG9tKCkuY25bMV07XG5cbiAgICAgICAgdmRvbS5pbm5lckhUTUwgPSB2YWx1ZVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEFwcGx5IGEgY2xzLCBiYXNlZCBvbiB0aGUgcG9zaXRpb25cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gdmFsdWVcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gb2xkVmFsdWVcbiAgICAgKi9cbiAgICBhZnRlclNldFBvc2l0aW9uKHZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICB2YWx1ZSAmJiB0aGlzLmFkZENscyhgbmVvLXRvYXN0LSR7dmFsdWV9YClcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBcHBseSBhIGNscywgYmFzZWQgb24gdGhlIHNsaWRlRGlyZWN0aW9uXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHZhbHVlXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IG9sZFZhbHVlXG4gICAgICovXG4gICAgYWZ0ZXJTZXRTbGlkZURpcmVjdGlvbih2YWx1ZSwgb2xkVmFsdWUpIHtcbiAgICAgICAgdmFsdWUgJiYgdGhpcy5hZGRDbHMoYG5lby10b2FzdC1zbGlkZS0ke3ZhbHVlfS1pbmApXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2xvc2UgdGhlIHRvYXN0IGFmdGVyIHRoZSBtb3VudGVkIGlmIG5vdCBjbG9zYWJsZVxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gdmFsdWVcbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IG9sZFZhbHVlXG4gICAgICovXG4gICAgYWZ0ZXJTZXRNb3VudGVkKHZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICBzdXBlci5hZnRlclNldE1vdW50ZWQodmFsdWUsIG9sZFZhbHVlKTtcblxuICAgICAgICBsZXQgbWUgPSB0aGlzO1xuXG4gICAgICAgIGlmICghbWUuY2xvc2FibGUgJiYgdmFsdWUpIHtcbiAgICAgICAgICAgIG1lLnRpbWVvdXQobWUucmVtb3ZlRGVsYXkpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgIG1lLmRlc3Ryb3kodHJ1ZSlcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge1N0cmluZ3xudWxsfSB2YWx1ZVxuICAgICAqIEBwYXJhbSB7U3RyaW5nfG51bGx9IG9sZFZhbHVlXG4gICAgICovXG4gICAgYWZ0ZXJTZXRUaXRsZSh2YWx1ZSwgb2xkVmFsdWUpIHtcbiAgICAgICAgbGV0IHZkb20gPSB0aGlzLmdldFRleHRSb290VmRvbSgpLmNuWzBdO1xuXG4gICAgICAgIHZkb20ucmVtb3ZlRG9tID0gTmVvLmlzRW1wdHkodmFsdWUpO1xuICAgICAgICB2ZG9tLmlubmVySFRNTCA9IHZhbHVlO1xuICAgICAgICBOZW9BcnJheVt2YWx1ZSA/ICdhZGQnIDogJ3JlbW92ZSddKHZkb20uY2xzLCAnbmVvLXRvYXN0LWhhcy10aXRsZScpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVHJpZ2dlcmVkIGJlZm9yZSB0aGUgcG9zaXRpb24gY29uZmlnIGdldHMgY2hhbmdlZFxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSB2YWx1ZVxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBvbGRWYWx1ZVxuICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgKi9cbiAgICBiZWZvcmVTZXRQb3NpdGlvbih2YWx1ZSwgb2xkVmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYmVmb3JlU2V0RW51bVZhbHVlKHZhbHVlLCBvbGRWYWx1ZSwgJ3Bvc2l0aW9uJylcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUcmlnZ2VyZWQgYmVmb3JlIHRoZSBzbGlkZURpcmVjdGlvbiBjb25maWcgZ2V0cyBjaGFuZ2VkXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHZhbHVlXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IG9sZFZhbHVlXG4gICAgICogQHByb3RlY3RlZFxuICAgICAqL1xuICAgIGJlZm9yZVNldFNsaWRlRGlyZWN0aW9uKHZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5iZWZvcmVTZXRFbnVtVmFsdWUodmFsdWUsIG9sZFZhbHVlLCAnc2xpZGVEaXJlY3Rpb24nKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqXG4gICAgICovXG4gICAgYXN5bmMgZGVzdHJveSguLi5hcmdzKSB7XG4gICAgICAgIGxldCBtZSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHN1cGVyRGVzdHJveSA9IHN1cGVyLmRlc3Ryb3kuYmluZChtZSk7XG5cbiAgICAgICAgbWUuYWRkRG9tTGlzdGVuZXJzKHtcbiAgICAgICAgICAgIGFuaW1hdGlvbmVuZDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIFRvYXN0TWFuYWdlci5yZW1vdmVUb2FzdChtZS5pZCk7XG4gICAgICAgICAgICAgICAgVG9hc3RNYW5hZ2VyLnVucmVnaXN0ZXIobWUpO1xuICAgICAgICAgICAgICAgIHN1cGVyRGVzdHJveSguLi5hcmdzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgbWUuYWRkQ2xzKCduZW8tdG9hc3QtZmFkZS1vdXQnKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoaXMgaXMgYSBkaWFsb2csIHNvIHdlIGhhdmUgdG8gYWRkIGFuIGl0ZW0gdG8gYmUgYWJsZSB0b1xuICAgICAqIEByZXR1cm5zIHtPYmplY3R9IHZkb21cbiAgICAgKi9cbiAgICBnZXRUZXh0Um9vdFZkb20oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldFZkb21Jbm5lcigpLmNuWzFdXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhpcyBpcyBhIGRpYWxvZywgc28gd2UgaGF2ZSB0byBhZGQgYW4gaXRlbSB0byBiZSBhYmxlIHRvXG4gICAgICogQHJldHVybnMge09iamVjdH0gdmRvbVxuICAgICAqL1xuICAgIGdldFZkb21Jbm5lcigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudmRvbS5jblswXVxuICAgIH1cbn1cblxuTmVvLnNldHVwQ2xhc3MoVG9hc3QpO1xuXG5leHBvcnQgZGVmYXVsdCBUb2FzdDtcbiIsImltcG9ydCBCYXNlICAgICBmcm9tICcuL0Jhc2UubWpzJztcbmltcG9ydCBOZW9BcnJheSBmcm9tIFwiLi4vdXRpbC9BcnJheS5tanNcIjtcblxuLyoqXG4gKiBTZWUgTmVvLmRpYWxvZy5Ub2FzdCBmb3IgZXhhbXBsZXNcbiAqIEBjbGFzcyBOZW8ubWFuYWdlci5Ub2FzdFxuICogQGV4dGVuZHMgTmVvLm1hbmFnZXIuQmFzZVxuICogQHNpbmdsZXRvblxuICovXG5jbGFzcyBUb2FzdCBleHRlbmRzIEJhc2Uge1xuICAgIHN0YXRpYyBjb25maWcgPSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtTdHJpbmd9IGNsYXNzTmFtZT0nTmVvLm1hbmFnZXIuVG9hc3QnXG4gICAgICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgICAgICovXG4gICAgICAgIGNsYXNzTmFtZTogJ05lby5tYW5hZ2VyLlRvYXN0JyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge0Jvb2xlYW59IHNpbmdsZXRvbj10cnVlXG4gICAgICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgICAgICovXG4gICAgICAgIHNpbmdsZXRvbjogdHJ1ZVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFVzaW5nIGEgZGVmYXVsdCBtYXJnaW4gYmV0d2VlbiB0aGUgaXRlbVxuICAgICAqIElmIHlvdSBzd2l0Y2ggdGhlIGRpc3RhbmNlIHRvIHRoZSB0b3Agb3IgYm90dG9tIHlvdSBoYXZlIHRvIGNoYW5nZSB0aGlzIHZhbHVlIGFjY29yZGluZ2x5XG4gICAgICogQG1lbWJlciB7TnVtYmVyfSBkZWZhdWx0TWFyZ2luPTE2XG4gICAgICovXG4gICAgZGVmYXVsdE1hcmdpbiA9IDE2XG4gICAgLyoqXG4gICAgICogQ3VycmVudGx5IG9ubHkgMSBpcyBzdXBwb3J0ZWQsIGJlY2F1c2UgdGhleSB3b3VsZCBvdmVybGFwXG4gICAgICogQG1lbWJlciB7TnVtYmVyfSBtYXhUb2FzdHM9M1xuICAgICAqL1xuICAgIG1heFRvYXN0cyA9IDNcbiAgICAvKipcbiAgICAgKiBDb3VudHMgdGhlIGN1cnJlbnRseSBydW5uaW5nIFRvYXN0cyBwZXIgYXJlYVxuICAgICAqIEBtZW1iZXIge09iamVjdH0gcnVubmluZ1xuICAgICAqL1xuICAgIHJ1bm5pbmcgPSB7XG4gICAgICAgIGJjOiBbXSwgYmw6IFtdLCBicjogW10sXG4gICAgICAgIHRjOiBbXSwgdGw6IFtdLCB0cjogW11cbiAgICB9XG4gICAgLyoqXG4gICAgICogSWYgeW91IHByZWZlciB5b3VyIG93biBjbGFzcyB0byBvcGVuLCBvdmVycmlkZSBoZXJlXG4gICAgICogQG1lbWJlciB7U3RyaW5nfSB0b2FzdENsYXNzPSdOZW8uY29tcG9uZW50LlRvYXN0J1xuICAgICAqL1xuICAgIHRvYXN0Q2xhc3MgPSAnTmVvLmNvbXBvbmVudC5Ub2FzdCdcblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjb25maWdcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3QoY29uZmlnKSB7XG4gICAgICAgIHN1cGVyLmNvbnN0cnVjdChjb25maWcpO1xuICAgICAgICBOZW8udG9hc3QgPSB0aGlzLmNyZWF0ZVRvYXN0LmJpbmQodGhpcyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlIHRoZSBUb2FzdCBkZWZpbml0aW9uIGFuZCBwYXNzIGl0IHRvIHRoZSBDb2xsZWN0aW9uXG4gICAgICogQHBhcmFtIHtPYmplY3R9IHRvYXN0XG4gICAgICogQHJldHVybnMge1N0cmluZ3xudWxsfVxuICAgICAqL1xuICAgIGNyZWF0ZVRvYXN0KHRvYXN0KSB7XG4gICAgICAgIGxldCBtZSA9IHRoaXM7XG5cbiAgICAgICAgaWYgKHRvYXN0LnBvc2l0aW9uICYmICFtZS5ydW5uaW5nW3RvYXN0LnBvc2l0aW9uXSkge1xuICAgICAgICAgICAgTmVvLmxvZ0Vycm9yKCdbTmVvLm1hbmFnZXIuVG9hc3RdIFN1cHBvcnRlZCB2YWx1ZXMgZm9yIHNsaWRlRGlyZWN0aW9uIGFyZTogdGwsIHRjLCB0ciwgYmwsIGJjLCBicicpO1xuICAgICAgICAgICAgcmV0dXJuIG51bGxcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghdG9hc3QubXNnIHx8ICF0b2FzdC5hcHBOYW1lKSB7XG4gICAgICAgICAgICAhdG9hc3QubXNnICAgICAmJiBOZW8ubG9nRXJyb3IoJ1tOZW8ubWFuYWdlci5Ub2FzdF0gVG9hc3QgaGFzIHRvIGRlZmluZSBhIG1zZycpO1xuICAgICAgICAgICAgIXRvYXN0LmFwcE5hbWUgJiYgTmVvLmxvZ0Vycm9yKCdbTmVvLm1hbmFnZXIuVG9hc3RdIFRvYXN0IGhhcyB0byBkZWZpbmUgYW4gYXBwTmFtZS4gVHlwaWNhbGx5IG1lLmFwcE5hbWUuJyk7XG4gICAgICAgICAgICByZXR1cm4gbnVsbFxuICAgICAgICB9XG5cbiAgICAgICAgdG9hc3QgPSBOZW8uY3JlYXRlKHtcbiAgICAgICAgICAgIGNsYXNzTmFtZTogdGhpcy50b2FzdENsYXNzLFxuICAgICAgICAgICAgLi4udG9hc3RcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdG9hc3Qub24oe1xuICAgICAgICAgICAgbW91bnRlZDogbWUudXBkYXRlSXRlbXNJblBvc2l0aW9uLFxuICAgICAgICAgICAgc2NvcGUgIDogbWVcbiAgICAgICAgfSlcblxuICAgICAgICByZXR1cm4gdG9hc3QuaWRcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBGaW5kIHRoZSBmaXJzdCB0b2FzdCBiYXNlZCBvbiB0aGUgbWF4aW11bSBhbGxvd2VkIHRvYXN0c1xuICAgICAqIEByZXR1cm5zIHsqfVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgZmluZEZpcnN0VG9hc3QoKSB7XG4gICAgICAgIGxldCBtZSA9IHRoaXMsXG4gICAgICAgICAgICBmaXJzdFRvYXN0LCBpdGVtO1xuXG4gICAgICAgIG1lLmZpbHRlcnMgPSBbe3Byb3BlcnR5OiAncnVubmluZycsIHZhbHVlOiBmYWxzZX1dO1xuXG4gICAgICAgIGZvciAoaXRlbSBvZiBtZS5tYXAudmFsdWVzKCkpIHtcbiAgICAgICAgICAgIGlmIChtZS5ydW5uaW5nW2l0ZW0ucG9zaXRpb25dLmxlbmd0aCA8IG1lLm1heFRvYXN0cykge1xuICAgICAgICAgICAgICAgIGZpcnN0VG9hc3QgPSBpdGVtO1xuICAgICAgICAgICAgICAgIGZpcnN0VG9hc3QucnVubmluZyA9IHRydWU7XG4gICAgICAgICAgICAgICAgYnJlYWtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIG1lLmNsZWFyRmlsdGVycygpO1xuXG4gICAgICAgIHJldHVybiBmaXJzdFRvYXN0XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGl0ZW1cbiAgICAgKi9cbiAgICByZWdpc3RlcihpdGVtKSB7XG4gICAgICAgIHN1cGVyLnJlZ2lzdGVyKGl0ZW0pO1xuICAgICAgICB0aGlzLnJ1blF1ZXVlKClcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZW1vdmVzIGEgdGFzayBmcm9tIGNvbGxlY3Rpb24uXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHRvYXN0SWRcbiAgICAgKi9cbiAgICByZW1vdmVUb2FzdCh0b2FzdElkKSB7XG4gICAgICAgIGxldCBtZSAgICA9IHRoaXMsXG4gICAgICAgICAgICB0b2FzdCA9IG1lLmdldCh0b2FzdElkKSxcbiAgICAgICAgICAgIHBvc2l0aW9uO1xuXG4gICAgICAgIGlmICghdG9hc3QpIHtcbiAgICAgICAgICAgIHJldHVyblxuICAgICAgICB9XG5cbiAgICAgICAgcG9zaXRpb24gPSB0b2FzdC5wb3NpdGlvbjtcblxuICAgICAgICAvLyBkZWNyZWFzZSB0b3RhbCBvZiBkaXNwbGF5ZWQgdG9hc3RzIGZvciBhIHBvc2l0aW9uXG4gICAgICAgIE5lb0FycmF5LnJlbW92ZShtZS5ydW5uaW5nW3Bvc2l0aW9uXSwgdG9hc3RJZCk7XG5cbiAgICAgICAgbWUudXBkYXRlSXRlbXNJblBvc2l0aW9uKHRvYXN0SWQpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUnVucyBhIFRvYXN0TWFuYWdlciB0byBzaG93IGFuIGl0ZW0gZnJvbSBjb2xsZWN0aW9uLlxuICAgICAqL1xuICAgIHJ1blF1ZXVlKCkge1xuICAgICAgICBsZXQgbWUgPSB0aGlzLFxuICAgICAgICAgICAgdG9hc3Q7XG5cbiAgICAgICAgaWYgKG1lLmdldENvdW50KCkgPiAwKSB7XG4gICAgICAgICAgICB0b2FzdCA9IG1lLmZpbmRGaXJzdFRvYXN0KCk7XG5cbiAgICAgICAgICAgIHRvYXN0ICYmIG1lLnNob3dUb2FzdCh0b2FzdClcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7TmVvLmNvbXBvbmVudC5Ub2FzdH0gdG9hc3RcbiAgICAgKi9cbiAgICBzaG93VG9hc3QodG9hc3QpIHtcbiAgICAgICAgdG9hc3QucmVuZGVyKHRydWUpO1xuXG4gICAgICAgIGxldCBtZSA9IHRoaXM7XG5cbiAgICAgICAgLy8gaW5jcmVhc2UgdG90YWwgb2YgZGlzcGxheWVkIHRvYXN0cyBmb3IgYSBwb3NpdGlvblxuICAgICAgICBtZS5ydW5uaW5nW3RvYXN0LnBvc2l0aW9uXS51bnNoaWZ0KHRvYXN0LmlkKTtcblxuICAgICAgICAvLyB0b2RvOiB3ZSBjb3VsZCB1c2UgYSBtb3VudGVkIGxpc3RlbmVyXG4gICAgICAgIG1lLnRpbWVvdXQoNTApLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgbWUudXBkYXRlSXRlbXNJblBvc2l0aW9uKHRvYXN0LmlkKVxuICAgICAgICB9KVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlbW92ZXMgYSBjb2xsZWN0aW9uIGl0ZW0gcGFzc2VkIGJ5IHJlZmVyZW5jZSBvciBrZXlcbiAgICAgKiBAcGFyYW0ge09iamVjdHxTdHJpbmd9IGl0ZW1cbiAgICAgKi9cbiAgICB1bnJlZ2lzdGVyKGl0ZW0pIHtcbiAgICAgICAgc3VwZXIudW5yZWdpc3RlcihpdGVtKTtcbiAgICAgICAgdGhpcy5ydW5RdWV1ZSgpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVG8gaGFuZGxlIG11bHRpcGxlIHRvYXN0cyB3ZSBoYW5kbGUgdGhlIGV4YWN0IHBvc2l0aW9uXG4gICAgICogZnJvbSB0aGUgdG9wIG9yIGJvdHRvbVxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBpZFxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlPHZvaWQ+fVxuICAgICAqL1xuICAgIGFzeW5jIHVwZGF0ZUl0ZW1zSW5Qb3NpdGlvbihpZCkge1xuICAgICAgICBsZXQgbWUgICAgICAgICAgICA9IHRoaXMsXG4gICAgICAgICAgICB0b2FzdCAgICAgICAgID0gbWUuZ2V0KGlkKSxcbiAgICAgICAgICAgIHtwb3NpdGlvbn0gICAgPSB0b2FzdCxcbiAgICAgICAgICAgIHBvc2l0aW9uQXJyYXkgPSBtZS5ydW5uaW5nW3Bvc2l0aW9uXSxcbiAgICAgICAgICAgIGFjYyAgICAgICAgICAgPSAwLFxuICAgICAgICAgICAgbWFyZ2luICAgICAgICA9IG1lLmRlZmF1bHRNYXJnaW4sXG4gICAgICAgICAgICBtb3ZlVG8gICAgICAgID0gcG9zaXRpb24uc3Vic3RyaW5nKDAsIDEpID09PSAndCcgPyAndG9wJyA6ICdib3R0b20nLFxuICAgICAgICAgICAgY29tcG9uZW50LCBjb21wb25lbnRJZCwgaW5kZXgsIG1vdmVPYmosIHJlY3RzO1xuXG4gICAgICAgIHJlY3RzID0gYXdhaXQgdG9hc3QuZ2V0RG9tUmVjdChwb3NpdGlvbkFycmF5KTtcblxuICAgICAgICBmb3IgKFtpbmRleCwgY29tcG9uZW50SWRdIG9mIHBvc2l0aW9uQXJyYXkuZW50cmllcygpKSB7XG4gICAgICAgICAgICBjb21wb25lbnQgPSBOZW8uZ2V0Q29tcG9uZW50KGNvbXBvbmVudElkKTtcbiAgICAgICAgICAgIG1vdmVPYmogICA9IHt9O1xuXG4gICAgICAgICAgICBhY2MgPSBhY2MgKyBtYXJnaW47XG4gICAgICAgICAgICBtb3ZlT2JqW21vdmVUb10gPSBhY2MgKyAncHgnO1xuICAgICAgICAgICAgY29tcG9uZW50LnN0eWxlID0gbW92ZU9iajtcbiAgICAgICAgICAgIGNvbXBvbmVudC51cGRhdGUoKTtcblxuICAgICAgICAgICAgLy8gU29tZXRpbWVzIHRoZSBpbmRleCBpcyBhbHJlYWR5IHJlZHVjZWRcbiAgICAgICAgICAgIC8vIHNvIHRoZSBsYXN0IGluZGV4IG1pZ2h0IG5vdCBiZSBhdmFpbGFibGVcbiAgICAgICAgICAgIGlmKHJlY3RzW2luZGV4XSkge1xuICAgICAgICAgICAgICAgIGFjYyA9IGFjYyArIHJlY3RzW2luZGV4XS5oZWlnaHRcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgTmVvLnNldHVwQ2xhc3MoVG9hc3QpO1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9