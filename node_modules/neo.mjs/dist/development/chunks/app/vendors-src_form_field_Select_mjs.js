"use strict";
(self["webpackChunkneo_mjs"] = self["webpackChunkneo_mjs"] || []).push([["vendors-src_form_field_Select_mjs"],{

/***/ "./src/form/field/Picker.mjs":
/*!***********************************!*\
  !*** ./src/form/field/Picker.mjs ***!
  \***********************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _container_Base_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../container/Base.mjs */ "./src/container/Base.mjs");
/* harmony import */ var _util_Array_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../util/Array.mjs */ "./src/util/Array.mjs");
/* harmony import */ var _trigger_Picker_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./trigger/Picker.mjs */ "./src/form/field/trigger/Picker.mjs");
/* harmony import */ var _Text_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./Text.mjs */ "./src/form/field/Text.mjs");





/**
 * The abstract picker field provides an arrow down trigger which opens a floating container to provide
 * more data selection options
 * @class Neo.form.field.Picker
 * @extends Neo.form.field.Text
 * @abstract
 */
class Picker extends _Text_mjs__WEBPACK_IMPORTED_MODULE_3__["default"] {
    static config = {
        /**
         * @member {String} className='Neo.form.field.Picker'
         * @protected
         */
        className: 'Neo.form.field.Picker',
        /**
         * @member {String} ntype='pickerfield'
         * @protected
         */
        ntype: 'pickerfield',
        /**
         * @member {String[]} baseCls=['neo-pickerfield','neo-textfield']
         */
        baseCls: ['neo-pickerfield', 'neo-textfield'],
        /**
         * Stores the data from the getBoundingClientRect() call (picker & body DomRects)
         * @member {Array} clientRects=null
         * @protected
         */
        clientRects: null,
        /**
         * Additional used keys for the selection model
         * @member {Object} keys
         */
        keys: {
            Enter : 'onKeyDownEnter',
            Escape: 'onKeyDownEscape'
        },
        /**
         * @member {Neo.container.Base|null} picker=null
         * @protected
         */
        picker: null,
        /**
         * Configs to pass to the picker container
         * @member {Object|null} pickerConfig=null
         */
        pickerConfig: null,
        /**
         * The height of the picker container. Defaults to px.
         * @member {Number|null} pickerHeight=100
         */
        pickerHeight: 100,
        /**
         * @member {Boolean} pickerIsMounted_=false
         * @protected
         */
        pickerIsMounted_: false,
        /**
         * The height of the picker container. Defaults to px.
         * @member {Number|null} pickerMaxHeight=200
         */
        pickerMaxHeight: 200,
        /**
         * The width of the picker container. Defaults to px.
         * By default, the width of the picker matches the width of the input wrap element.
         * @member {Number|null} pickerWidth=null
         */
        pickerWidth: null,
        /**
         * @member {Boolean} showPickerOnFocus=false
         * @protected
         */
        showPickerOnFocus: false,
        /**
         * @member {Object|Object[]} triggers=[]
         * @protected
         */
        triggers: [{
            module: _trigger_Picker_mjs__WEBPACK_IMPORTED_MODULE_2__["default"]
        }]
    }

    /**
     * @param {Object} config
     */
    construct(config) {
        super.construct(config);

        let me = this;

        me.addDomListeners({
            click: me.onInputClick,
            scope: me
        })
    }

    /**
     * Triggered after the mounted config got changed
     * @param {Boolean} value
     * @param {Boolean} oldValue
     * @protected
     */
    afterSetMounted(value, oldValue) {
        if (value === false && oldValue && this.pickerIsMounted) {
            this.picker.hide()
        }

        super.afterSetMounted(value, oldValue)
    }

    /**
     * Triggered after the theme config got changed
     * @param {String|null} value
     * @param {String|null} oldValue
     * @protected
     */
    afterSetTheme(value, oldValue) {
        super.afterSetTheme(value, oldValue);

        if (this.picker) {
            this.picker.theme = value
        }
    }

    /**
     * @returns {Neo.container.Base}
     */
    createPicker() {
        const
            me              = this,
            { pickerWidth } = me,
            pickerComponent = me.createPickerComponent();

        me.picker =  Neo.create(_container_Base_mjs__WEBPACK_IMPORTED_MODULE_0__["default"], {
            parentId : 'document.body',
            floating : true,
            align    : {
                edgeAlign : pickerWidth ? 't0-b0' : 't-b',
                matchSize : !pickerWidth,
                axisLock  : true,
                target    : me.getInputWrapperId()
            },
            appName  : me.appName,
            cls      : ['neo-picker-container', 'neo-container'],
            height   : me.pickerHeight,
            hidden   : true,
            id       : me.getPickerId(),
            items    : pickerComponent ? [pickerComponent] : [],
            maxHeight: me.pickerMaxHeight,
            theme    : me.theme,
            width    : pickerWidth,
            ...me.pickerConfig,

            // scoped to the field instance
            onFocusLeave: data => {
                let insideField = false,
                    item;

                for (item of data.oldPath) {
                    if (item.id === me.id) {
                        insideField = true;
                        break
                    }
                }

                if (!insideField) {
                    me.hidePicker();
                    super.onFocusLeave(data)
                }
            }
        });

        me.picker.on('hiddenChange', me.onPickerHiddenChange, me);

        return me.picker
    }

    /**
     * Override this method to create your picker content as needed
     * @returns {Neo.component.Base|null}
     */
    createPickerComponent() {
        return null
    }

    /**
     * @param args
     */
    destroy(...args) {
        let picker = this.picker;

        if (picker?.hidden === false) {
            picker.unmount()
        }

        picker?.destroy();
        super.destroy(...args)
    }

    /**
     * Returns the picker instance and creates it in case it does not exist yet
     * @returns {Neo.container.Base}
     */
    getPicker() {
        return this.picker || this.createPicker()
    }

    /**
     * @returns {String}
     */
    getPickerId() {
        return `${this.id}__picker`
    }

    /**
     *
     */
    async hidePicker() {
        if (this.picker) {
            this.picker.hidden = true
        }
    }

    /**
     * @param {Object} data
     * @protected
     */
    onFocusEnter(data) {
        super.onFocusEnter(data);

        let me = this;

        me.showPickerOnFocus && me.showPicker()
    }

    /**
     * @param {Object} data
     * @protected
     */
    onFocusLeave(data) {
        let me           = this,
            insidePicker = false,
            item;

        for (item of data.oldPath) {
            if (item.id === me.getPickerId()) {
                insidePicker = true;
                break
            }
        }

        if (!insidePicker) {
            me.hidePicker();
            super.onFocusLeave(data)
        }
    }

    /**
     * @param {Object} data
     */
    onInputClick(data) {
        !this.editable && this.togglePicker()
    }

    /**
     * @param {Object} data
     * @param {Function} [callback]
     * @param {Object} [callbackScope]
     * @protected
     */
    onKeyDownEnter(data, callback, callbackScope) {
        !this.pickerIsMounted && this.showPicker(callback, callbackScope)
    }

    /**
     * @param {Object} data
     * @protected
     */
    onKeyDownEscape(data) {
        this.pickerIsMounted && this.hidePicker()
    }

    /**
     * @param {Object} data
     * @param {String} data.id
     * @param {Boolean} data.oldValue
     * @param {Boolean} data.value
     * @protected
     */
    onPickerHiddenChange(data) {
        this.pickerIsMounted = !data.value
    }

    /**
     * Called by form.field.trigger.Picker
     * @protected
     */
    onPickerTriggerClick() {
        this.editable && this.togglePicker()
    }

    /**
     *
     */
    showPicker() {
        this.getPicker().hidden = false
    }

    /**
     *
     */
    togglePicker() {
        let picker = this.getPicker();
        picker.hidden = !picker.hidden
    }
}

Neo.applyClassConfig(Picker);

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Picker);


/***/ }),

/***/ "./src/form/field/Select.mjs":
/*!***********************************!*\
  !*** ./src/form/field/Select.mjs ***!
  \***********************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _util_ClassSystem_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../util/ClassSystem.mjs */ "./src/util/ClassSystem.mjs");
/* harmony import */ var _manager_Component_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../manager/Component.mjs */ "./src/manager/Component.mjs");
/* harmony import */ var _list_Base_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../list/Base.mjs */ "./src/list/Base.mjs");
/* harmony import */ var _Picker_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./Picker.mjs */ "./src/form/field/Picker.mjs");
/* harmony import */ var _data_Store_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../data/Store.mjs */ "./src/data/Store.mjs");
/* harmony import */ var _util_VDom_mjs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../util/VDom.mjs */ "./src/util/VDom.mjs");
/* harmony import */ var _util_Function_mjs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../util/Function.mjs */ "./src/util/Function.mjs");







/**
 * Provides a dropdown list to select one or multiple items.
 *
 * Conforms to ARIA accessiblity standards outlines in https://www.w3.org/WAI/ARIA/apg/patterns/combobox/
 * @class Neo.form.field.Select
 * @extends Neo.form.field.Picker
 */
class Select extends _Picker_mjs__WEBPACK_IMPORTED_MODULE_3__["default"] {
    /**
     * Valid values for triggerAction
     * @member {String[]} triggerActions=['all','filtered']
     * @protected
     * @static
     */
    static triggerActions = ['all', 'filtered']

    static config = {
        /**
         * @member {String} className='Neo.form.field.Select'
         * @protected
         */
        className: 'Neo.form.field.Select',
        /**
         * @member {String} ntype='selectfield'
         * @protected
         */
        ntype: 'selectfield',
        /**
         * @member {String[]} baseCls=['neo-selectfield','neo-pickerfield','neo-textfield']
         */
        baseCls: ['neo-selectfield', 'neo-pickerfield', 'neo-textfield'],
        /**
         * @member {String} displayField='name'
         */
        displayField: 'name',
        /**
         * @member {String} filterOperator_='like'
         */
        filterOperator_: 'like',
        /**
         * True will only fire a change event, in case the TextField input value matches a record.
         * onFocusLeave() will try to select a hint record, if needed and possible.
         * @member {Boolean} forceSelection=false
         */
        forceSelection: false,
        /**
         * @member {String|Number|null} activeRecordId=null
         */
        activeRecordId: null,
        /**
         * Additional used keys for the selection model
         * @member {Object} keys
         */
        keys: {
            Down  : 'onKeyDownDown',
            Escape: 'onKeyDownEscape'
        },
        /**
         * @member {String|null} lastManualInput=null
         * @protected
         */
        lastManualInput: null,
        /**
         * @member {Neo.list.Base} list=null
         * @protected
         */
        list: null,
        /**
         * @member {Object|null} listConfig_=null
         */
        listConfig_: null,
        /**
         * The height of the picker container. Defaults to px.
         * @member {Number|null} pickerHeight=null
         */
        pickerHeight: null,
        /**
         * @member {Object} record_=null
         * @protected
         */
        record_: null,
        /**
         * @member {String|null} role='combobox'
         */
        role: 'combobox',
        /**
         * @member {Neo.data.Store|null} store_=null
         */
        store_: null,
        /**
         * Showing the list via the down trigger can either show all list items or only show items which
         * match the filter string inside the input field.
         * Valid values: all, filtered
         * @member {String} triggerAction_='all'
         */
        triggerAction_: 'all',
        /**
         * Display the first matching result while typing
         * @member {Boolean} typeAhead_=true
         */
        typeAhead_: true,
        /**
         * Set this config to false, in case typing into the input field should not filter list items
         * @member {Boolean} useFilter_=true
         */
        useFilter_: true,
        /**
         * This config should point to the store keyProperty or a different model field,
         * which you want to submit instead
         * @member {Number|String} valueField='id'
         */
        valueField: 'id',
        /**
         * The millisecond time to delay between input field mutation and applying the input field's
         * new value to the filter
         * @member {Number} filterDelay=300
         */
        filterDelay : 300
    }

    /**
     * @param {Object} config
     */
    construct(config) {
        super.construct(config);

        // Create buffered function to respond to input field mutation
        this.filterOnInput = (0,_util_Function_mjs__WEBPACK_IMPORTED_MODULE_6__.buffer)(this.filterOnInput, this, this.filterDelay);

        this.typeAhead && this.updateTypeAhead()
    }

    /**
     * Triggered after the record config got changed
     * @param {Object} value
     * @param {Object} oldValue
     * @protected
     */
    afterSetRecord(value) {
        if (this._picker?.isVisible) {
            let me             = this,
                selectionModel = me.list?.selectionModel;

            if (value) {
                selectionModel?.select(value);
            }
            else {
                selectionModel.deselectAll();
            }
        }
    }

    /**
     * Triggered after the store config got changed
     * @param {Neo.data.Store} value
     * @param {Neo.data.Store} oldValue
     * @protected
     */
    afterSetStore(value, oldValue) {
        let me = this,
            filters;

        if (value) {
            if (me.useFilter) {
                filters = value.filters || [];

                filters.push({
                    includeEmptyValues: true,
                    operator          : me.filterOperator,
                    property          : me.displayField,
                    value             : value.get(me.value)?.[me.displayField] || me.value
                });

                value.filters = filters
            }

            if (me.list) {
                me.list.store = value
            }

            value.on('load', me.onStoreLoad, me)
        }
    }

    /**
     * Triggered after the typeAhead config got changed
     * @param {Boolean} value
     * @param {Boolean} oldValue
     * @protected
     */
    afterSetTypeAhead(value, oldValue) {
        this.rendered && this.updateTypeAhead()
    }

    /**
     * Triggered before the listConfig config gets changed.
     * @param {Object} value
     * @param {Object} oldValue
     * @returns {Object}
     * @protected
     */
    beforeSetListConfig(value, oldValue) {
        value && this.parseItemConfigs(value);
        return value
    }

    /**
     * Triggered before the store config gets changed.
     * @param {Object|Neo.data.Store|null} value
     * @param {Neo.data.Store} oldValue
     * @returns {Neo.data.Store}
     * @protected
     */
    beforeSetStore(value, oldValue) {
        oldValue?.destroy();

        // to reduce boilerplate code, a store config object without a defined model should default
        // to displayField & valueField defaults
        if (Neo.typeOf(value) === 'Object' && !value.model && !value.module && !value.ntype) {
            value.model = {
                fields: [
                    {name: 'id',   type: 'String'},
                    {name: 'name', type: 'String'}
                ]
            }
        }

        return _util_ClassSystem_mjs__WEBPACK_IMPORTED_MODULE_0__["default"].beforeSetInstance(value, _data_Store_mjs__WEBPACK_IMPORTED_MODULE_4__["default"])
    }

    /**
     * Triggered before the triggerAction config gets changed
     * @param {String} value
     * @param {String} oldValue
     * @protected
     */
    beforeSetTriggerAction(value, oldValue) {
        return this.beforeSetEnumValue(value, oldValue, 'triggerAction')
    }

    /**
     * Triggered before the value config gets changed.
     * @param {Number|String|null} value
     * @param {Number|String|null} oldValue
     * @returns {Number|String|null}
     * @protected
     */
    beforeSetValue(value, oldValue) {
        let me           = this,
            displayField = me.displayField,
            store        = me.store,
            record;

        if (Neo.isObject(value)) {
            me.record = value;
            return value[displayField];
        } else {
            record = store.isFiltered() ? store.allItems.get(value) : store.get(value);

            if (record) {
                me.record = record;
                return record[displayField];
            }
        }

        me.record = store.find(displayField, value)[0] || null;

        return value
    }

    /**
     * @returns {Neo.list.Base}
     */
    createPickerComponent() {
        const me = this;

        me.list = Neo.create({
            module          : _list_Base_mjs__WEBPACK_IMPORTED_MODULE_2__["default"],
            appName         : me.appName,
            displayField    : me.displayField,
            role            : 'listbox',
            itemRole        : 'option',
            parentId        : me.id,
            navigator       : {
                eventSource : me.getInputElId()
            },
            selectionModel  : {stayInList: false},
            store           : me.store,
            ...me.listConfig
        });
        me.getInputEl()['aria-controls'] = me.list.id;

        me.list.addDomListeners({
            neonavigate: {
                fn    : me.onListItemNavigate,
                scope : me
            }
        });
        me.list.selectionModel.on({
            selectionChange : me.onListItemSelectionChange,
            noChange        : me.onListItemSelectionNoChange,
            scope           : me
        })

        return me.list;
    }

    /**
     * Overrides form.field.Base
     * @param {*} value
     * @param {*} oldValue
     * @override
     */
    fireChangeEvent(value, oldValue) {
        let me            = this,
            FormContainer = Neo.form?.Container,
            record        = me.record,
            oldRecord, params;

        if (!(me.forceSelection && !record)) {
            oldRecord = me.store.get(oldValue) || null;

            params = {
                component: me,
                oldRecord,
                oldValue,
                record,
                value
            };

            me.fire('change', params);

            if (!me.suspendEvents) {
                _manager_Component_mjs__WEBPACK_IMPORTED_MODULE_1__["default"].getParents(me).forEach(parent => {
                    if (FormContainer && parent instanceof FormContainer) {
                        parent.fire('fieldChange', params)
                    }
                })
            }
        }
    }

    /**
     * @returns {Object}
     */
    getInputHintEl() {
        return _util_VDom_mjs__WEBPACK_IMPORTED_MODULE_5__["default"].findVdomChild(this.vdom, this.getInputHintId())?.vdom
    }

    /**
     * @returns {String}
     */
    getInputHintId() {
        return this.id + '__input-hint'
    }

    /**
     * Returns the first selected record or null
     * returns {Object}
     */
    getRecord() {
        let list      = this.list,
            recordKey = list.selectionModel.getSelection()[0];

        return recordKey && this.store.get(list.getItemRecordId(recordKey)) || null
    }

    /**
     * @returns {Number|String}
     */
    getValue() {
        let me = this;

        return me.record?.[me.valueField] || me.value
    }

    onConstructed() {
        const inputEl = this.getInputEl();

        inputEl['aria-expanded'] = false
        inputEl['aria-haspopup'] = 'listbox'
        inputEl['aria-activedescendant'] = ''
        super.onConstructed(...arguments);
    }

    /**
     * @param {Object} data
     * @param {Object[]} data.oldPath
     * @protected
     */
    onFocusLeave(data) {
        let me = this;

        if (!me.record) {
            if (me.forceSelection) {
                me.value = me.forceSelection ? me.activeRecordId : null;
            }
            // If we exit without selecting a record, clear the filter input value.
            else {
                me.getInputEl().value = '';
            }
        }

        // Clear any typeahead hint
        me.updateTypeAheadValue('');

        // The VDOM must not carry the empty string permanently. Only while clearing the value.
        if (!me.record && !me.forceSelection) {
            delete me.getInputEl().value;
        }

        super.onFocusLeave(data)
    }

    filterOnInput(data) {
        if (data.value) {
            this.doFilter(data.value);
        }
        else if (this.picker) {
            this.picker?.hide();
        }
    }

    /**
     * @param {Object} data
     * @protected
     */
    onInputValueChange(data) {
        // We do not call super here. The value of the Select is *not* connected to the value
        // typed into the input area. The input area is just a filter value to filter the list.
        this.lastManualInput = data.value
        this.filterOnInput(data);
    }

    /**
     * @param {Object} data
     * @protected
     */
    onKeyDownDown(data) {
        if (!this.picker || this.picker?.hidden) {
            this.onPickerTriggerClick();
        }
    }

    onPickerHiddenChange({ value }) {
        const inputEl = this.getInputEl();

        super.onPickerHiddenChange(...arguments);
        if (value) {
            inputEl['aria-activedescendant'] = '';
        }
        inputEl['aria-expanded'] = !value;
        this.update();
    }

    // TODO:
    // When we are using a `Collection` as our `valueCollection`, and that `Collection` is the
    // `items` of the List's `selectionModel`, then this will be `onValueCollectionChange`,
    // a `mutate` listener on our own `valueCollection` which backs our `value` field which
    // will be implemented by a getter which accesses `valueCollection`.
    // This will become important for implementing multiSelect
    /**
     * @param {Object} selectionChangeEvent
     * @param {Object[]} selectionChangeEvent.selection
     * @protected
     */
    onListItemSelectionChange({ selection }) {
        if (selection?.length) {
            const
                me           = this,
                oldValue     = me.value,
                selected     = selection[0],
                record       = typeof selected === 'string' ? me.store.get(me.list.getItemRecordId(selected)) : selected,
                value        = record[me.displayField];

            me.hidePicker();
            me.hintRecordId = null;
            me.record       = record;
            me._value       = value;
            me.getInputHintEl().value = null;

            me.afterSetValue(value, oldValue, true); // prevent the list from getting filtered

            me.fire('select', {
                record,
                value
            })
        }
    }

    /**
     * Selection was attempted to be changed but resulted in no action.
     * For example clicking on already selected list item.
     */
    onListItemSelectionNoChange() {
        this.hidePicker();
    }

    /**
     * @param {Object} record
     * @protected
     */
    onListItemNavigate({ activeItem, activeIndex }) {
        if (activeIndex >= 0) {
            const
                me        = this,
                { store } = me;

            me.activeRecord = store.getAt(activeIndex)
            me.activeRecordId = me.activeRecord[store.keyProperty || model.keyProperty]
            me.getInputEl()['aria-activedescendant'] = activeItem;

            // Update typeahead hint (which updates DOM), or update DOM
            me.typeAhead ? me.updateTypeAheadValue(me.lastManualInput) : me.update();
        }
    }

    /**
     * Selecting a record, if required
     * @param {Object[]} items
     */
    onStoreLoad(items) {
        let me    = this,
            value = me.value;

        if (value) {
            me._value = null; // silent update
            me.value  = value
        }
    }

    /**
     *
     */
    selectFirstListItem() {
        this.selectListItem(0)
    }

    /**
     *
     */
    selectLastListItem() {
        this.selectListItem(this.store.getCount() -1)
    }

    /**
     * If no index is passed, the index matching to the field input will get used (0 if none)
     * @param {Number} [index]
     */
    selectListItem(index) {
        let me = this;

        if (!Neo.isNumber(index)) {
            if (me.activeRecordId) {
                index = me.store.indexOfKey(me.activeRecordId);
            } else {
                index = 0;
            }
        }

        me.list.selectItem(index);
    }

    onPickerTriggerClick() {
        let me = this;

        if (me.picker?.isVisible) {
            me.picker.hidden = true;
        }
        else if (!me.readOnly && !me.disabled) {
            me.doFilter(null)
        }
    }

    /**
     * All routes which expect to open the picker route through here. This updates the
     * filter and ensures that the picker is visible and reflecting the state of the filter.
     *
     * Input event processing passes the current input field value in as the filter value.
     *
     * Invocation of the expand trigger passes `null` so as to clear filtering.
     * @private
     * @param {String}null} value The value to filter the picker by
     */
    doFilter(value) {
        let me     = this,
            filter = me.store.getFilter(me.displayField),
            {
                record,
                picker
            }      = me;

        if (filter) {
            filter.value = value;
        }

        // Filter resulting in something to show
        if (me.store.getCount()) {
            me.getPicker().hidden = false;

            // List might not exist until the picker is created
            const
                { list }           = me,
                { selectionModel } = list;

            // On show, set the active item to be the current selected record or the first
            if (record) {
                // We do not want to hear back about our own selection
                selectionModel.suspendEvents = true;
                selectionModel.select(record);
                selectionModel.suspendEvents = false;
            }
            setTimeout(() => {
                list.activeIndex = me.record || 0;
            }, 100)
        }
        // Filtered down to nothing - hide picker if it has been created.
        else if (picker) {
            picker._hidden = true;
        }
    }

    /**
     * @param {Boolean} [silent=false]
     * @protected
     */
    updateTypeAhead(silent=false) {
        let me      = this,
            inputEl = _util_VDom_mjs__WEBPACK_IMPORTED_MODULE_5__["default"].findVdomChild(me.vdom, {flag: 'neo-real-input'}),
            vdom    = me.vdom;

        if (me.typeAhead) {
            inputEl.parentNode.cn[inputEl.index] = {
                tag: 'span',
                cls: ['neo-input-field-wrapper'],
                cn : [{
                    tag         : 'input',
                    autocomplete: 'off',
                    autocorrect : 'off',
                    cls         : ['neo-textfield-input', 'neo-typeahead-input'],
                    disabled    : true,
                    id          : me.getInputHintId(),
                    spellcheck  : 'false'
                }, inputEl.vdom]
            }
        } else {
            _util_VDom_mjs__WEBPACK_IMPORTED_MODULE_5__["default"].replaceVdomChild(vdom, inputEl.parentNode.id, inputEl.vdom)
        }

        !silent && me.update()
    }

    /**
     * @param {String|null} [value=this.lastManualInput]
     * @param {Boolean} [silent=false]
     * @protected
     */
    updateTypeAheadValue(value=this.lastManualInput, silent=false) {
        let me          = this,
            match       = false,
            {
                store,
                displayField
            }
                        = me,
            inputHintEl = me.getInputHintEl();

        if (!me.record && value?.length > 0) {
            const search = value.toLocaleLowerCase();
            match = store.items.find(r => r[displayField]?.toLowerCase?.()?.startsWith(search));

            if (match && inputHintEl) {
                inputHintEl.value = value + match[displayField].substr(value.length);
                me.activeRecord = match;
                me.activeRecordId = match[store.keyProperty || store.model.keyProperty]
            }
        }

        if (!match && inputHintEl) {
            inputHintEl.value = me.activeRecord = me.activeRecordId = null;
        }

        !silent && me.update()
    }
}

/**
 * The select event fires when a list item gets selected
 * @event select
 * @param {Object} record
 * @param {value} record[store.keyProperty]
 * @returns {Object}
 */

Neo.applyClassConfig(Select);

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Select);


/***/ }),

/***/ "./src/form/field/trigger/Picker.mjs":
/*!*******************************************!*\
  !*** ./src/form/field/trigger/Picker.mjs ***!
  \*******************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _Base_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./Base.mjs */ "./src/form/field/trigger/Base.mjs");


/**
 * Used by form.field.Picker
 * @class Neo.form.field.trigger.Picker
 * @extends Neo.form.field.trigger.Base
 */
class Picker extends _Base_mjs__WEBPACK_IMPORTED_MODULE_0__["default"] {
    static config = {
        /**
         * @member {String} className='Neo.form.field.trigger.Picker'
         * @protected
         */
        className: 'Neo.form.field.trigger.Picker',
        /**
         * @member {String} ntype='trigger-picker'
         * @protected
         */
        ntype: 'trigger-picker',
        /**
         * @member {String|null} iconCls='fa fa-caret-down'
         */
        iconCls: 'fa fa-caret-down',
        /**
         * Internal flag used by field.getTrigger()
         * @member {String} type='picker'
         * @protected
         */
        type: 'picker'
    }

    /**
     * @param {Object} data
     */
    onTriggerClick(data) {
        this.field.onPickerTriggerClick();
    } 
}

Neo.applyClassConfig(Picker);

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Picker);


/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2h1bmtzL2FwcC92ZW5kb3JzLXNyY19mb3JtX2ZpZWxkX1NlbGVjdF9tanMuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBcUQ7QUFDSjtBQUNBO0FBQ1Y7O0FBRXZDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCLGlEQUFJO0FBQ3pCO0FBQ0E7QUFDQSxvQkFBb0IsUUFBUTtBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixRQUFRO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLFVBQVU7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsT0FBTztBQUMzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLFFBQVE7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxvQkFBb0IseUJBQXlCO0FBQzdDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsYUFBYTtBQUNqQztBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixhQUFhO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixTQUFTO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsYUFBYTtBQUNqQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLGFBQWE7QUFDakM7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLFNBQVM7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsaUJBQWlCO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQiwyREFBYTtBQUNqQyxTQUFTO0FBQ1Q7O0FBRUE7QUFDQSxlQUFlLFFBQVE7QUFDdkI7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDs7QUFFQTtBQUNBO0FBQ0EsZUFBZSxTQUFTO0FBQ3hCLGVBQWUsU0FBUztBQUN4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFF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QVE7QUFDbkIsV0FBVyxPQUFPO0FBQ2xCLGFBQWE7QUFDYjs7QUFFQTs7QUFFQSxpRUFBZSxNQUFNLEVBQUM7Ozs7Ozs7Ozs7Ozs7Ozs7QUMvckJROztBQUU5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCLGlEQUFJO0FBQ3pCO0FBQ0E7QUFDQSxvQkFBb0IsUUFBUTtBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixRQUFRO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLGFBQWE7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsUUFBUTtBQUM1QjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLGVBQWUsUUFBUTtBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBLGlFQUFlLE1BQU0sRUFBQyIsInNvdXJjZXMiOlsid2VicGFjazovL25lby5tanMvLi9zcmMvZm9ybS9maWVsZC9QaWNrZXIubWpzIiwid2VicGFjazovL25lby5tanMvLi9zcmMvZm9ybS9maWVsZC9TZWxlY3QubWpzIiwid2VicGFjazovL25lby5tanMvLi9zcmMvZm9ybS9maWVsZC90cmlnZ2VyL1BpY2tlci5tanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IENvbnRhaW5lciAgICAgZnJvbSAnLi4vLi4vY29udGFpbmVyL0Jhc2UubWpzJztcbmltcG9ydCBOZW9BcnJheSAgICAgIGZyb20gJy4uLy4uL3V0aWwvQXJyYXkubWpzJztcbmltcG9ydCBQaWNrZXJUcmlnZ2VyIGZyb20gJy4vdHJpZ2dlci9QaWNrZXIubWpzJztcbmltcG9ydCBUZXh0ICAgICAgICAgIGZyb20gJy4vVGV4dC5tanMnO1xuXG4vKipcbiAqIFRoZSBhYnN0cmFjdCBwaWNrZXIgZmllbGQgcHJvdmlkZXMgYW4gYXJyb3cgZG93biB0cmlnZ2VyIHdoaWNoIG9wZW5zIGEgZmxvYXRpbmcgY29udGFpbmVyIHRvIHByb3ZpZGVcbiAqIG1vcmUgZGF0YSBzZWxlY3Rpb24gb3B0aW9uc1xuICogQGNsYXNzIE5lby5mb3JtLmZpZWxkLlBpY2tlclxuICogQGV4dGVuZHMgTmVvLmZvcm0uZmllbGQuVGV4dFxuICogQGFic3RyYWN0XG4gKi9cbmNsYXNzIFBpY2tlciBleHRlbmRzIFRleHQge1xuICAgIHN0YXRpYyBjb25maWcgPSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtTdHJpbmd9IGNsYXNzTmFtZT0nTmVvLmZvcm0uZmllbGQuUGlja2VyJ1xuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICBjbGFzc05hbWU6ICdOZW8uZm9ybS5maWVsZC5QaWNrZXInLFxuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7U3RyaW5nfSBudHlwZT0ncGlja2VyZmllbGQnXG4gICAgICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgICAgICovXG4gICAgICAgIG50eXBlOiAncGlja2VyZmllbGQnLFxuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7U3RyaW5nW119IGJhc2VDbHM9WyduZW8tcGlja2VyZmllbGQnLCduZW8tdGV4dGZpZWxkJ11cbiAgICAgICAgICovXG4gICAgICAgIGJhc2VDbHM6IFsnbmVvLXBpY2tlcmZpZWxkJywgJ25lby10ZXh0ZmllbGQnXSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFN0b3JlcyB0aGUgZGF0YSBmcm9tIHRoZSBnZXRCb3VuZGluZ0NsaWVudFJlY3QoKSBjYWxsIChwaWNrZXIgJiBib2R5IERvbVJlY3RzKVxuICAgICAgICAgKiBAbWVtYmVyIHtBcnJheX0gY2xpZW50UmVjdHM9bnVsbFxuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICBjbGllbnRSZWN0czogbnVsbCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEFkZGl0aW9uYWwgdXNlZCBrZXlzIGZvciB0aGUgc2VsZWN0aW9uIG1vZGVsXG4gICAgICAgICAqIEBtZW1iZXIge09iamVjdH0ga2V5c1xuICAgICAgICAgKi9cbiAgICAgICAga2V5czoge1xuICAgICAgICAgICAgRW50ZXIgOiAnb25LZXlEb3duRW50ZXInLFxuICAgICAgICAgICAgRXNjYXBlOiAnb25LZXlEb3duRXNjYXBlJ1xuICAgICAgICB9LFxuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7TmVvLmNvbnRhaW5lci5CYXNlfG51bGx9IHBpY2tlcj1udWxsXG4gICAgICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgICAgICovXG4gICAgICAgIHBpY2tlcjogbnVsbCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIENvbmZpZ3MgdG8gcGFzcyB0byB0aGUgcGlja2VyIGNvbnRhaW5lclxuICAgICAgICAgKiBAbWVtYmVyIHtPYmplY3R8bnVsbH0gcGlja2VyQ29uZmlnPW51bGxcbiAgICAgICAgICovXG4gICAgICAgIHBpY2tlckNvbmZpZzogbnVsbCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBoZWlnaHQgb2YgdGhlIHBpY2tlciBjb250YWluZXIuIERlZmF1bHRzIHRvIHB4LlxuICAgICAgICAgKiBAbWVtYmVyIHtOdW1iZXJ8bnVsbH0gcGlja2VySGVpZ2h0PTEwMFxuICAgICAgICAgKi9cbiAgICAgICAgcGlja2VySGVpZ2h0OiAxMDAsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtCb29sZWFufSBwaWNrZXJJc01vdW50ZWRfPWZhbHNlXG4gICAgICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgICAgICovXG4gICAgICAgIHBpY2tlcklzTW91bnRlZF86IGZhbHNlLFxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGhlaWdodCBvZiB0aGUgcGlja2VyIGNvbnRhaW5lci4gRGVmYXVsdHMgdG8gcHguXG4gICAgICAgICAqIEBtZW1iZXIge051bWJlcnxudWxsfSBwaWNrZXJNYXhIZWlnaHQ9MjAwXG4gICAgICAgICAqL1xuICAgICAgICBwaWNrZXJNYXhIZWlnaHQ6IDIwMCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSB3aWR0aCBvZiB0aGUgcGlja2VyIGNvbnRhaW5lci4gRGVmYXVsdHMgdG8gcHguXG4gICAgICAgICAqIEJ5IGRlZmF1bHQsIHRoZSB3aWR0aCBvZiB0aGUgcGlja2VyIG1hdGNoZXMgdGhlIHdpZHRoIG9mIHRoZSBpbnB1dCB3cmFwIGVsZW1lbnQuXG4gICAgICAgICAqIEBtZW1iZXIge051bWJlcnxudWxsfSBwaWNrZXJXaWR0aD1udWxsXG4gICAgICAgICAqL1xuICAgICAgICBwaWNrZXJXaWR0aDogbnVsbCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge0Jvb2xlYW59IHNob3dQaWNrZXJPbkZvY3VzPWZhbHNlXG4gICAgICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgICAgICovXG4gICAgICAgIHNob3dQaWNrZXJPbkZvY3VzOiBmYWxzZSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge09iamVjdHxPYmplY3RbXX0gdHJpZ2dlcnM9W11cbiAgICAgICAgICogQHByb3RlY3RlZFxuICAgICAgICAgKi9cbiAgICAgICAgdHJpZ2dlcnM6IFt7XG4gICAgICAgICAgICBtb2R1bGU6IFBpY2tlclRyaWdnZXJcbiAgICAgICAgfV1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gY29uZmlnXG4gICAgICovXG4gICAgY29uc3RydWN0KGNvbmZpZykge1xuICAgICAgICBzdXBlci5jb25zdHJ1Y3QoY29uZmlnKTtcblxuICAgICAgICBsZXQgbWUgPSB0aGlzO1xuXG4gICAgICAgIG1lLmFkZERvbUxpc3RlbmVycyh7XG4gICAgICAgICAgICBjbGljazogbWUub25JbnB1dENsaWNrLFxuICAgICAgICAgICAgc2NvcGU6IG1lXG4gICAgICAgIH0pXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVHJpZ2dlcmVkIGFmdGVyIHRoZSBtb3VudGVkIGNvbmZpZyBnb3QgY2hhbmdlZFxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gdmFsdWVcbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IG9sZFZhbHVlXG4gICAgICogQHByb3RlY3RlZFxuICAgICAqL1xuICAgIGFmdGVyU2V0TW91bnRlZCh2YWx1ZSwgb2xkVmFsdWUpIHtcbiAgICAgICAgaWYgKHZhbHVlID09PSBmYWxzZSAmJiBvbGRWYWx1ZSAmJiB0aGlzLnBpY2tlcklzTW91bnRlZCkge1xuICAgICAgICAgICAgdGhpcy5waWNrZXIuaGlkZSgpXG4gICAgICAgIH1cblxuICAgICAgICBzdXBlci5hZnRlclNldE1vdW50ZWQodmFsdWUsIG9sZFZhbHVlKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRyaWdnZXJlZCBhZnRlciB0aGUgdGhlbWUgY29uZmlnIGdvdCBjaGFuZ2VkXG4gICAgICogQHBhcmFtIHtTdHJpbmd8bnVsbH0gdmFsdWVcbiAgICAgKiBAcGFyYW0ge1N0cmluZ3xudWxsfSBvbGRWYWx1ZVxuICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgKi9cbiAgICBhZnRlclNldFRoZW1lKHZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICBzdXBlci5hZnRlclNldFRoZW1lKHZhbHVlLCBvbGRWYWx1ZSk7XG5cbiAgICAgICAgaWYgKHRoaXMucGlja2VyKSB7XG4gICAgICAgICAgICB0aGlzLnBpY2tlci50aGVtZSA9IHZhbHVlXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcmV0dXJucyB7TmVvLmNvbnRhaW5lci5CYXNlfVxuICAgICAqL1xuICAgIGNyZWF0ZVBpY2tlcigpIHtcbiAgICAgICAgY29uc3RcbiAgICAgICAgICAgIG1lICAgICAgICAgICAgICA9IHRoaXMsXG4gICAgICAgICAgICB7IHBpY2tlcldpZHRoIH0gPSBtZSxcbiAgICAgICAgICAgIHBpY2tlckNvbXBvbmVudCA9IG1lLmNyZWF0ZVBpY2tlckNvbXBvbmVudCgpO1xuXG4gICAgICAgIG1lLnBpY2tlciA9ICBOZW8uY3JlYXRlKENvbnRhaW5lciwge1xuICAgICAgICAgICAgcGFyZW50SWQgOiAnZG9jdW1lbnQuYm9keScsXG4gICAgICAgICAgICBmbG9hdGluZyA6IHRydWUsXG4gICAgICAgICAgICBhbGlnbiAgICA6IHtcbiAgICAgICAgICAgICAgICBlZGdlQWxpZ24gOiBwaWNrZXJXaWR0aCA/ICd0MC1iMCcgOiAndC1iJyxcbiAgICAgICAgICAgICAgICBtYXRjaFNpemUgOiAhcGlja2VyV2lkdGgsXG4gICAgICAgICAgICAgICAgYXhpc0xvY2sgIDogdHJ1ZSxcbiAgICAgICAgICAgICAgICB0YXJnZXQgICAgOiBtZS5nZXRJbnB1dFdyYXBwZXJJZCgpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYXBwTmFtZSAgOiBtZS5hcHBOYW1lLFxuICAgICAgICAgICAgY2xzICAgICAgOiBbJ25lby1waWNrZXItY29udGFpbmVyJywgJ25lby1jb250YWluZXInXSxcbiAgICAgICAgICAgIGhlaWdodCAgIDogbWUucGlja2VySGVpZ2h0LFxuICAgICAgICAgICAgaGlkZGVuICAgOiB0cnVlLFxuICAgICAgICAgICAgaWQgICAgICAgOiBtZS5nZXRQaWNrZXJJZCgpLFxuICAgICAgICAgICAgaXRlbXMgICAgOiBwaWNrZXJDb21wb25lbnQgPyBbcGlja2VyQ29tcG9uZW50XSA6IFtdLFxuICAgICAgICAgICAgbWF4SGVpZ2h0OiBtZS5waWNrZXJNYXhIZWlnaHQsXG4gICAgICAgICAgICB0aGVtZSAgICA6IG1lLnRoZW1lLFxuICAgICAgICAgICAgd2lkdGggICAgOiBwaWNrZXJXaWR0aCxcbiAgICAgICAgICAgIC4uLm1lLnBpY2tlckNvbmZpZyxcblxuICAgICAgICAgICAgLy8gc2NvcGVkIHRvIHRoZSBmaWVsZCBpbnN0YW5jZVxuICAgICAgICAgICAgb25Gb2N1c0xlYXZlOiBkYXRhID0+IHtcbiAgICAgICAgICAgICAgICBsZXQgaW5zaWRlRmllbGQgPSBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgaXRlbTtcblxuICAgICAgICAgICAgICAgIGZvciAoaXRlbSBvZiBkYXRhLm9sZFBhdGgpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uaWQgPT09IG1lLmlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbnNpZGVGaWVsZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVha1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKCFpbnNpZGVGaWVsZCkge1xuICAgICAgICAgICAgICAgICAgICBtZS5oaWRlUGlja2VyKCk7XG4gICAgICAgICAgICAgICAgICAgIHN1cGVyLm9uRm9jdXNMZWF2ZShkYXRhKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgbWUucGlja2VyLm9uKCdoaWRkZW5DaGFuZ2UnLCBtZS5vblBpY2tlckhpZGRlbkNoYW5nZSwgbWUpO1xuXG4gICAgICAgIHJldHVybiBtZS5waWNrZXJcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBPdmVycmlkZSB0aGlzIG1ldGhvZCB0byBjcmVhdGUgeW91ciBwaWNrZXIgY29udGVudCBhcyBuZWVkZWRcbiAgICAgKiBAcmV0dXJucyB7TmVvLmNvbXBvbmVudC5CYXNlfG51bGx9XG4gICAgICovXG4gICAgY3JlYXRlUGlja2VyQ29tcG9uZW50KCkge1xuICAgICAgICByZXR1cm4gbnVsbFxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSBhcmdzXG4gICAgICovXG4gICAgZGVzdHJveSguLi5hcmdzKSB7XG4gICAgICAgIGxldCBwaWNrZXIgPSB0aGlzLnBpY2tlcjtcblxuICAgICAgICBpZiAocGlja2VyPy5oaWRkZW4gPT09IGZhbHNlKSB7XG4gICAgICAgICAgICBwaWNrZXIudW5tb3VudCgpXG4gICAgICAgIH1cblxuICAgICAgICBwaWNrZXI/LmRlc3Ryb3koKTtcbiAgICAgICAgc3VwZXIuZGVzdHJveSguLi5hcmdzKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdGhlIHBpY2tlciBpbnN0YW5jZSBhbmQgY3JlYXRlcyBpdCBpbiBjYXNlIGl0IGRvZXMgbm90IGV4aXN0IHlldFxuICAgICAqIEByZXR1cm5zIHtOZW8uY29udGFpbmVyLkJhc2V9XG4gICAgICovXG4gICAgZ2V0UGlja2VyKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5waWNrZXIgfHwgdGhpcy5jcmVhdGVQaWNrZXIoKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEByZXR1cm5zIHtTdHJpbmd9XG4gICAgICovXG4gICAgZ2V0UGlja2VySWQoKSB7XG4gICAgICAgIHJldHVybiBgJHt0aGlzLmlkfV9fcGlja2VyYFxuICAgIH1cblxuICAgIC8qKlxuICAgICAqXG4gICAgICovXG4gICAgYXN5bmMgaGlkZVBpY2tlcigpIHtcbiAgICAgICAgaWYgKHRoaXMucGlja2VyKSB7XG4gICAgICAgICAgICB0aGlzLnBpY2tlci5oaWRkZW4gPSB0cnVlXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gZGF0YVxuICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgKi9cbiAgICBvbkZvY3VzRW50ZXIoZGF0YSkge1xuICAgICAgICBzdXBlci5vbkZvY3VzRW50ZXIoZGF0YSk7XG5cbiAgICAgICAgbGV0IG1lID0gdGhpcztcblxuICAgICAgICBtZS5zaG93UGlja2VyT25Gb2N1cyAmJiBtZS5zaG93UGlja2VyKClcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gZGF0YVxuICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgKi9cbiAgICBvbkZvY3VzTGVhdmUoZGF0YSkge1xuICAgICAgICBsZXQgbWUgICAgICAgICAgID0gdGhpcyxcbiAgICAgICAgICAgIGluc2lkZVBpY2tlciA9IGZhbHNlLFxuICAgICAgICAgICAgaXRlbTtcblxuICAgICAgICBmb3IgKGl0ZW0gb2YgZGF0YS5vbGRQYXRoKSB7XG4gICAgICAgICAgICBpZiAoaXRlbS5pZCA9PT0gbWUuZ2V0UGlja2VySWQoKSkge1xuICAgICAgICAgICAgICAgIGluc2lkZVBpY2tlciA9IHRydWU7XG4gICAgICAgICAgICAgICAgYnJlYWtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghaW5zaWRlUGlja2VyKSB7XG4gICAgICAgICAgICBtZS5oaWRlUGlja2VyKCk7XG4gICAgICAgICAgICBzdXBlci5vbkZvY3VzTGVhdmUoZGF0YSlcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhXG4gICAgICovXG4gICAgb25JbnB1dENsaWNrKGRhdGEpIHtcbiAgICAgICAgIXRoaXMuZWRpdGFibGUgJiYgdGhpcy50b2dnbGVQaWNrZXIoKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2NhbGxiYWNrXVxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbY2FsbGJhY2tTY29wZV1cbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICovXG4gICAgb25LZXlEb3duRW50ZXIoZGF0YSwgY2FsbGJhY2ssIGNhbGxiYWNrU2NvcGUpIHtcbiAgICAgICAgIXRoaXMucGlja2VySXNNb3VudGVkICYmIHRoaXMuc2hvd1BpY2tlcihjYWxsYmFjaywgY2FsbGJhY2tTY29wZSlcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gZGF0YVxuICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgKi9cbiAgICBvbktleURvd25Fc2NhcGUoZGF0YSkge1xuICAgICAgICB0aGlzLnBpY2tlcklzTW91bnRlZCAmJiB0aGlzLmhpZGVQaWNrZXIoKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IGRhdGEuaWRcbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IGRhdGEub2xkVmFsdWVcbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IGRhdGEudmFsdWVcbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICovXG4gICAgb25QaWNrZXJIaWRkZW5DaGFuZ2UoZGF0YSkge1xuICAgICAgICB0aGlzLnBpY2tlcklzTW91bnRlZCA9ICFkYXRhLnZhbHVlXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2FsbGVkIGJ5IGZvcm0uZmllbGQudHJpZ2dlci5QaWNrZXJcbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICovXG4gICAgb25QaWNrZXJUcmlnZ2VyQ2xpY2soKSB7XG4gICAgICAgIHRoaXMuZWRpdGFibGUgJiYgdGhpcy50b2dnbGVQaWNrZXIoKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqXG4gICAgICovXG4gICAgc2hvd1BpY2tlcigpIHtcbiAgICAgICAgdGhpcy5nZXRQaWNrZXIoKS5oaWRkZW4gPSBmYWxzZVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqXG4gICAgICovXG4gICAgdG9nZ2xlUGlja2VyKCkge1xuICAgICAgICBsZXQgcGlja2VyID0gdGhpcy5nZXRQaWNrZXIoKTtcbiAgICAgICAgcGlja2VyLmhpZGRlbiA9ICFwaWNrZXIuaGlkZGVuXG4gICAgfVxufVxuXG5OZW8uYXBwbHlDbGFzc0NvbmZpZyhQaWNrZXIpO1xuXG5leHBvcnQgZGVmYXVsdCBQaWNrZXI7XG4iLCJpbXBvcnQgQ2xhc3NTeXN0ZW1VdGlsICBmcm9tICcuLi8uLi91dGlsL0NsYXNzU3lzdGVtLm1qcyc7XG5pbXBvcnQgQ29tcG9uZW50TWFuYWdlciBmcm9tICcuLi8uLi9tYW5hZ2VyL0NvbXBvbmVudC5tanMnO1xuaW1wb3J0IExpc3QgICAgICAgICAgICAgZnJvbSAnLi4vLi4vbGlzdC9CYXNlLm1qcyc7XG5pbXBvcnQgUGlja2VyICAgICAgICAgICBmcm9tICcuL1BpY2tlci5tanMnO1xuaW1wb3J0IFN0b3JlICAgICAgICAgICAgZnJvbSAnLi4vLi4vZGF0YS9TdG9yZS5tanMnO1xuaW1wb3J0IFZEb21VdGlsICAgICAgICAgZnJvbSAnLi4vLi4vdXRpbC9WRG9tLm1qcyc7XG5pbXBvcnQgeyBidWZmZXIgfSAgICAgICBmcm9tICcuLi8uLi91dGlsL0Z1bmN0aW9uLm1qcyc7XG4vKipcbiAqIFByb3ZpZGVzIGEgZHJvcGRvd24gbGlzdCB0byBzZWxlY3Qgb25lIG9yIG11bHRpcGxlIGl0ZW1zLlxuICpcbiAqIENvbmZvcm1zIHRvIEFSSUEgYWNjZXNzaWJsaXR5IHN0YW5kYXJkcyBvdXRsaW5lcyBpbiBodHRwczovL3d3dy53My5vcmcvV0FJL0FSSUEvYXBnL3BhdHRlcm5zL2NvbWJvYm94L1xuICogQGNsYXNzIE5lby5mb3JtLmZpZWxkLlNlbGVjdFxuICogQGV4dGVuZHMgTmVvLmZvcm0uZmllbGQuUGlja2VyXG4gKi9cbmNsYXNzIFNlbGVjdCBleHRlbmRzIFBpY2tlciB7XG4gICAgLyoqXG4gICAgICogVmFsaWQgdmFsdWVzIGZvciB0cmlnZ2VyQWN0aW9uXG4gICAgICogQG1lbWJlciB7U3RyaW5nW119IHRyaWdnZXJBY3Rpb25zPVsnYWxsJywnZmlsdGVyZWQnXVxuICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgKiBAc3RhdGljXG4gICAgICovXG4gICAgc3RhdGljIHRyaWdnZXJBY3Rpb25zID0gWydhbGwnLCAnZmlsdGVyZWQnXVxuXG4gICAgc3RhdGljIGNvbmZpZyA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge1N0cmluZ30gY2xhc3NOYW1lPSdOZW8uZm9ybS5maWVsZC5TZWxlY3QnXG4gICAgICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgICAgICovXG4gICAgICAgIGNsYXNzTmFtZTogJ05lby5mb3JtLmZpZWxkLlNlbGVjdCcsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtTdHJpbmd9IG50eXBlPSdzZWxlY3RmaWVsZCdcbiAgICAgICAgICogQHByb3RlY3RlZFxuICAgICAgICAgKi9cbiAgICAgICAgbnR5cGU6ICdzZWxlY3RmaWVsZCcsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtTdHJpbmdbXX0gYmFzZUNscz1bJ25lby1zZWxlY3RmaWVsZCcsJ25lby1waWNrZXJmaWVsZCcsJ25lby10ZXh0ZmllbGQnXVxuICAgICAgICAgKi9cbiAgICAgICAgYmFzZUNsczogWyduZW8tc2VsZWN0ZmllbGQnLCAnbmVvLXBpY2tlcmZpZWxkJywgJ25lby10ZXh0ZmllbGQnXSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge1N0cmluZ30gZGlzcGxheUZpZWxkPSduYW1lJ1xuICAgICAgICAgKi9cbiAgICAgICAgZGlzcGxheUZpZWxkOiAnbmFtZScsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtTdHJpbmd9IGZpbHRlck9wZXJhdG9yXz0nbGlrZSdcbiAgICAgICAgICovXG4gICAgICAgIGZpbHRlck9wZXJhdG9yXzogJ2xpa2UnLFxuICAgICAgICAvKipcbiAgICAgICAgICogVHJ1ZSB3aWxsIG9ubHkgZmlyZSBhIGNoYW5nZSBldmVudCwgaW4gY2FzZSB0aGUgVGV4dEZpZWxkIGlucHV0IHZhbHVlIG1hdGNoZXMgYSByZWNvcmQuXG4gICAgICAgICAqIG9uRm9jdXNMZWF2ZSgpIHdpbGwgdHJ5IHRvIHNlbGVjdCBhIGhpbnQgcmVjb3JkLCBpZiBuZWVkZWQgYW5kIHBvc3NpYmxlLlxuICAgICAgICAgKiBAbWVtYmVyIHtCb29sZWFufSBmb3JjZVNlbGVjdGlvbj1mYWxzZVxuICAgICAgICAgKi9cbiAgICAgICAgZm9yY2VTZWxlY3Rpb246IGZhbHNlLFxuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7U3RyaW5nfE51bWJlcnxudWxsfSBhY3RpdmVSZWNvcmRJZD1udWxsXG4gICAgICAgICAqL1xuICAgICAgICBhY3RpdmVSZWNvcmRJZDogbnVsbCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEFkZGl0aW9uYWwgdXNlZCBrZXlzIGZvciB0aGUgc2VsZWN0aW9uIG1vZGVsXG4gICAgICAgICAqIEBtZW1iZXIge09iamVjdH0ga2V5c1xuICAgICAgICAgKi9cbiAgICAgICAga2V5czoge1xuICAgICAgICAgICAgRG93biAgOiAnb25LZXlEb3duRG93bicsXG4gICAgICAgICAgICBFc2NhcGU6ICdvbktleURvd25Fc2NhcGUnXG4gICAgICAgIH0sXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtTdHJpbmd8bnVsbH0gbGFzdE1hbnVhbElucHV0PW51bGxcbiAgICAgICAgICogQHByb3RlY3RlZFxuICAgICAgICAgKi9cbiAgICAgICAgbGFzdE1hbnVhbElucHV0OiBudWxsLFxuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7TmVvLmxpc3QuQmFzZX0gbGlzdD1udWxsXG4gICAgICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgICAgICovXG4gICAgICAgIGxpc3Q6IG51bGwsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtPYmplY3R8bnVsbH0gbGlzdENvbmZpZ189bnVsbFxuICAgICAgICAgKi9cbiAgICAgICAgbGlzdENvbmZpZ186IG51bGwsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgaGVpZ2h0IG9mIHRoZSBwaWNrZXIgY29udGFpbmVyLiBEZWZhdWx0cyB0byBweC5cbiAgICAgICAgICogQG1lbWJlciB7TnVtYmVyfG51bGx9IHBpY2tlckhlaWdodD1udWxsXG4gICAgICAgICAqL1xuICAgICAgICBwaWNrZXJIZWlnaHQ6IG51bGwsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtPYmplY3R9IHJlY29yZF89bnVsbFxuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICByZWNvcmRfOiBudWxsLFxuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7U3RyaW5nfG51bGx9IHJvbGU9J2NvbWJvYm94J1xuICAgICAgICAgKi9cbiAgICAgICAgcm9sZTogJ2NvbWJvYm94JyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge05lby5kYXRhLlN0b3JlfG51bGx9IHN0b3JlXz1udWxsXG4gICAgICAgICAqL1xuICAgICAgICBzdG9yZV86IG51bGwsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTaG93aW5nIHRoZSBsaXN0IHZpYSB0aGUgZG93biB0cmlnZ2VyIGNhbiBlaXRoZXIgc2hvdyBhbGwgbGlzdCBpdGVtcyBvciBvbmx5IHNob3cgaXRlbXMgd2hpY2hcbiAgICAgICAgICogbWF0Y2ggdGhlIGZpbHRlciBzdHJpbmcgaW5zaWRlIHRoZSBpbnB1dCBmaWVsZC5cbiAgICAgICAgICogVmFsaWQgdmFsdWVzOiBhbGwsIGZpbHRlcmVkXG4gICAgICAgICAqIEBtZW1iZXIge1N0cmluZ30gdHJpZ2dlckFjdGlvbl89J2FsbCdcbiAgICAgICAgICovXG4gICAgICAgIHRyaWdnZXJBY3Rpb25fOiAnYWxsJyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIERpc3BsYXkgdGhlIGZpcnN0IG1hdGNoaW5nIHJlc3VsdCB3aGlsZSB0eXBpbmdcbiAgICAgICAgICogQG1lbWJlciB7Qm9vbGVhbn0gdHlwZUFoZWFkXz10cnVlXG4gICAgICAgICAqL1xuICAgICAgICB0eXBlQWhlYWRfOiB0cnVlLFxuICAgICAgICAvKipcbiAgICAgICAgICogU2V0IHRoaXMgY29uZmlnIHRvIGZhbHNlLCBpbiBjYXNlIHR5cGluZyBpbnRvIHRoZSBpbnB1dCBmaWVsZCBzaG91bGQgbm90IGZpbHRlciBsaXN0IGl0ZW1zXG4gICAgICAgICAqIEBtZW1iZXIge0Jvb2xlYW59IHVzZUZpbHRlcl89dHJ1ZVxuICAgICAgICAgKi9cbiAgICAgICAgdXNlRmlsdGVyXzogdHJ1ZSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoaXMgY29uZmlnIHNob3VsZCBwb2ludCB0byB0aGUgc3RvcmUga2V5UHJvcGVydHkgb3IgYSBkaWZmZXJlbnQgbW9kZWwgZmllbGQsXG4gICAgICAgICAqIHdoaWNoIHlvdSB3YW50IHRvIHN1Ym1pdCBpbnN0ZWFkXG4gICAgICAgICAqIEBtZW1iZXIge051bWJlcnxTdHJpbmd9IHZhbHVlRmllbGQ9J2lkJ1xuICAgICAgICAgKi9cbiAgICAgICAgdmFsdWVGaWVsZDogJ2lkJyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBtaWxsaXNlY29uZCB0aW1lIHRvIGRlbGF5IGJldHdlZW4gaW5wdXQgZmllbGQgbXV0YXRpb24gYW5kIGFwcGx5aW5nIHRoZSBpbnB1dCBmaWVsZCdzXG4gICAgICAgICAqIG5ldyB2YWx1ZSB0byB0aGUgZmlsdGVyXG4gICAgICAgICAqIEBtZW1iZXIge051bWJlcn0gZmlsdGVyRGVsYXk9MzAwXG4gICAgICAgICAqL1xuICAgICAgICBmaWx0ZXJEZWxheSA6IDMwMFxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjb25maWdcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3QoY29uZmlnKSB7XG4gICAgICAgIHN1cGVyLmNvbnN0cnVjdChjb25maWcpO1xuXG4gICAgICAgIC8vIENyZWF0ZSBidWZmZXJlZCBmdW5jdGlvbiB0byByZXNwb25kIHRvIGlucHV0IGZpZWxkIG11dGF0aW9uXG4gICAgICAgIHRoaXMuZmlsdGVyT25JbnB1dCA9IGJ1ZmZlcih0aGlzLmZpbHRlck9uSW5wdXQsIHRoaXMsIHRoaXMuZmlsdGVyRGVsYXkpO1xuXG4gICAgICAgIHRoaXMudHlwZUFoZWFkICYmIHRoaXMudXBkYXRlVHlwZUFoZWFkKClcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUcmlnZ2VyZWQgYWZ0ZXIgdGhlIHJlY29yZCBjb25maWcgZ290IGNoYW5nZWRcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gdmFsdWVcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2xkVmFsdWVcbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICovXG4gICAgYWZ0ZXJTZXRSZWNvcmQodmFsdWUpIHtcbiAgICAgICAgaWYgKHRoaXMuX3BpY2tlcj8uaXNWaXNpYmxlKSB7XG4gICAgICAgICAgICBsZXQgbWUgICAgICAgICAgICAgPSB0aGlzLFxuICAgICAgICAgICAgICAgIHNlbGVjdGlvbk1vZGVsID0gbWUubGlzdD8uc2VsZWN0aW9uTW9kZWw7XG5cbiAgICAgICAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICAgICAgICAgIHNlbGVjdGlvbk1vZGVsPy5zZWxlY3QodmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgc2VsZWN0aW9uTW9kZWwuZGVzZWxlY3RBbGwoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRyaWdnZXJlZCBhZnRlciB0aGUgc3RvcmUgY29uZmlnIGdvdCBjaGFuZ2VkXG4gICAgICogQHBhcmFtIHtOZW8uZGF0YS5TdG9yZX0gdmFsdWVcbiAgICAgKiBAcGFyYW0ge05lby5kYXRhLlN0b3JlfSBvbGRWYWx1ZVxuICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgKi9cbiAgICBhZnRlclNldFN0b3JlKHZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICBsZXQgbWUgPSB0aGlzLFxuICAgICAgICAgICAgZmlsdGVycztcblxuICAgICAgICBpZiAodmFsdWUpIHtcbiAgICAgICAgICAgIGlmIChtZS51c2VGaWx0ZXIpIHtcbiAgICAgICAgICAgICAgICBmaWx0ZXJzID0gdmFsdWUuZmlsdGVycyB8fCBbXTtcblxuICAgICAgICAgICAgICAgIGZpbHRlcnMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIGluY2x1ZGVFbXB0eVZhbHVlczogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgb3BlcmF0b3IgICAgICAgICAgOiBtZS5maWx0ZXJPcGVyYXRvcixcbiAgICAgICAgICAgICAgICAgICAgcHJvcGVydHkgICAgICAgICAgOiBtZS5kaXNwbGF5RmllbGQsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlICAgICAgICAgICAgIDogdmFsdWUuZ2V0KG1lLnZhbHVlKT8uW21lLmRpc3BsYXlGaWVsZF0gfHwgbWUudmFsdWVcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHZhbHVlLmZpbHRlcnMgPSBmaWx0ZXJzXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChtZS5saXN0KSB7XG4gICAgICAgICAgICAgICAgbWUubGlzdC5zdG9yZSA9IHZhbHVlXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhbHVlLm9uKCdsb2FkJywgbWUub25TdG9yZUxvYWQsIG1lKVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVHJpZ2dlcmVkIGFmdGVyIHRoZSB0eXBlQWhlYWQgY29uZmlnIGdvdCBjaGFuZ2VkXG4gICAgICogQHBhcmFtIHtCb29sZWFufSB2YWx1ZVxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gb2xkVmFsdWVcbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICovXG4gICAgYWZ0ZXJTZXRUeXBlQWhlYWQodmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgIHRoaXMucmVuZGVyZWQgJiYgdGhpcy51cGRhdGVUeXBlQWhlYWQoKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRyaWdnZXJlZCBiZWZvcmUgdGhlIGxpc3RDb25maWcgY29uZmlnIGdldHMgY2hhbmdlZC5cbiAgICAgKiBAcGFyYW0ge09iamVjdH0gdmFsdWVcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2xkVmFsdWVcbiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fVxuICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgKi9cbiAgICBiZWZvcmVTZXRMaXN0Q29uZmlnKHZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICB2YWx1ZSAmJiB0aGlzLnBhcnNlSXRlbUNvbmZpZ3ModmFsdWUpO1xuICAgICAgICByZXR1cm4gdmFsdWVcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUcmlnZ2VyZWQgYmVmb3JlIHRoZSBzdG9yZSBjb25maWcgZ2V0cyBjaGFuZ2VkLlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fE5lby5kYXRhLlN0b3JlfG51bGx9IHZhbHVlXG4gICAgICogQHBhcmFtIHtOZW8uZGF0YS5TdG9yZX0gb2xkVmFsdWVcbiAgICAgKiBAcmV0dXJucyB7TmVvLmRhdGEuU3RvcmV9XG4gICAgICogQHByb3RlY3RlZFxuICAgICAqL1xuICAgIGJlZm9yZVNldFN0b3JlKHZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICBvbGRWYWx1ZT8uZGVzdHJveSgpO1xuXG4gICAgICAgIC8vIHRvIHJlZHVjZSBib2lsZXJwbGF0ZSBjb2RlLCBhIHN0b3JlIGNvbmZpZyBvYmplY3Qgd2l0aG91dCBhIGRlZmluZWQgbW9kZWwgc2hvdWxkIGRlZmF1bHRcbiAgICAgICAgLy8gdG8gZGlzcGxheUZpZWxkICYgdmFsdWVGaWVsZCBkZWZhdWx0c1xuICAgICAgICBpZiAoTmVvLnR5cGVPZih2YWx1ZSkgPT09ICdPYmplY3QnICYmICF2YWx1ZS5tb2RlbCAmJiAhdmFsdWUubW9kdWxlICYmICF2YWx1ZS5udHlwZSkge1xuICAgICAgICAgICAgdmFsdWUubW9kZWwgPSB7XG4gICAgICAgICAgICAgICAgZmllbGRzOiBbXG4gICAgICAgICAgICAgICAgICAgIHtuYW1lOiAnaWQnLCAgIHR5cGU6ICdTdHJpbmcnfSxcbiAgICAgICAgICAgICAgICAgICAge25hbWU6ICduYW1lJywgdHlwZTogJ1N0cmluZyd9XG4gICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIENsYXNzU3lzdGVtVXRpbC5iZWZvcmVTZXRJbnN0YW5jZSh2YWx1ZSwgU3RvcmUpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVHJpZ2dlcmVkIGJlZm9yZSB0aGUgdHJpZ2dlckFjdGlvbiBjb25maWcgZ2V0cyBjaGFuZ2VkXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHZhbHVlXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IG9sZFZhbHVlXG4gICAgICogQHByb3RlY3RlZFxuICAgICAqL1xuICAgIGJlZm9yZVNldFRyaWdnZXJBY3Rpb24odmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmJlZm9yZVNldEVudW1WYWx1ZSh2YWx1ZSwgb2xkVmFsdWUsICd0cmlnZ2VyQWN0aW9uJylcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUcmlnZ2VyZWQgYmVmb3JlIHRoZSB2YWx1ZSBjb25maWcgZ2V0cyBjaGFuZ2VkLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfFN0cmluZ3xudWxsfSB2YWx1ZVxuICAgICAqIEBwYXJhbSB7TnVtYmVyfFN0cmluZ3xudWxsfSBvbGRWYWx1ZVxuICAgICAqIEByZXR1cm5zIHtOdW1iZXJ8U3RyaW5nfG51bGx9XG4gICAgICogQHByb3RlY3RlZFxuICAgICAqL1xuICAgIGJlZm9yZVNldFZhbHVlKHZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICBsZXQgbWUgICAgICAgICAgID0gdGhpcyxcbiAgICAgICAgICAgIGRpc3BsYXlGaWVsZCA9IG1lLmRpc3BsYXlGaWVsZCxcbiAgICAgICAgICAgIHN0b3JlICAgICAgICA9IG1lLnN0b3JlLFxuICAgICAgICAgICAgcmVjb3JkO1xuXG4gICAgICAgIGlmIChOZW8uaXNPYmplY3QodmFsdWUpKSB7XG4gICAgICAgICAgICBtZS5yZWNvcmQgPSB2YWx1ZTtcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZVtkaXNwbGF5RmllbGRdO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVjb3JkID0gc3RvcmUuaXNGaWx0ZXJlZCgpID8gc3RvcmUuYWxsSXRlbXMuZ2V0KHZhbHVlKSA6IHN0b3JlLmdldCh2YWx1ZSk7XG5cbiAgICAgICAgICAgIGlmIChyZWNvcmQpIHtcbiAgICAgICAgICAgICAgICBtZS5yZWNvcmQgPSByZWNvcmQ7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlY29yZFtkaXNwbGF5RmllbGRdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgbWUucmVjb3JkID0gc3RvcmUuZmluZChkaXNwbGF5RmllbGQsIHZhbHVlKVswXSB8fCBudWxsO1xuXG4gICAgICAgIHJldHVybiB2YWx1ZVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEByZXR1cm5zIHtOZW8ubGlzdC5CYXNlfVxuICAgICAqL1xuICAgIGNyZWF0ZVBpY2tlckNvbXBvbmVudCgpIHtcbiAgICAgICAgY29uc3QgbWUgPSB0aGlzO1xuXG4gICAgICAgIG1lLmxpc3QgPSBOZW8uY3JlYXRlKHtcbiAgICAgICAgICAgIG1vZHVsZSAgICAgICAgICA6IExpc3QsXG4gICAgICAgICAgICBhcHBOYW1lICAgICAgICAgOiBtZS5hcHBOYW1lLFxuICAgICAgICAgICAgZGlzcGxheUZpZWxkICAgIDogbWUuZGlzcGxheUZpZWxkLFxuICAgICAgICAgICAgcm9sZSAgICAgICAgICAgIDogJ2xpc3Rib3gnLFxuICAgICAgICAgICAgaXRlbVJvbGUgICAgICAgIDogJ29wdGlvbicsXG4gICAgICAgICAgICBwYXJlbnRJZCAgICAgICAgOiBtZS5pZCxcbiAgICAgICAgICAgIG5hdmlnYXRvciAgICAgICA6IHtcbiAgICAgICAgICAgICAgICBldmVudFNvdXJjZSA6IG1lLmdldElucHV0RWxJZCgpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2VsZWN0aW9uTW9kZWwgIDoge3N0YXlJbkxpc3Q6IGZhbHNlfSxcbiAgICAgICAgICAgIHN0b3JlICAgICAgICAgICA6IG1lLnN0b3JlLFxuICAgICAgICAgICAgLi4ubWUubGlzdENvbmZpZ1xuICAgICAgICB9KTtcbiAgICAgICAgbWUuZ2V0SW5wdXRFbCgpWydhcmlhLWNvbnRyb2xzJ10gPSBtZS5saXN0LmlkO1xuXG4gICAgICAgIG1lLmxpc3QuYWRkRG9tTGlzdGVuZXJzKHtcbiAgICAgICAgICAgIG5lb25hdmlnYXRlOiB7XG4gICAgICAgICAgICAgICAgZm4gICAgOiBtZS5vbkxpc3RJdGVtTmF2aWdhdGUsXG4gICAgICAgICAgICAgICAgc2NvcGUgOiBtZVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgbWUubGlzdC5zZWxlY3Rpb25Nb2RlbC5vbih7XG4gICAgICAgICAgICBzZWxlY3Rpb25DaGFuZ2UgOiBtZS5vbkxpc3RJdGVtU2VsZWN0aW9uQ2hhbmdlLFxuICAgICAgICAgICAgbm9DaGFuZ2UgICAgICAgIDogbWUub25MaXN0SXRlbVNlbGVjdGlvbk5vQ2hhbmdlLFxuICAgICAgICAgICAgc2NvcGUgICAgICAgICAgIDogbWVcbiAgICAgICAgfSlcblxuICAgICAgICByZXR1cm4gbWUubGlzdDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBPdmVycmlkZXMgZm9ybS5maWVsZC5CYXNlXG4gICAgICogQHBhcmFtIHsqfSB2YWx1ZVxuICAgICAqIEBwYXJhbSB7Kn0gb2xkVmFsdWVcbiAgICAgKiBAb3ZlcnJpZGVcbiAgICAgKi9cbiAgICBmaXJlQ2hhbmdlRXZlbnQodmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgIGxldCBtZSAgICAgICAgICAgID0gdGhpcyxcbiAgICAgICAgICAgIEZvcm1Db250YWluZXIgPSBOZW8uZm9ybT8uQ29udGFpbmVyLFxuICAgICAgICAgICAgcmVjb3JkICAgICAgICA9IG1lLnJlY29yZCxcbiAgICAgICAgICAgIG9sZFJlY29yZCwgcGFyYW1zO1xuXG4gICAgICAgIGlmICghKG1lLmZvcmNlU2VsZWN0aW9uICYmICFyZWNvcmQpKSB7XG4gICAgICAgICAgICBvbGRSZWNvcmQgPSBtZS5zdG9yZS5nZXQob2xkVmFsdWUpIHx8IG51bGw7XG5cbiAgICAgICAgICAgIHBhcmFtcyA9IHtcbiAgICAgICAgICAgICAgICBjb21wb25lbnQ6IG1lLFxuICAgICAgICAgICAgICAgIG9sZFJlY29yZCxcbiAgICAgICAgICAgICAgICBvbGRWYWx1ZSxcbiAgICAgICAgICAgICAgICByZWNvcmQsXG4gICAgICAgICAgICAgICAgdmFsdWVcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIG1lLmZpcmUoJ2NoYW5nZScsIHBhcmFtcyk7XG5cbiAgICAgICAgICAgIGlmICghbWUuc3VzcGVuZEV2ZW50cykge1xuICAgICAgICAgICAgICAgIENvbXBvbmVudE1hbmFnZXIuZ2V0UGFyZW50cyhtZSkuZm9yRWFjaChwYXJlbnQgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoRm9ybUNvbnRhaW5lciAmJiBwYXJlbnQgaW5zdGFuY2VvZiBGb3JtQ29udGFpbmVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQuZmlyZSgnZmllbGRDaGFuZ2UnLCBwYXJhbXMpXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHJldHVybnMge09iamVjdH1cbiAgICAgKi9cbiAgICBnZXRJbnB1dEhpbnRFbCgpIHtcbiAgICAgICAgcmV0dXJuIFZEb21VdGlsLmZpbmRWZG9tQ2hpbGQodGhpcy52ZG9tLCB0aGlzLmdldElucHV0SGludElkKCkpPy52ZG9tXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHJldHVybnMge1N0cmluZ31cbiAgICAgKi9cbiAgICBnZXRJbnB1dEhpbnRJZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaWQgKyAnX19pbnB1dC1oaW50J1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdGhlIGZpcnN0IHNlbGVjdGVkIHJlY29yZCBvciBudWxsXG4gICAgICogcmV0dXJucyB7T2JqZWN0fVxuICAgICAqL1xuICAgIGdldFJlY29yZCgpIHtcbiAgICAgICAgbGV0IGxpc3QgICAgICA9IHRoaXMubGlzdCxcbiAgICAgICAgICAgIHJlY29yZEtleSA9IGxpc3Quc2VsZWN0aW9uTW9kZWwuZ2V0U2VsZWN0aW9uKClbMF07XG5cbiAgICAgICAgcmV0dXJuIHJlY29yZEtleSAmJiB0aGlzLnN0b3JlLmdldChsaXN0LmdldEl0ZW1SZWNvcmRJZChyZWNvcmRLZXkpKSB8fCBudWxsXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHJldHVybnMge051bWJlcnxTdHJpbmd9XG4gICAgICovXG4gICAgZ2V0VmFsdWUoKSB7XG4gICAgICAgIGxldCBtZSA9IHRoaXM7XG5cbiAgICAgICAgcmV0dXJuIG1lLnJlY29yZD8uW21lLnZhbHVlRmllbGRdIHx8IG1lLnZhbHVlXG4gICAgfVxuXG4gICAgb25Db25zdHJ1Y3RlZCgpIHtcbiAgICAgICAgY29uc3QgaW5wdXRFbCA9IHRoaXMuZ2V0SW5wdXRFbCgpO1xuXG4gICAgICAgIGlucHV0RWxbJ2FyaWEtZXhwYW5kZWQnXSA9IGZhbHNlXG4gICAgICAgIGlucHV0RWxbJ2FyaWEtaGFzcG9wdXAnXSA9ICdsaXN0Ym94J1xuICAgICAgICBpbnB1dEVsWydhcmlhLWFjdGl2ZWRlc2NlbmRhbnQnXSA9ICcnXG4gICAgICAgIHN1cGVyLm9uQ29uc3RydWN0ZWQoLi4uYXJndW1lbnRzKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gZGF0YVxuICAgICAqIEBwYXJhbSB7T2JqZWN0W119IGRhdGEub2xkUGF0aFxuICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgKi9cbiAgICBvbkZvY3VzTGVhdmUoZGF0YSkge1xuICAgICAgICBsZXQgbWUgPSB0aGlzO1xuXG4gICAgICAgIGlmICghbWUucmVjb3JkKSB7XG4gICAgICAgICAgICBpZiAobWUuZm9yY2VTZWxlY3Rpb24pIHtcbiAgICAgICAgICAgICAgICBtZS52YWx1ZSA9IG1lLmZvcmNlU2VsZWN0aW9uID8gbWUuYWN0aXZlUmVjb3JkSWQgOiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gSWYgd2UgZXhpdCB3aXRob3V0IHNlbGVjdGluZyBhIHJlY29yZCwgY2xlYXIgdGhlIGZpbHRlciBpbnB1dCB2YWx1ZS5cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIG1lLmdldElucHV0RWwoKS52YWx1ZSA9ICcnO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ2xlYXIgYW55IHR5cGVhaGVhZCBoaW50XG4gICAgICAgIG1lLnVwZGF0ZVR5cGVBaGVhZFZhbHVlKCcnKTtcblxuICAgICAgICAvLyBUaGUgVkRPTSBtdXN0IG5vdCBjYXJyeSB0aGUgZW1wdHkgc3RyaW5nIHBlcm1hbmVudGx5LiBPbmx5IHdoaWxlIGNsZWFyaW5nIHRoZSB2YWx1ZS5cbiAgICAgICAgaWYgKCFtZS5yZWNvcmQgJiYgIW1lLmZvcmNlU2VsZWN0aW9uKSB7XG4gICAgICAgICAgICBkZWxldGUgbWUuZ2V0SW5wdXRFbCgpLnZhbHVlO1xuICAgICAgICB9XG5cbiAgICAgICAgc3VwZXIub25Gb2N1c0xlYXZlKGRhdGEpXG4gICAgfVxuXG4gICAgZmlsdGVyT25JbnB1dChkYXRhKSB7XG4gICAgICAgIGlmIChkYXRhLnZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLmRvRmlsdGVyKGRhdGEudmFsdWUpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHRoaXMucGlja2VyKSB7XG4gICAgICAgICAgICB0aGlzLnBpY2tlcj8uaGlkZSgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGRhdGFcbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICovXG4gICAgb25JbnB1dFZhbHVlQ2hhbmdlKGRhdGEpIHtcbiAgICAgICAgLy8gV2UgZG8gbm90IGNhbGwgc3VwZXIgaGVyZS4gVGhlIHZhbHVlIG9mIHRoZSBTZWxlY3QgaXMgKm5vdCogY29ubmVjdGVkIHRvIHRoZSB2YWx1ZVxuICAgICAgICAvLyB0eXBlZCBpbnRvIHRoZSBpbnB1dCBhcmVhLiBUaGUgaW5wdXQgYXJlYSBpcyBqdXN0IGEgZmlsdGVyIHZhbHVlIHRvIGZpbHRlciB0aGUgbGlzdC5cbiAgICAgICAgdGhpcy5sYXN0TWFudWFsSW5wdXQgPSBkYXRhLnZhbHVlXG4gICAgICAgIHRoaXMuZmlsdGVyT25JbnB1dChkYXRhKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gZGF0YVxuICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgKi9cbiAgICBvbktleURvd25Eb3duKGRhdGEpIHtcbiAgICAgICAgaWYgKCF0aGlzLnBpY2tlciB8fCB0aGlzLnBpY2tlcj8uaGlkZGVuKSB7XG4gICAgICAgICAgICB0aGlzLm9uUGlja2VyVHJpZ2dlckNsaWNrKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBvblBpY2tlckhpZGRlbkNoYW5nZSh7IHZhbHVlIH0pIHtcbiAgICAgICAgY29uc3QgaW5wdXRFbCA9IHRoaXMuZ2V0SW5wdXRFbCgpO1xuXG4gICAgICAgIHN1cGVyLm9uUGlja2VySGlkZGVuQ2hhbmdlKC4uLmFyZ3VtZW50cyk7XG4gICAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICAgICAgaW5wdXRFbFsnYXJpYS1hY3RpdmVkZXNjZW5kYW50J10gPSAnJztcbiAgICAgICAgfVxuICAgICAgICBpbnB1dEVsWydhcmlhLWV4cGFuZGVkJ10gPSAhdmFsdWU7XG4gICAgICAgIHRoaXMudXBkYXRlKCk7XG4gICAgfVxuXG4gICAgLy8gVE9ETzpcbiAgICAvLyBXaGVuIHdlIGFyZSB1c2luZyBhIGBDb2xsZWN0aW9uYCBhcyBvdXIgYHZhbHVlQ29sbGVjdGlvbmAsIGFuZCB0aGF0IGBDb2xsZWN0aW9uYCBpcyB0aGVcbiAgICAvLyBgaXRlbXNgIG9mIHRoZSBMaXN0J3MgYHNlbGVjdGlvbk1vZGVsYCwgdGhlbiB0aGlzIHdpbGwgYmUgYG9uVmFsdWVDb2xsZWN0aW9uQ2hhbmdlYCxcbiAgICAvLyBhIGBtdXRhdGVgIGxpc3RlbmVyIG9uIG91ciBvd24gYHZhbHVlQ29sbGVjdGlvbmAgd2hpY2ggYmFja3Mgb3VyIGB2YWx1ZWAgZmllbGQgd2hpY2hcbiAgICAvLyB3aWxsIGJlIGltcGxlbWVudGVkIGJ5IGEgZ2V0dGVyIHdoaWNoIGFjY2Vzc2VzIGB2YWx1ZUNvbGxlY3Rpb25gLlxuICAgIC8vIFRoaXMgd2lsbCBiZWNvbWUgaW1wb3J0YW50IGZvciBpbXBsZW1lbnRpbmcgbXVsdGlTZWxlY3RcbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gc2VsZWN0aW9uQ2hhbmdlRXZlbnRcbiAgICAgKiBAcGFyYW0ge09iamVjdFtdfSBzZWxlY3Rpb25DaGFuZ2VFdmVudC5zZWxlY3Rpb25cbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICovXG4gICAgb25MaXN0SXRlbVNlbGVjdGlvbkNoYW5nZSh7IHNlbGVjdGlvbiB9KSB7XG4gICAgICAgIGlmIChzZWxlY3Rpb24/Lmxlbmd0aCkge1xuICAgICAgICAgICAgY29uc3RcbiAgICAgICAgICAgICAgICBtZSAgICAgICAgICAgPSB0aGlzLFxuICAgICAgICAgICAgICAgIG9sZFZhbHVlICAgICA9IG1lLnZhbHVlLFxuICAgICAgICAgICAgICAgIHNlbGVjdGVkICAgICA9IHNlbGVjdGlvblswXSxcbiAgICAgICAgICAgICAgICByZWNvcmQgICAgICAgPSB0eXBlb2Ygc2VsZWN0ZWQgPT09ICdzdHJpbmcnID8gbWUuc3RvcmUuZ2V0KG1lLmxpc3QuZ2V0SXRlbVJlY29yZElkKHNlbGVjdGVkKSkgOiBzZWxlY3RlZCxcbiAgICAgICAgICAgICAgICB2YWx1ZSAgICAgICAgPSByZWNvcmRbbWUuZGlzcGxheUZpZWxkXTtcblxuICAgICAgICAgICAgbWUuaGlkZVBpY2tlcigpO1xuICAgICAgICAgICAgbWUuaGludFJlY29yZElkID0gbnVsbDtcbiAgICAgICAgICAgIG1lLnJlY29yZCAgICAgICA9IHJlY29yZDtcbiAgICAgICAgICAgIG1lLl92YWx1ZSAgICAgICA9IHZhbHVlO1xuICAgICAgICAgICAgbWUuZ2V0SW5wdXRIaW50RWwoKS52YWx1ZSA9IG51bGw7XG5cbiAgICAgICAgICAgIG1lLmFmdGVyU2V0VmFsdWUodmFsdWUsIG9sZFZhbHVlLCB0cnVlKTsgLy8gcHJldmVudCB0aGUgbGlzdCBmcm9tIGdldHRpbmcgZmlsdGVyZWRcblxuICAgICAgICAgICAgbWUuZmlyZSgnc2VsZWN0Jywge1xuICAgICAgICAgICAgICAgIHJlY29yZCxcbiAgICAgICAgICAgICAgICB2YWx1ZVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNlbGVjdGlvbiB3YXMgYXR0ZW1wdGVkIHRvIGJlIGNoYW5nZWQgYnV0IHJlc3VsdGVkIGluIG5vIGFjdGlvbi5cbiAgICAgKiBGb3IgZXhhbXBsZSBjbGlja2luZyBvbiBhbHJlYWR5IHNlbGVjdGVkIGxpc3QgaXRlbS5cbiAgICAgKi9cbiAgICBvbkxpc3RJdGVtU2VsZWN0aW9uTm9DaGFuZ2UoKSB7XG4gICAgICAgIHRoaXMuaGlkZVBpY2tlcigpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSByZWNvcmRcbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICovXG4gICAgb25MaXN0SXRlbU5hdmlnYXRlKHsgYWN0aXZlSXRlbSwgYWN0aXZlSW5kZXggfSkge1xuICAgICAgICBpZiAoYWN0aXZlSW5kZXggPj0gMCkge1xuICAgICAgICAgICAgY29uc3RcbiAgICAgICAgICAgICAgICBtZSAgICAgICAgPSB0aGlzLFxuICAgICAgICAgICAgICAgIHsgc3RvcmUgfSA9IG1lO1xuXG4gICAgICAgICAgICBtZS5hY3RpdmVSZWNvcmQgPSBzdG9yZS5nZXRBdChhY3RpdmVJbmRleClcbiAgICAgICAgICAgIG1lLmFjdGl2ZVJlY29yZElkID0gbWUuYWN0aXZlUmVjb3JkW3N0b3JlLmtleVByb3BlcnR5IHx8IG1vZGVsLmtleVByb3BlcnR5XVxuICAgICAgICAgICAgbWUuZ2V0SW5wdXRFbCgpWydhcmlhLWFjdGl2ZWRlc2NlbmRhbnQnXSA9IGFjdGl2ZUl0ZW07XG5cbiAgICAgICAgICAgIC8vIFVwZGF0ZSB0eXBlYWhlYWQgaGludCAod2hpY2ggdXBkYXRlcyBET00pLCBvciB1cGRhdGUgRE9NXG4gICAgICAgICAgICBtZS50eXBlQWhlYWQgPyBtZS51cGRhdGVUeXBlQWhlYWRWYWx1ZShtZS5sYXN0TWFudWFsSW5wdXQpIDogbWUudXBkYXRlKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZWxlY3RpbmcgYSByZWNvcmQsIGlmIHJlcXVpcmVkXG4gICAgICogQHBhcmFtIHtPYmplY3RbXX0gaXRlbXNcbiAgICAgKi9cbiAgICBvblN0b3JlTG9hZChpdGVtcykge1xuICAgICAgICBsZXQgbWUgICAgPSB0aGlzLFxuICAgICAgICAgICAgdmFsdWUgPSBtZS52YWx1ZTtcblxuICAgICAgICBpZiAodmFsdWUpIHtcbiAgICAgICAgICAgIG1lLl92YWx1ZSA9IG51bGw7IC8vIHNpbGVudCB1cGRhdGVcbiAgICAgICAgICAgIG1lLnZhbHVlICA9IHZhbHVlXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqL1xuICAgIHNlbGVjdEZpcnN0TGlzdEl0ZW0oKSB7XG4gICAgICAgIHRoaXMuc2VsZWN0TGlzdEl0ZW0oMClcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqL1xuICAgIHNlbGVjdExhc3RMaXN0SXRlbSgpIHtcbiAgICAgICAgdGhpcy5zZWxlY3RMaXN0SXRlbSh0aGlzLnN0b3JlLmdldENvdW50KCkgLTEpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSWYgbm8gaW5kZXggaXMgcGFzc2VkLCB0aGUgaW5kZXggbWF0Y2hpbmcgdG8gdGhlIGZpZWxkIGlucHV0IHdpbGwgZ2V0IHVzZWQgKDAgaWYgbm9uZSlcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gW2luZGV4XVxuICAgICAqL1xuICAgIHNlbGVjdExpc3RJdGVtKGluZGV4KSB7XG4gICAgICAgIGxldCBtZSA9IHRoaXM7XG5cbiAgICAgICAgaWYgKCFOZW8uaXNOdW1iZXIoaW5kZXgpKSB7XG4gICAgICAgICAgICBpZiAobWUuYWN0aXZlUmVjb3JkSWQpIHtcbiAgICAgICAgICAgICAgICBpbmRleCA9IG1lLnN0b3JlLmluZGV4T2ZLZXkobWUuYWN0aXZlUmVjb3JkSWQpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpbmRleCA9IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBtZS5saXN0LnNlbGVjdEl0ZW0oaW5kZXgpO1xuICAgIH1cblxuICAgIG9uUGlja2VyVHJpZ2dlckNsaWNrKCkge1xuICAgICAgICBsZXQgbWUgPSB0aGlzO1xuXG4gICAgICAgIGlmIChtZS5waWNrZXI/LmlzVmlzaWJsZSkge1xuICAgICAgICAgICAgbWUucGlja2VyLmhpZGRlbiA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoIW1lLnJlYWRPbmx5ICYmICFtZS5kaXNhYmxlZCkge1xuICAgICAgICAgICAgbWUuZG9GaWx0ZXIobnVsbClcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEFsbCByb3V0ZXMgd2hpY2ggZXhwZWN0IHRvIG9wZW4gdGhlIHBpY2tlciByb3V0ZSB0aHJvdWdoIGhlcmUuIFRoaXMgdXBkYXRlcyB0aGVcbiAgICAgKiBmaWx0ZXIgYW5kIGVuc3VyZXMgdGhhdCB0aGUgcGlja2VyIGlzIHZpc2libGUgYW5kIHJlZmxlY3RpbmcgdGhlIHN0YXRlIG9mIHRoZSBmaWx0ZXIuXG4gICAgICpcbiAgICAgKiBJbnB1dCBldmVudCBwcm9jZXNzaW5nIHBhc3NlcyB0aGUgY3VycmVudCBpbnB1dCBmaWVsZCB2YWx1ZSBpbiBhcyB0aGUgZmlsdGVyIHZhbHVlLlxuICAgICAqXG4gICAgICogSW52b2NhdGlvbiBvZiB0aGUgZXhwYW5kIHRyaWdnZXIgcGFzc2VzIGBudWxsYCBzbyBhcyB0byBjbGVhciBmaWx0ZXJpbmcuXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge1N0cmluZ31udWxsfSB2YWx1ZSBUaGUgdmFsdWUgdG8gZmlsdGVyIHRoZSBwaWNrZXIgYnlcbiAgICAgKi9cbiAgICBkb0ZpbHRlcih2YWx1ZSkge1xuICAgICAgICBsZXQgbWUgICAgID0gdGhpcyxcbiAgICAgICAgICAgIGZpbHRlciA9IG1lLnN0b3JlLmdldEZpbHRlcihtZS5kaXNwbGF5RmllbGQpLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHJlY29yZCxcbiAgICAgICAgICAgICAgICBwaWNrZXJcbiAgICAgICAgICAgIH0gICAgICA9IG1lO1xuXG4gICAgICAgIGlmIChmaWx0ZXIpIHtcbiAgICAgICAgICAgIGZpbHRlci52YWx1ZSA9IHZhbHVlO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gRmlsdGVyIHJlc3VsdGluZyBpbiBzb21ldGhpbmcgdG8gc2hvd1xuICAgICAgICBpZiAobWUuc3RvcmUuZ2V0Q291bnQoKSkge1xuICAgICAgICAgICAgbWUuZ2V0UGlja2VyKCkuaGlkZGVuID0gZmFsc2U7XG5cbiAgICAgICAgICAgIC8vIExpc3QgbWlnaHQgbm90IGV4aXN0IHVudGlsIHRoZSBwaWNrZXIgaXMgY3JlYXRlZFxuICAgICAgICAgICAgY29uc3RcbiAgICAgICAgICAgICAgICB7IGxpc3QgfSAgICAgICAgICAgPSBtZSxcbiAgICAgICAgICAgICAgICB7IHNlbGVjdGlvbk1vZGVsIH0gPSBsaXN0O1xuXG4gICAgICAgICAgICAvLyBPbiBzaG93LCBzZXQgdGhlIGFjdGl2ZSBpdGVtIHRvIGJlIHRoZSBjdXJyZW50IHNlbGVjdGVkIHJlY29yZCBvciB0aGUgZmlyc3RcbiAgICAgICAgICAgIGlmIChyZWNvcmQpIHtcbiAgICAgICAgICAgICAgICAvLyBXZSBkbyBub3Qgd2FudCB0byBoZWFyIGJhY2sgYWJvdXQgb3VyIG93biBzZWxlY3Rpb25cbiAgICAgICAgICAgICAgICBzZWxlY3Rpb25Nb2RlbC5zdXNwZW5kRXZlbnRzID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBzZWxlY3Rpb25Nb2RlbC5zZWxlY3QocmVjb3JkKTtcbiAgICAgICAgICAgICAgICBzZWxlY3Rpb25Nb2RlbC5zdXNwZW5kRXZlbnRzID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICBsaXN0LmFjdGl2ZUluZGV4ID0gbWUucmVjb3JkIHx8IDA7XG4gICAgICAgICAgICB9LCAxMDApXG4gICAgICAgIH1cbiAgICAgICAgLy8gRmlsdGVyZWQgZG93biB0byBub3RoaW5nIC0gaGlkZSBwaWNrZXIgaWYgaXQgaGFzIGJlZW4gY3JlYXRlZC5cbiAgICAgICAgZWxzZSBpZiAocGlja2VyKSB7XG4gICAgICAgICAgICBwaWNrZXIuX2hpZGRlbiA9IHRydWU7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtzaWxlbnQ9ZmFsc2VdXG4gICAgICogQHByb3RlY3RlZFxuICAgICAqL1xuICAgIHVwZGF0ZVR5cGVBaGVhZChzaWxlbnQ9ZmFsc2UpIHtcbiAgICAgICAgbGV0IG1lICAgICAgPSB0aGlzLFxuICAgICAgICAgICAgaW5wdXRFbCA9IFZEb21VdGlsLmZpbmRWZG9tQ2hpbGQobWUudmRvbSwge2ZsYWc6ICduZW8tcmVhbC1pbnB1dCd9KSxcbiAgICAgICAgICAgIHZkb20gICAgPSBtZS52ZG9tO1xuXG4gICAgICAgIGlmIChtZS50eXBlQWhlYWQpIHtcbiAgICAgICAgICAgIGlucHV0RWwucGFyZW50Tm9kZS5jbltpbnB1dEVsLmluZGV4XSA9IHtcbiAgICAgICAgICAgICAgICB0YWc6ICdzcGFuJyxcbiAgICAgICAgICAgICAgICBjbHM6IFsnbmVvLWlucHV0LWZpZWxkLXdyYXBwZXInXSxcbiAgICAgICAgICAgICAgICBjbiA6IFt7XG4gICAgICAgICAgICAgICAgICAgIHRhZyAgICAgICAgIDogJ2lucHV0JyxcbiAgICAgICAgICAgICAgICAgICAgYXV0b2NvbXBsZXRlOiAnb2ZmJyxcbiAgICAgICAgICAgICAgICAgICAgYXV0b2NvcnJlY3QgOiAnb2ZmJyxcbiAgICAgICAgICAgICAgICAgICAgY2xzICAgICAgICAgOiBbJ25lby10ZXh0ZmllbGQtaW5wdXQnLCAnbmVvLXR5cGVhaGVhZC1pbnB1dCddLFxuICAgICAgICAgICAgICAgICAgICBkaXNhYmxlZCAgICA6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGlkICAgICAgICAgIDogbWUuZ2V0SW5wdXRIaW50SWQoKSxcbiAgICAgICAgICAgICAgICAgICAgc3BlbGxjaGVjayAgOiAnZmFsc2UnXG4gICAgICAgICAgICAgICAgfSwgaW5wdXRFbC52ZG9tXVxuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgVkRvbVV0aWwucmVwbGFjZVZkb21DaGlsZCh2ZG9tLCBpbnB1dEVsLnBhcmVudE5vZGUuaWQsIGlucHV0RWwudmRvbSlcbiAgICAgICAgfVxuXG4gICAgICAgICFzaWxlbnQgJiYgbWUudXBkYXRlKClcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge1N0cmluZ3xudWxsfSBbdmFsdWU9dGhpcy5sYXN0TWFudWFsSW5wdXRdXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBbc2lsZW50PWZhbHNlXVxuICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgKi9cbiAgICB1cGRhdGVUeXBlQWhlYWRWYWx1ZSh2YWx1ZT10aGlzLmxhc3RNYW51YWxJbnB1dCwgc2lsZW50PWZhbHNlKSB7XG4gICAgICAgIGxldCBtZSAgICAgICAgICA9IHRoaXMsXG4gICAgICAgICAgICBtYXRjaCAgICAgICA9IGZhbHNlLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHN0b3JlLFxuICAgICAgICAgICAgICAgIGRpc3BsYXlGaWVsZFxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgPSBtZSxcbiAgICAgICAgICAgIGlucHV0SGludEVsID0gbWUuZ2V0SW5wdXRIaW50RWwoKTtcblxuICAgICAgICBpZiAoIW1lLnJlY29yZCAmJiB2YWx1ZT8ubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgY29uc3Qgc2VhcmNoID0gdmFsdWUudG9Mb2NhbGVMb3dlckNhc2UoKTtcbiAgICAgICAgICAgIG1hdGNoID0gc3RvcmUuaXRlbXMuZmluZChyID0+IHJbZGlzcGxheUZpZWxkXT8udG9Mb3dlckNhc2U/LigpPy5zdGFydHNXaXRoKHNlYXJjaCkpO1xuXG4gICAgICAgICAgICBpZiAobWF0Y2ggJiYgaW5wdXRIaW50RWwpIHtcbiAgICAgICAgICAgICAgICBpbnB1dEhpbnRFbC52YWx1ZSA9IHZhbHVlICsgbWF0Y2hbZGlzcGxheUZpZWxkXS5zdWJzdHIodmFsdWUubGVuZ3RoKTtcbiAgICAgICAgICAgICAgICBtZS5hY3RpdmVSZWNvcmQgPSBtYXRjaDtcbiAgICAgICAgICAgICAgICBtZS5hY3RpdmVSZWNvcmRJZCA9IG1hdGNoW3N0b3JlLmtleVByb3BlcnR5IHx8IHN0b3JlLm1vZGVsLmtleVByb3BlcnR5XVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFtYXRjaCAmJiBpbnB1dEhpbnRFbCkge1xuICAgICAgICAgICAgaW5wdXRIaW50RWwudmFsdWUgPSBtZS5hY3RpdmVSZWNvcmQgPSBtZS5hY3RpdmVSZWNvcmRJZCA9IG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICAhc2lsZW50ICYmIG1lLnVwZGF0ZSgpXG4gICAgfVxufVxuXG4vKipcbiAqIFRoZSBzZWxlY3QgZXZlbnQgZmlyZXMgd2hlbiBhIGxpc3QgaXRlbSBnZXRzIHNlbGVjdGVkXG4gKiBAZXZlbnQgc2VsZWN0XG4gKiBAcGFyYW0ge09iamVjdH0gcmVjb3JkXG4gKiBAcGFyYW0ge3ZhbHVlfSByZWNvcmRbc3RvcmUua2V5UHJvcGVydHldXG4gKiBAcmV0dXJucyB7T2JqZWN0fVxuICovXG5cbk5lby5hcHBseUNsYXNzQ29uZmlnKFNlbGVjdCk7XG5cbmV4cG9ydCBkZWZhdWx0IFNlbGVjdDtcbiIsImltcG9ydCBCYXNlIGZyb20gJy4vQmFzZS5tanMnO1xuXG4vKipcbiAqIFVzZWQgYnkgZm9ybS5maWVsZC5QaWNrZXJcbiAqIEBjbGFzcyBOZW8uZm9ybS5maWVsZC50cmlnZ2VyLlBpY2tlclxuICogQGV4dGVuZHMgTmVvLmZvcm0uZmllbGQudHJpZ2dlci5CYXNlXG4gKi9cbmNsYXNzIFBpY2tlciBleHRlbmRzIEJhc2Uge1xuICAgIHN0YXRpYyBjb25maWcgPSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtTdHJpbmd9IGNsYXNzTmFtZT0nTmVvLmZvcm0uZmllbGQudHJpZ2dlci5QaWNrZXInXG4gICAgICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgICAgICovXG4gICAgICAgIGNsYXNzTmFtZTogJ05lby5mb3JtLmZpZWxkLnRyaWdnZXIuUGlja2VyJyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge1N0cmluZ30gbnR5cGU9J3RyaWdnZXItcGlja2VyJ1xuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICBudHlwZTogJ3RyaWdnZXItcGlja2VyJyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge1N0cmluZ3xudWxsfSBpY29uQ2xzPSdmYSBmYS1jYXJldC1kb3duJ1xuICAgICAgICAgKi9cbiAgICAgICAgaWNvbkNsczogJ2ZhIGZhLWNhcmV0LWRvd24nLFxuICAgICAgICAvKipcbiAgICAgICAgICogSW50ZXJuYWwgZmxhZyB1c2VkIGJ5IGZpZWxkLmdldFRyaWdnZXIoKVxuICAgICAgICAgKiBAbWVtYmVyIHtTdHJpbmd9IHR5cGU9J3BpY2tlcidcbiAgICAgICAgICogQHByb3RlY3RlZFxuICAgICAgICAgKi9cbiAgICAgICAgdHlwZTogJ3BpY2tlcidcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gZGF0YVxuICAgICAqL1xuICAgIG9uVHJpZ2dlckNsaWNrKGRhdGEpIHtcbiAgICAgICAgdGhpcy5maWVsZC5vblBpY2tlclRyaWdnZXJDbGljaygpO1xuICAgIH0gXG59XG5cbk5lby5hcHBseUNsYXNzQ29uZmlnKFBpY2tlcik7XG5cbmV4cG9ydCBkZWZhdWx0IFBpY2tlcjtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==