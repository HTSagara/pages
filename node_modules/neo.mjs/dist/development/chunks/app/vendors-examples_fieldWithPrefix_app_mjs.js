"use strict";
(self["webpackChunkneo_mjs"] = self["webpackChunkneo_mjs"] || []).push([["vendors-examples_fieldWithPrefix_app_mjs"],{

/***/ "./examples/fieldWithPrefix/MainContainer.mjs":
/*!****************************************************!*\
  !*** ./examples/fieldWithPrefix/MainContainer.mjs ***!
  \****************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _src_form_field_ComboBox_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../src/form/field/ComboBox.mjs */ "./src/form/field/ComboBox.mjs");
/* harmony import */ var _ConfigurationViewport_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../ConfigurationViewport.mjs */ "./examples/ConfigurationViewport.mjs");
/* harmony import */ var _src_plugin_PrefixField_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../src/plugin/PrefixField.mjs */ "./src/plugin/PrefixField.mjs");
/* harmony import */ var _src_form_field_Text_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../src/form/field/Text.mjs */ "./src/form/field/Text.mjs");





/**
 * @class Neo.examples.fieldWithPrefix.MainContainer
 * @extends Neo.examples.ConfigurationViewport
 */
class MainContainer extends _ConfigurationViewport_mjs__WEBPACK_IMPORTED_MODULE_1__["default"] {
    static config = {
        className           : 'Neo.examples.fieldWithPrefix.MainContainer',
        autoMount           : true,
        configItemLabelWidth: 100,
        configItemWidth     : 230,
        layout              : {ntype: 'hbox', align: 'stretch'},
        cls                 : ['examples-container-accordion']
    }

    onPluginConfigChange(config, opts) {
        const textfield = this.exampleComponent.items[0],
              plugin    = textfield.getPlugin('prefixfield');

        if (config === 'accept') {
            plugin.accept = opts.record.value
        } else {
            plugin[config] = opts.value;
            textfield.value = ''
        }
    }

    createConfigurationComponents() {
        let me        = this,
            textfield = me.exampleComponent.items[0],
            plugin    = textfield.plugins[0];

        return [{
            module   : _src_form_field_Text_mjs__WEBPACK_IMPORTED_MODULE_3__["default"],
            clearable: true,
            labelText: 'pattern',
            listeners: {change: me.onPluginConfigChange.bind(me, 'pattern')},
            value    : plugin.pattern,
            style    : {marginTop: '10px'}
        }, {
            module   : _src_form_field_Text_mjs__WEBPACK_IMPORTED_MODULE_3__["default"],
            clearable: true,
            labelText: 'slots',
            listeners: {change: me.onPluginConfigChange.bind(me, 'slots')},
            value    : '_',
            style    : {marginTop: '10px'}
        }, {
            module: _src_form_field_ComboBox_mjs__WEBPACK_IMPORTED_MODULE_0__["default"],
            store : {
                model: {fields: [{name: 'id'}, {name: 'name'}, {name: 'value'}]},
                data : [
                    {id: '0', name: 'empty=/\\d/', value: null},
                    {id: '1', name: '[0-9]', value: '[0-9]'},
                    {id: '2', name: '[A-H]', value: '[A-H]'},
                    {id: '3', name: '/\\w/', value: /\w/},
                    {id: '4', name: '/\\d/', value: /\d/},
                    {id: '5', name: '[0-9a-f]', value: '[0-9a-f]'}
                ]
            },

            value       : '4',
            displayField: 'name',
            valueField  : 'value',

            clearable: true,
            labelText: 'accept',
            listeners: {change: me.onPluginConfigChange.bind(me, 'accept')},
            style    : {marginTop: '10px'}
        }]
    }

    /**
     * @returns {*}
     */
    createExampleComponent() {
        return Neo.ntype({
            ntype : 'container',
            width : 350,
            cls   : ['example-fieldWithPrefix'],
            layout: {ntype: 'vbox', align: 'stretch'},
            items : [{
                module   : _src_form_field_Text_mjs__WEBPACK_IMPORTED_MODULE_3__["default"],
                labelText: 'Phone Number',
                plugins  : [
                    {
                        module : _src_plugin_PrefixField_mjs__WEBPACK_IMPORTED_MODULE_2__["default"],
                        pattern: '+1 (___) ___-___-____',
                        slots  : '_'
                    }
                ]
            }, {
                module   : _src_form_field_Text_mjs__WEBPACK_IMPORTED_MODULE_3__["default"],
                labelText: '[0-9] Date',
                plugins  : [
                    {
                        module : _src_plugin_PrefixField_mjs__WEBPACK_IMPORTED_MODULE_2__["default"],
                        pattern: 'dd/mm/yyyy hh:mm',
                        slots  : 'dmyh'
                    }
                ]
            }, {
                module   : _src_form_field_Text_mjs__WEBPACK_IMPORTED_MODULE_3__["default"],
                labelText: '[A-H] MAC Adress',
                plugins  : [
                    {
                        module : _src_plugin_PrefixField_mjs__WEBPACK_IMPORTED_MODULE_2__["default"],
                        pattern: 'XX:XX:XX:XX:XX:XX',
                        slots  : 'X',
                        accept : '[A-H]'
                    }
                ]
            }, {
                module   : _src_form_field_Text_mjs__WEBPACK_IMPORTED_MODULE_3__["default"],
                labelText: '/\\w/ Alphanumeric',
                plugins  : [
                    {
                        module : _src_plugin_PrefixField_mjs__WEBPACK_IMPORTED_MODULE_2__["default"],
                        pattern: '__-__-__-____',
                        slots  : '_',
                        accept : /\w/
                    }
                ]
            }, {
                module   : _src_form_field_Text_mjs__WEBPACK_IMPORTED_MODULE_3__["default"],
                labelText: '/\\d/ Credit Card',
                plugins  : [
                    {
                        module : _src_plugin_PrefixField_mjs__WEBPACK_IMPORTED_MODULE_2__["default"],
                        pattern: '.... .... .... ....',
                        slots  : '.',
                        accept : /\d/
                    }
                ]
            }]
        })
    }
}

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Neo.setupClass(MainContainer));


/***/ }),

/***/ "./examples/fieldWithPrefix/app.mjs":
/*!******************************************!*\
  !*** ./examples/fieldWithPrefix/app.mjs ***!
  \******************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   onStart: () => (/* binding */ onStart)
/* harmony export */ });
/* harmony import */ var _MainContainer_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./MainContainer.mjs */ "./examples/fieldWithPrefix/MainContainer.mjs");


const onStart = () => Neo.app({
    mainView: _MainContainer_mjs__WEBPACK_IMPORTED_MODULE_0__["default"],
    name    : 'Neo.examples.fieldWithPrefix'
});


/***/ }),

/***/ "./src/plugin/Base.mjs":
/*!*****************************!*\
  !*** ./src/plugin/Base.mjs ***!
  \*****************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _core_Base_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../core/Base.mjs */ "./src/core/Base.mjs");


/**
 * Abstract base class for plugin implementations.
 * Plugins are intended to get put into the plugins config of component.Base
 * to enhance them or add additional features
 * @class Neo.plugin.Base
 * @extends Neo.core.Base
 */
class Base extends _core_Base_mjs__WEBPACK_IMPORTED_MODULE_0__["default"] {
    static config = {
        /**
         * @member {String} className='Neo.plugin.Base'
         * @protected
         */
        className: 'Neo.plugin.Base',
        /**
         * All plugin ntypes need to start with 'plugin-' to ensure that component.Base: getPlugin() can find them
         * @member {String} ntype='plugin'
         * @protected
         */
        ntype: 'plugin',
        /**
         * @member {Neo.component.Base} owner=null
         * @protected
         */
        owner: null
    }

    /**
     * @param {Object} config
     */
    construct(config) {
        super.construct(config);

        let me = this;

        if (me.owner.mounted) {
            me.onOwnerMounted();
        } else {
            me.owner.on('mounted', me.onOwnerMounted, me);
        }
    }

    /**
     * Override this method to apply changes to the owner Component when it does get mounted
     */
    onOwnerMounted() {

    }
}

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Neo.setupClass(Base));


/***/ }),

/***/ "./src/plugin/PrefixField.mjs":
/*!************************************!*\
  !*** ./src/plugin/PrefixField.mjs ***!
  \************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _Base_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./Base.mjs */ "./src/plugin/Base.mjs");


/**
 * @class Neo.plugin.PrefixField
 * @extends Neo.plugin.Base
 *
 * @example
 *
 *     {
 *         module   : TextField,
 *         labelText: 'Credit Card',
 *         plugins  : [{
 *             module : PrefixPlugin, // import PrefixPlugin from '../../src/plugin/PrefixField.mjs';
 *             pattern: 'dd/mm/yyyy',
 *             slots  : 'dmy',        // characters allowed to replace
 *             accept : /\d/          // either '[A-Z]' or regex or undefined
 *         }]
 *     }
 */
class PrefixField extends _Base_mjs__WEBPACK_IMPORTED_MODULE_0__["default"] {
    static config = {
        /**
         * @member {String} className='Neo.plugin.PrefixField'
         * @protected
         */
        className: 'Neo.plugin.PrefixField',
        /**
         * @member {String} ntype='plugin-prefixfield'
         * @protected
         */
        ntype: 'plugin-prefixfield',
        /**
         * Custom cls added to the inputEl
         * @member {String} inputCls='neo-prefixfield-input'
         */
        inputCls: 'neo-prefixfield-input',
        /**
         * Custom cls added to the inputEl
         * @member {String} inputCls='neo-prefixfield-input'
         */
        labelCls: 'neo-prefixfield-label',
        /**
         * Custom cls to add to the owner component
         * @member {String} ownerCls='neo-prefixfield'
         */
        ownerCls: 'neo-prefixfield',
        /**
         * regex to calculate if entered value is acceptable
         * Preset to numbers only
         *
         * @member {regex|null} accept
         */
        accept_: null,
        /**
         * @member {String} pattern=null
         */
        pattern_: null,
        /**
         * Only add a String. A Set will be automatically created
         * @member {String|Set|null} slots=null
         */
        slots_: null
    }

    /**
     * First accepted place to enter a value
     * @member {Number} first
     * @protected
     */
    first = null
    /**
     * Array of numbers, which shows the previous entry point
     * @member {Array[]} prev
     * @protected
     */
    prev = null
    /**
     * Position of the cursor inside input element
     * @member {Object} selection
     * @protected
     */
    selection = null

    /**
     * State if selection should be updated
     * @member {Boolean} ignoreSelection
     * @protected
     */
    ignoreSelection = false
    /**
     * State if last entry was the back button
     * @member {Boolean} back
     * @protected
     */
    back = false

    /**
     * @param {Object} config
     */
    construct(config) {
        let me = this;

        super.construct(config);

        me.addListeners();
        me.addCss();
    }

    /**
     * Add a custom cls to the owner component
     */
    addCss() {
        const me      = this,
              {owner} = me,
              inputEl = owner.getInputEl(),
              labelEl = owner.getLabelEl();

        owner    .addCls(me.ownerCls);
        inputEl.cls.push(me.inputCls);
        labelEl.cls.push(me.labelCls)
    }

    /**
     * Add listeners
     * @protected
     */
    addListeners() {
        let me      = this,
            {owner} = me;

        owner.addDomListeners([
            {keydown        : me.onFieldKeyDown        , scope: me},
            {focusin        : me.onFieldFocus          , scope: me},
            {focusout       : me.onFieldBlur           , scope: me},
            {selectionchange: me.onFieldSelectionChange, scope: me}
        ]);

        me.owner.on('mounted', () => {
            Neo.currentWorker.insertThemeFiles(owner.windowId, me.__proto__)
        }, me, {once: true})
    }


    /**
     * After setting accept format output
     * @param {String} value
     * @param {String} oldValue
     * @protected
     */
    afterSetAccept(value, oldValue) {
        this.owner.value && this.format()
    }

    /**
     * After setting pattern recalc other values and set placeholder
     * @param {Set} value
     * @param {Set} oldValue
     * @protected
     */
    afterSetPattern(value, oldValue) {
        this.owner.placeholderText = value;
        this.recalcFirstAndPref()
    }

    /**
     * After setting slots recalc other values
     * @param {Set} value
     * @param {Set} oldValue
     * @protected
     */
    afterSetSlots(value, oldValue) {
        this.recalcFirstAndPref()
    }

    /**
     * Before the new value for slots will be set we create a Set from the string
     * @param {String} value
     * @return {Set}
     * @protected
     */
    beforeSetSlots(value) {
        return new Set(value || "_")
    }

    /**
     * Remove unwanted entries and limit length
     * @param {String} input
     * @returns {any[]}
     * @protected
     */
    clean(input) {
        const me     = this,
              accept = new RegExp(this.accept || "\\d", "g");

        input = input.match(accept) || [];
        input = Array.from(me.pattern, c =>
            input[0] === c || me.slots.has(c) ? input.shift() || c : c
        );

        return input.slice(0, me.pattern.length)
    }

    /**
     * Calculate position and output correct String to Field
     * @protected
     */
    format() {
        let me                = this,
            el                = me.owner,
            {prev, selection} = me,
            clean             = me.clean.bind(me),
            value             = el.value || '';

        const [i, j] = [selection.start, selection.end].map(i => {
            i = me.clean(value.slice(0, i)).findIndex(c => me.slots.has(c));
            return i < 0 ? prev[prev.length - 1] : me.back ? prev[i - 1] || me.first : i
        });

        el.value = clean(value).join``;
        me.ignoreSelection = true;

        Neo.main.DomAccess.selectNode({id: el.getInputElId(), start: i, end: j});
        me.ignoreSelection = false;

        me.back = false
    }

    /**
     * Event
     * @param {Object} data
     * @returns {false|string}
     * @protected
     */
    onFieldBlur(data) {
        let {owner, pattern} = this;

        return owner.value === pattern && (owner.value = '')
    }

    /**
     * Event
     * @param {Object} data
     * @protected
     */
    onFieldFocus(data) {
        this.format()
    }

    /**
     * Event
     * @param {Object} data
     * @protected
     */
    onFieldKeyDown(data) {
        this.back = data.key === "Backspace"
    }

    /**
     * Event
     * @param {Object} data
     * @protected
     */
    onFieldSelectionChange(data) {
        let sel  = this.selection,
            dSel = data.selection;

        // Do not run, if ignore state or same start and end data
        if (this.ignoreSelection || (dSel.start === sel.start && dSel.end === sel.end)) {
            return
        }

        this.selection = dSel;
        this.format()
    }

    /**
     * Calc values for first and prev
     * @protected
     */
    recalcFirstAndPref() {
        let me               = this,
            {pattern, slots} = me;

        me.prev = (j => Array.from(pattern, (c, i) => slots.has(c) ? j = i + 1 : j))(0);
        me.first = [...pattern].findIndex(c => slots.has(c));

        me.selection = {start: me.first, end: me.first};

        me.owner.value && me.format()
    }
}

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Neo.setupClass(PrefixField));


/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2h1bmtzL2FwcC92ZW5kb3JzLWV4YW1wbGVzX2ZpZWxkV2l0aFByZWZpeF9hcHBfbWpzLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQXNFO0FBQ0w7QUFDSTtBQUNIOztBQUVsRTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0QixrRUFBcUI7QUFDakQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQixnQ0FBZ0M7QUFDL0Q7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLHVCQUF1QixnRUFBUztBQUNoQztBQUNBO0FBQ0Esd0JBQXdCLG9EQUFvRDtBQUM1RTtBQUNBLHdCQUF3QjtBQUN4QixTQUFTO0FBQ1QsdUJBQXVCLGdFQUFTO0FBQ2hDO0FBQ0E7QUFDQSx3QkFBd0Isa0RBQWtEO0FBQzFFO0FBQ0Esd0JBQXdCO0FBQ3hCLFNBQVM7QUFDVCxvQkFBb0Isb0VBQVE7QUFDNUI7QUFDQSx3QkFBd0IsVUFBVSxXQUFXLEdBQUcsYUFBYSxHQUFHLGNBQWMsRUFBRTtBQUNoRjtBQUNBLHFCQUFxQiwwQ0FBMEM7QUFDL0QscUJBQXFCLHVDQUF1QztBQUM1RCxxQkFBcUIsdUNBQXVDO0FBQzVELHFCQUFxQixvQ0FBb0M7QUFDekQscUJBQXFCLG9DQUFvQztBQUN6RCxxQkFBcUI7QUFDckI7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0Esd0JBQXdCLG1EQUFtRDtBQUMzRSx3QkFBd0I7QUFDeEIsU0FBUztBQUNUOztBQUVBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQixnQ0FBZ0M7QUFDckQ7QUFDQSwyQkFBMkIsZ0VBQVM7QUFDcEM7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDLG1FQUFZO0FBQzdDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtB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bGRXaXRoUHJlZml4L01haW5Db250YWluZXIubWpzIiwid2VicGFjazovL25lby5tanMvLi9leGFtcGxlcy9maWVsZFdpdGhQcmVmaXgvYXBwLm1qcyIsIndlYnBhY2s6Ly9uZW8ubWpzLy4vc3JjL3BsdWdpbi9CYXNlLm1qcyIsIndlYnBhY2s6Ly9uZW8ubWpzLy4vc3JjL3BsdWdpbi9QcmVmaXhGaWVsZC5tanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IENvbWJvQm94ICAgICAgICAgICAgICBmcm9tICcuLi8uLi9zcmMvZm9ybS9maWVsZC9Db21ib0JveC5tanMnO1xuaW1wb3J0IENvbmZpZ3VyYXRpb25WaWV3cG9ydCBmcm9tICcuLi9Db25maWd1cmF0aW9uVmlld3BvcnQubWpzJztcbmltcG9ydCBQcmVmaXhQbHVnaW4gICAgICAgICAgZnJvbSAnLi4vLi4vc3JjL3BsdWdpbi9QcmVmaXhGaWVsZC5tanMnO1xuaW1wb3J0IFRleHRGaWVsZCAgICAgICAgICAgICBmcm9tICcuLi8uLi9zcmMvZm9ybS9maWVsZC9UZXh0Lm1qcyc7XG5cbi8qKlxuICogQGNsYXNzIE5lby5leGFtcGxlcy5maWVsZFdpdGhQcmVmaXguTWFpbkNvbnRhaW5lclxuICogQGV4dGVuZHMgTmVvLmV4YW1wbGVzLkNvbmZpZ3VyYXRpb25WaWV3cG9ydFxuICovXG5jbGFzcyBNYWluQ29udGFpbmVyIGV4dGVuZHMgQ29uZmlndXJhdGlvblZpZXdwb3J0IHtcbiAgICBzdGF0aWMgY29uZmlnID0ge1xuICAgICAgICBjbGFzc05hbWUgICAgICAgICAgIDogJ05lby5leGFtcGxlcy5maWVsZFdpdGhQcmVmaXguTWFpbkNvbnRhaW5lcicsXG4gICAgICAgIGF1dG9Nb3VudCAgICAgICAgICAgOiB0cnVlLFxuICAgICAgICBjb25maWdJdGVtTGFiZWxXaWR0aDogMTAwLFxuICAgICAgICBjb25maWdJdGVtV2lkdGggICAgIDogMjMwLFxuICAgICAgICBsYXlvdXQgICAgICAgICAgICAgIDoge250eXBlOiAnaGJveCcsIGFsaWduOiAnc3RyZXRjaCd9LFxuICAgICAgICBjbHMgICAgICAgICAgICAgICAgIDogWydleGFtcGxlcy1jb250YWluZXItYWNjb3JkaW9uJ11cbiAgICB9XG5cbiAgICBvblBsdWdpbkNvbmZpZ0NoYW5nZShjb25maWcsIG9wdHMpIHtcbiAgICAgICAgY29uc3QgdGV4dGZpZWxkID0gdGhpcy5leGFtcGxlQ29tcG9uZW50Lml0ZW1zWzBdLFxuICAgICAgICAgICAgICBwbHVnaW4gICAgPSB0ZXh0ZmllbGQuZ2V0UGx1Z2luKCdwcmVmaXhmaWVsZCcpO1xuXG4gICAgICAgIGlmIChjb25maWcgPT09ICdhY2NlcHQnKSB7XG4gICAgICAgICAgICBwbHVnaW4uYWNjZXB0ID0gb3B0cy5yZWNvcmQudmFsdWVcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHBsdWdpbltjb25maWddID0gb3B0cy52YWx1ZTtcbiAgICAgICAgICAgIHRleHRmaWVsZC52YWx1ZSA9ICcnXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBjcmVhdGVDb25maWd1cmF0aW9uQ29tcG9uZW50cygpIHtcbiAgICAgICAgbGV0IG1lICAgICAgICA9IHRoaXMsXG4gICAgICAgICAgICB0ZXh0ZmllbGQgPSBtZS5leGFtcGxlQ29tcG9uZW50Lml0ZW1zWzBdLFxuICAgICAgICAgICAgcGx1Z2luICAgID0gdGV4dGZpZWxkLnBsdWdpbnNbMF07XG5cbiAgICAgICAgcmV0dXJuIFt7XG4gICAgICAgICAgICBtb2R1bGUgICA6IFRleHRGaWVsZCxcbiAgICAgICAgICAgIGNsZWFyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIGxhYmVsVGV4dDogJ3BhdHRlcm4nLFxuICAgICAgICAgICAgbGlzdGVuZXJzOiB7Y2hhbmdlOiBtZS5vblBsdWdpbkNvbmZpZ0NoYW5nZS5iaW5kKG1lLCAncGF0dGVybicpfSxcbiAgICAgICAgICAgIHZhbHVlICAgIDogcGx1Z2luLnBhdHRlcm4sXG4gICAgICAgICAgICBzdHlsZSAgICA6IHttYXJnaW5Ub3A6ICcxMHB4J31cbiAgICAgICAgfSwge1xuICAgICAgICAgICAgbW9kdWxlICAgOiBUZXh0RmllbGQsXG4gICAgICAgICAgICBjbGVhcmFibGU6IHRydWUsXG4gICAgICAgICAgICBsYWJlbFRleHQ6ICdzbG90cycsXG4gICAgICAgICAgICBsaXN0ZW5lcnM6IHtjaGFuZ2U6IG1lLm9uUGx1Z2luQ29uZmlnQ2hhbmdlLmJpbmQobWUsICdzbG90cycpfSxcbiAgICAgICAgICAgIHZhbHVlICAgIDogJ18nLFxuICAgICAgICAgICAgc3R5bGUgICAgOiB7bWFyZ2luVG9wOiAnMTBweCd9XG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIG1vZHVsZTogQ29tYm9Cb3gsXG4gICAgICAgICAgICBzdG9yZSA6IHtcbiAgICAgICAgICAgICAgICBtb2RlbDoge2ZpZWxkczogW3tuYW1lOiAnaWQnfSwge25hbWU6ICduYW1lJ30sIHtuYW1lOiAndmFsdWUnfV19LFxuICAgICAgICAgICAgICAgIGRhdGEgOiBbXG4gICAgICAgICAgICAgICAgICAgIHtpZDogJzAnLCBuYW1lOiAnZW1wdHk9L1xcXFxkLycsIHZhbHVlOiBudWxsfSxcbiAgICAgICAgICAgICAgICAgICAge2lkOiAnMScsIG5hbWU6ICdbMC05XScsIHZhbHVlOiAnWzAtOV0nfSxcbiAgICAgICAgICAgICAgICAgICAge2lkOiAnMicsIG5hbWU6ICdbQS1IXScsIHZhbHVlOiAnW0EtSF0nfSxcbiAgICAgICAgICAgICAgICAgICAge2lkOiAnMycsIG5hbWU6ICcvXFxcXHcvJywgdmFsdWU6IC9cXHcvfSxcbiAgICAgICAgICAgICAgICAgICAge2lkOiAnNCcsIG5hbWU6ICcvXFxcXGQvJywgdmFsdWU6IC9cXGQvfSxcbiAgICAgICAgICAgICAgICAgICAge2lkOiAnNScsIG5hbWU6ICdbMC05YS1mXScsIHZhbHVlOiAnWzAtOWEtZl0nfVxuICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIHZhbHVlICAgICAgIDogJzQnLFxuICAgICAgICAgICAgZGlzcGxheUZpZWxkOiAnbmFtZScsXG4gICAgICAgICAgICB2YWx1ZUZpZWxkICA6ICd2YWx1ZScsXG5cbiAgICAgICAgICAgIGNsZWFyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIGxhYmVsVGV4dDogJ2FjY2VwdCcsXG4gICAgICAgICAgICBsaXN0ZW5lcnM6IHtjaGFuZ2U6IG1lLm9uUGx1Z2luQ29uZmlnQ2hhbmdlLmJpbmQobWUsICdhY2NlcHQnKX0sXG4gICAgICAgICAgICBzdHlsZSAgICA6IHttYXJnaW5Ub3A6ICcxMHB4J31cbiAgICAgICAgfV1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcmV0dXJucyB7Kn1cbiAgICAgKi9cbiAgICBjcmVhdGVFeGFtcGxlQ29tcG9uZW50KCkge1xuICAgICAgICByZXR1cm4gTmVvLm50eXBlKHtcbiAgICAgICAgICAgIG50eXBlIDogJ2NvbnRhaW5lcicsXG4gICAgICAgICAgICB3aWR0aCA6IDM1MCxcbiAgICAgICAgICAgIGNscyAgIDogWydleGFtcGxlLWZpZWxkV2l0aFByZWZpeCddLFxuICAgICAgICAgICAgbGF5b3V0OiB7bnR5cGU6ICd2Ym94JywgYWxpZ246ICdzdHJldGNoJ30sXG4gICAgICAgICAgICBpdGVtcyA6IFt7XG4gICAgICAgICAgICAgICAgbW9kdWxlICAgOiBUZXh0RmllbGQsXG4gICAgICAgICAgICAgICAgbGFiZWxUZXh0OiAnUGhvbmUgTnVtYmVyJyxcbiAgICAgICAgICAgICAgICBwbHVnaW5zICA6IFtcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgbW9kdWxlIDogUHJlZml4UGx1Z2luLFxuICAgICAgICAgICAgICAgICAgICAgICAgcGF0dGVybjogJysxIChfX18pIF9fXy1fX18tX19fXycsXG4gICAgICAgICAgICAgICAgICAgICAgICBzbG90cyAgOiAnXydcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICBtb2R1bGUgICA6IFRleHRGaWVsZCxcbiAgICAgICAgICAgICAgICBsYWJlbFRleHQ6ICdbMC05XSBEYXRlJyxcbiAgICAgICAgICAgICAgICBwbHVnaW5zICA6IFtcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgbW9kdWxlIDogUHJlZml4UGx1Z2luLFxuICAgICAgICAgICAgICAgICAgICAgICAgcGF0dGVybjogJ2RkL21tL3l5eXkgaGg6bW0nLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2xvdHMgIDogJ2RteWgnXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgbW9kdWxlICAgOiBUZXh0RmllbGQsXG4gICAgICAgICAgICAgICAgbGFiZWxUZXh0OiAnW0EtSF0gTUFDIEFkcmVzcycsXG4gICAgICAgICAgICAgICAgcGx1Z2lucyAgOiBbXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1vZHVsZSA6IFByZWZpeFBsdWdpbixcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhdHRlcm46ICdYWDpYWDpYWDpYWDpYWDpYWCcsXG4gICAgICAgICAgICAgICAgICAgICAgICBzbG90cyAgOiAnWCcsXG4gICAgICAgICAgICAgICAgICAgICAgICBhY2NlcHQgOiAnW0EtSF0nXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgbW9kdWxlICAgOiBUZXh0RmllbGQsXG4gICAgICAgICAgICAgICAgbGFiZWxUZXh0OiAnL1xcXFx3LyBBbHBoYW51bWVyaWMnLFxuICAgICAgICAgICAgICAgIHBsdWdpbnMgIDogW1xuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtb2R1bGUgOiBQcmVmaXhQbHVnaW4sXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXR0ZXJuOiAnX18tX18tX18tX19fXycsXG4gICAgICAgICAgICAgICAgICAgICAgICBzbG90cyAgOiAnXycsXG4gICAgICAgICAgICAgICAgICAgICAgICBhY2NlcHQgOiAvXFx3L1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgIG1vZHVsZSAgIDogVGV4dEZpZWxkLFxuICAgICAgICAgICAgICAgIGxhYmVsVGV4dDogJy9cXFxcZC8gQ3JlZGl0IENhcmQnLFxuICAgICAgICAgICAgICAgIHBsdWdpbnMgIDogW1xuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtb2R1bGUgOiBQcmVmaXhQbHVnaW4sXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXR0ZXJuOiAnLi4uLiAuLi4uIC4uLi4gLi4uLicsXG4gICAgICAgICAgICAgICAgICAgICAgICBzbG90cyAgOiAnLicsXG4gICAgICAgICAgICAgICAgICAgICAgICBhY2NlcHQgOiAvXFxkL1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgfV1cbiAgICAgICAgfSlcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IE5lby5zZXR1cENsYXNzKE1haW5Db250YWluZXIpO1xuIiwiaW1wb3J0IE1haW5Db250YWluZXIgZnJvbSAnLi9NYWluQ29udGFpbmVyLm1qcyc7XG5cbmV4cG9ydCBjb25zdCBvblN0YXJ0ID0gKCkgPT4gTmVvLmFwcCh7XG4gICAgbWFpblZpZXc6IE1haW5Db250YWluZXIsXG4gICAgbmFtZSAgICA6ICdOZW8uZXhhbXBsZXMuZmllbGRXaXRoUHJlZml4J1xufSk7XG4iLCJpbXBvcnQgQ29yZUJhc2UgZnJvbSAnLi4vY29yZS9CYXNlLm1qcyc7XG5cbi8qKlxuICogQWJzdHJhY3QgYmFzZSBjbGFzcyBmb3IgcGx1Z2luIGltcGxlbWVudGF0aW9ucy5cbiAqIFBsdWdpbnMgYXJlIGludGVuZGVkIHRvIGdldCBwdXQgaW50byB0aGUgcGx1Z2lucyBjb25maWcgb2YgY29tcG9uZW50LkJhc2VcbiAqIHRvIGVuaGFuY2UgdGhlbSBvciBhZGQgYWRkaXRpb25hbCBmZWF0dXJlc1xuICogQGNsYXNzIE5lby5wbHVnaW4uQmFzZVxuICogQGV4dGVuZHMgTmVvLmNvcmUuQmFzZVxuICovXG5jbGFzcyBCYXNlIGV4dGVuZHMgQ29yZUJhc2Uge1xuICAgIHN0YXRpYyBjb25maWcgPSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtTdHJpbmd9IGNsYXNzTmFtZT0nTmVvLnBsdWdpbi5CYXNlJ1xuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICBjbGFzc05hbWU6ICdOZW8ucGx1Z2luLkJhc2UnLFxuICAgICAgICAvKipcbiAgICAgICAgICogQWxsIHBsdWdpbiBudHlwZXMgbmVlZCB0byBzdGFydCB3aXRoICdwbHVnaW4tJyB0byBlbnN1cmUgdGhhdCBjb21wb25lbnQuQmFzZTogZ2V0UGx1Z2luKCkgY2FuIGZpbmQgdGhlbVxuICAgICAgICAgKiBAbWVtYmVyIHtTdHJpbmd9IG50eXBlPSdwbHVnaW4nXG4gICAgICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgICAgICovXG4gICAgICAgIG50eXBlOiAncGx1Z2luJyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge05lby5jb21wb25lbnQuQmFzZX0gb3duZXI9bnVsbFxuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICBvd25lcjogbnVsbFxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjb25maWdcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3QoY29uZmlnKSB7XG4gICAgICAgIHN1cGVyLmNvbnN0cnVjdChjb25maWcpO1xuXG4gICAgICAgIGxldCBtZSA9IHRoaXM7XG5cbiAgICAgICAgaWYgKG1lLm93bmVyLm1vdW50ZWQpIHtcbiAgICAgICAgICAgIG1lLm9uT3duZXJNb3VudGVkKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBtZS5vd25lci5vbignbW91bnRlZCcsIG1lLm9uT3duZXJNb3VudGVkLCBtZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBPdmVycmlkZSB0aGlzIG1ldGhvZCB0byBhcHBseSBjaGFuZ2VzIHRvIHRoZSBvd25lciBDb21wb25lbnQgd2hlbiBpdCBkb2VzIGdldCBtb3VudGVkXG4gICAgICovXG4gICAgb25Pd25lck1vdW50ZWQoKSB7XG5cbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IE5lby5zZXR1cENsYXNzKEJhc2UpO1xuIiwiaW1wb3J0IEJhc2UgZnJvbSAnLi9CYXNlLm1qcyc7XG5cbi8qKlxuICogQGNsYXNzIE5lby5wbHVnaW4uUHJlZml4RmllbGRcbiAqIEBleHRlbmRzIE5lby5wbHVnaW4uQmFzZVxuICpcbiAqIEBleGFtcGxlXG4gKlxuICogICAgIHtcbiAqICAgICAgICAgbW9kdWxlICAgOiBUZXh0RmllbGQsXG4gKiAgICAgICAgIGxhYmVsVGV4dDogJ0NyZWRpdCBDYXJkJyxcbiAqICAgICAgICAgcGx1Z2lucyAgOiBbe1xuICogICAgICAgICAgICAgbW9kdWxlIDogUHJlZml4UGx1Z2luLCAvLyBpbXBvcnQgUHJlZml4UGx1Z2luIGZyb20gJy4uLy4uL3NyYy9wbHVnaW4vUHJlZml4RmllbGQubWpzJztcbiAqICAgICAgICAgICAgIHBhdHRlcm46ICdkZC9tbS95eXl5JyxcbiAqICAgICAgICAgICAgIHNsb3RzICA6ICdkbXknLCAgICAgICAgLy8gY2hhcmFjdGVycyBhbGxvd2VkIHRvIHJlcGxhY2VcbiAqICAgICAgICAgICAgIGFjY2VwdCA6IC9cXGQvICAgICAgICAgIC8vIGVpdGhlciAnW0EtWl0nIG9yIHJlZ2V4IG9yIHVuZGVmaW5lZFxuICogICAgICAgICB9XVxuICogICAgIH1cbiAqL1xuY2xhc3MgUHJlZml4RmllbGQgZXh0ZW5kcyBCYXNlIHtcbiAgICBzdGF0aWMgY29uZmlnID0ge1xuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7U3RyaW5nfSBjbGFzc05hbWU9J05lby5wbHVnaW4uUHJlZml4RmllbGQnXG4gICAgICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgICAgICovXG4gICAgICAgIGNsYXNzTmFtZTogJ05lby5wbHVnaW4uUHJlZml4RmllbGQnLFxuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7U3RyaW5nfSBudHlwZT0ncGx1Z2luLXByZWZpeGZpZWxkJ1xuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICBudHlwZTogJ3BsdWdpbi1wcmVmaXhmaWVsZCcsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDdXN0b20gY2xzIGFkZGVkIHRvIHRoZSBpbnB1dEVsXG4gICAgICAgICAqIEBtZW1iZXIge1N0cmluZ30gaW5wdXRDbHM9J25lby1wcmVmaXhmaWVsZC1pbnB1dCdcbiAgICAgICAgICovXG4gICAgICAgIGlucHV0Q2xzOiAnbmVvLXByZWZpeGZpZWxkLWlucHV0JyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEN1c3RvbSBjbHMgYWRkZWQgdG8gdGhlIGlucHV0RWxcbiAgICAgICAgICogQG1lbWJlciB7U3RyaW5nfSBpbnB1dENscz0nbmVvLXByZWZpeGZpZWxkLWlucHV0J1xuICAgICAgICAgKi9cbiAgICAgICAgbGFiZWxDbHM6ICduZW8tcHJlZml4ZmllbGQtbGFiZWwnLFxuICAgICAgICAvKipcbiAgICAgICAgICogQ3VzdG9tIGNscyB0byBhZGQgdG8gdGhlIG93bmVyIGNvbXBvbmVudFxuICAgICAgICAgKiBAbWVtYmVyIHtTdHJpbmd9IG93bmVyQ2xzPSduZW8tcHJlZml4ZmllbGQnXG4gICAgICAgICAqL1xuICAgICAgICBvd25lckNsczogJ25lby1wcmVmaXhmaWVsZCcsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiByZWdleCB0byBjYWxjdWxhdGUgaWYgZW50ZXJlZCB2YWx1ZSBpcyBhY2NlcHRhYmxlXG4gICAgICAgICAqIFByZXNldCB0byBudW1iZXJzIG9ubHlcbiAgICAgICAgICpcbiAgICAgICAgICogQG1lbWJlciB7cmVnZXh8bnVsbH0gYWNjZXB0XG4gICAgICAgICAqL1xuICAgICAgICBhY2NlcHRfOiBudWxsLFxuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7U3RyaW5nfSBwYXR0ZXJuPW51bGxcbiAgICAgICAgICovXG4gICAgICAgIHBhdHRlcm5fOiBudWxsLFxuICAgICAgICAvKipcbiAgICAgICAgICogT25seSBhZGQgYSBTdHJpbmcuIEEgU2V0IHdpbGwgYmUgYXV0b21hdGljYWxseSBjcmVhdGVkXG4gICAgICAgICAqIEBtZW1iZXIge1N0cmluZ3xTZXR8bnVsbH0gc2xvdHM9bnVsbFxuICAgICAgICAgKi9cbiAgICAgICAgc2xvdHNfOiBudWxsXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRmlyc3QgYWNjZXB0ZWQgcGxhY2UgdG8gZW50ZXIgYSB2YWx1ZVxuICAgICAqIEBtZW1iZXIge051bWJlcn0gZmlyc3RcbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICovXG4gICAgZmlyc3QgPSBudWxsXG4gICAgLyoqXG4gICAgICogQXJyYXkgb2YgbnVtYmVycywgd2hpY2ggc2hvd3MgdGhlIHByZXZpb3VzIGVudHJ5IHBvaW50XG4gICAgICogQG1lbWJlciB7QXJyYXlbXX0gcHJldlxuICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgKi9cbiAgICBwcmV2ID0gbnVsbFxuICAgIC8qKlxuICAgICAqIFBvc2l0aW9uIG9mIHRoZSBjdXJzb3IgaW5zaWRlIGlucHV0IGVsZW1lbnRcbiAgICAgKiBAbWVtYmVyIHtPYmplY3R9IHNlbGVjdGlvblxuICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgKi9cbiAgICBzZWxlY3Rpb24gPSBudWxsXG5cbiAgICAvKipcbiAgICAgKiBTdGF0ZSBpZiBzZWxlY3Rpb24gc2hvdWxkIGJlIHVwZGF0ZWRcbiAgICAgKiBAbWVtYmVyIHtCb29sZWFufSBpZ25vcmVTZWxlY3Rpb25cbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICovXG4gICAgaWdub3JlU2VsZWN0aW9uID0gZmFsc2VcbiAgICAvKipcbiAgICAgKiBTdGF0ZSBpZiBsYXN0IGVudHJ5IHdhcyB0aGUgYmFjayBidXR0b25cbiAgICAgKiBAbWVtYmVyIHtCb29sZWFufSBiYWNrXG4gICAgICogQHByb3RlY3RlZFxuICAgICAqL1xuICAgIGJhY2sgPSBmYWxzZVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGNvbmZpZ1xuICAgICAqL1xuICAgIGNvbnN0cnVjdChjb25maWcpIHtcbiAgICAgICAgbGV0IG1lID0gdGhpcztcblxuICAgICAgICBzdXBlci5jb25zdHJ1Y3QoY29uZmlnKTtcblxuICAgICAgICBtZS5hZGRMaXN0ZW5lcnMoKTtcbiAgICAgICAgbWUuYWRkQ3NzKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQWRkIGEgY3VzdG9tIGNscyB0byB0aGUgb3duZXIgY29tcG9uZW50XG4gICAgICovXG4gICAgYWRkQ3NzKCkge1xuICAgICAgICBjb25zdCBtZSAgICAgID0gdGhpcyxcbiAgICAgICAgICAgICAge293bmVyfSA9IG1lLFxuICAgICAgICAgICAgICBpbnB1dEVsID0gb3duZXIuZ2V0SW5wdXRFbCgpLFxuICAgICAgICAgICAgICBsYWJlbEVsID0gb3duZXIuZ2V0TGFiZWxFbCgpO1xuXG4gICAgICAgIG93bmVyICAgIC5hZGRDbHMobWUub3duZXJDbHMpO1xuICAgICAgICBpbnB1dEVsLmNscy5wdXNoKG1lLmlucHV0Q2xzKTtcbiAgICAgICAgbGFiZWxFbC5jbHMucHVzaChtZS5sYWJlbENscylcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBZGQgbGlzdGVuZXJzXG4gICAgICogQHByb3RlY3RlZFxuICAgICAqL1xuICAgIGFkZExpc3RlbmVycygpIHtcbiAgICAgICAgbGV0IG1lICAgICAgPSB0aGlzLFxuICAgICAgICAgICAge293bmVyfSA9IG1lO1xuXG4gICAgICAgIG93bmVyLmFkZERvbUxpc3RlbmVycyhbXG4gICAgICAgICAgICB7a2V5ZG93biAgICAgICAgOiBtZS5vbkZpZWxkS2V5RG93biAgICAgICAgLCBzY29wZTogbWV9LFxuICAgICAgICAgICAge2ZvY3VzaW4gICAgICAgIDogbWUub25GaWVsZEZvY3VzICAgICAgICAgICwgc2NvcGU6IG1lfSxcbiAgICAgICAgICAgIHtmb2N1c291dCAgICAgICA6IG1lLm9uRmllbGRCbHVyICAgICAgICAgICAsIHNjb3BlOiBtZX0sXG4gICAgICAgICAgICB7c2VsZWN0aW9uY2hhbmdlOiBtZS5vbkZpZWxkU2VsZWN0aW9uQ2hhbmdlLCBzY29wZTogbWV9XG4gICAgICAgIF0pO1xuXG4gICAgICAgIG1lLm93bmVyLm9uKCdtb3VudGVkJywgKCkgPT4ge1xuICAgICAgICAgICAgTmVvLmN1cnJlbnRXb3JrZXIuaW5zZXJ0VGhlbWVGaWxlcyhvd25lci53aW5kb3dJZCwgbWUuX19wcm90b19fKVxuICAgICAgICB9LCBtZSwge29uY2U6IHRydWV9KVxuICAgIH1cblxuXG4gICAgLyoqXG4gICAgICogQWZ0ZXIgc2V0dGluZyBhY2NlcHQgZm9ybWF0IG91dHB1dFxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSB2YWx1ZVxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBvbGRWYWx1ZVxuICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgKi9cbiAgICBhZnRlclNldEFjY2VwdCh2YWx1ZSwgb2xkVmFsdWUpIHtcbiAgICAgICAgdGhpcy5vd25lci52YWx1ZSAmJiB0aGlzLmZvcm1hdCgpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQWZ0ZXIgc2V0dGluZyBwYXR0ZXJuIHJlY2FsYyBvdGhlciB2YWx1ZXMgYW5kIHNldCBwbGFjZWhvbGRlclxuICAgICAqIEBwYXJhbSB7U2V0fSB2YWx1ZVxuICAgICAqIEBwYXJhbSB7U2V0fSBvbGRWYWx1ZVxuICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgKi9cbiAgICBhZnRlclNldFBhdHRlcm4odmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgIHRoaXMub3duZXIucGxhY2Vob2xkZXJUZXh0ID0gdmFsdWU7XG4gICAgICAgIHRoaXMucmVjYWxjRmlyc3RBbmRQcmVmKClcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBZnRlciBzZXR0aW5nIHNsb3RzIHJlY2FsYyBvdGhlciB2YWx1ZXNcbiAgICAgKiBAcGFyYW0ge1NldH0gdmFsdWVcbiAgICAgKiBAcGFyYW0ge1NldH0gb2xkVmFsdWVcbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICovXG4gICAgYWZ0ZXJTZXRTbG90cyh2YWx1ZSwgb2xkVmFsdWUpIHtcbiAgICAgICAgdGhpcy5yZWNhbGNGaXJzdEFuZFByZWYoKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEJlZm9yZSB0aGUgbmV3IHZhbHVlIGZvciBzbG90cyB3aWxsIGJlIHNldCB3ZSBjcmVhdGUgYSBTZXQgZnJvbSB0aGUgc3RyaW5nXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHZhbHVlXG4gICAgICogQHJldHVybiB7U2V0fVxuICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgKi9cbiAgICBiZWZvcmVTZXRTbG90cyh2YWx1ZSkge1xuICAgICAgICByZXR1cm4gbmV3IFNldCh2YWx1ZSB8fCBcIl9cIilcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZW1vdmUgdW53YW50ZWQgZW50cmllcyBhbmQgbGltaXQgbGVuZ3RoXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IGlucHV0XG4gICAgICogQHJldHVybnMge2FueVtdfVxuICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgKi9cbiAgICBjbGVhbihpbnB1dCkge1xuICAgICAgICBjb25zdCBtZSAgICAgPSB0aGlzLFxuICAgICAgICAgICAgICBhY2NlcHQgPSBuZXcgUmVnRXhwKHRoaXMuYWNjZXB0IHx8IFwiXFxcXGRcIiwgXCJnXCIpO1xuXG4gICAgICAgIGlucHV0ID0gaW5wdXQubWF0Y2goYWNjZXB0KSB8fCBbXTtcbiAgICAgICAgaW5wdXQgPSBBcnJheS5mcm9tKG1lLnBhdHRlcm4sIGMgPT5cbiAgICAgICAgICAgIGlucHV0WzBdID09PSBjIHx8IG1lLnNsb3RzLmhhcyhjKSA/IGlucHV0LnNoaWZ0KCkgfHwgYyA6IGNcbiAgICAgICAgKTtcblxuICAgICAgICByZXR1cm4gaW5wdXQuc2xpY2UoMCwgbWUucGF0dGVybi5sZW5ndGgpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2FsY3VsYXRlIHBvc2l0aW9uIGFuZCBvdXRwdXQgY29ycmVjdCBTdHJpbmcgdG8gRmllbGRcbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICovXG4gICAgZm9ybWF0KCkge1xuICAgICAgICBsZXQgbWUgICAgICAgICAgICAgICAgPSB0aGlzLFxuICAgICAgICAgICAgZWwgICAgICAgICAgICAgICAgPSBtZS5vd25lcixcbiAgICAgICAgICAgIHtwcmV2LCBzZWxlY3Rpb259ID0gbWUsXG4gICAgICAgICAgICBjbGVhbiAgICAgICAgICAgICA9IG1lLmNsZWFuLmJpbmQobWUpLFxuICAgICAgICAgICAgdmFsdWUgICAgICAgICAgICAgPSBlbC52YWx1ZSB8fCAnJztcblxuICAgICAgICBjb25zdCBbaSwgal0gPSBbc2VsZWN0aW9uLnN0YXJ0LCBzZWxlY3Rpb24uZW5kXS5tYXAoaSA9PiB7XG4gICAgICAgICAgICBpID0gbWUuY2xlYW4odmFsdWUuc2xpY2UoMCwgaSkpLmZpbmRJbmRleChjID0+IG1lLnNsb3RzLmhhcyhjKSk7XG4gICAgICAgICAgICByZXR1cm4gaSA8IDAgPyBwcmV2W3ByZXYubGVuZ3RoIC0gMV0gOiBtZS5iYWNrID8gcHJldltpIC0gMV0gfHwgbWUuZmlyc3QgOiBpXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGVsLnZhbHVlID0gY2xlYW4odmFsdWUpLmpvaW5gYDtcbiAgICAgICAgbWUuaWdub3JlU2VsZWN0aW9uID0gdHJ1ZTtcblxuICAgICAgICBOZW8ubWFpbi5Eb21BY2Nlc3Muc2VsZWN0Tm9kZSh7aWQ6IGVsLmdldElucHV0RWxJZCgpLCBzdGFydDogaSwgZW5kOiBqfSk7XG4gICAgICAgIG1lLmlnbm9yZVNlbGVjdGlvbiA9IGZhbHNlO1xuXG4gICAgICAgIG1lLmJhY2sgPSBmYWxzZVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEV2ZW50XG4gICAgICogQHBhcmFtIHtPYmplY3R9IGRhdGFcbiAgICAgKiBAcmV0dXJucyB7ZmFsc2V8c3RyaW5nfVxuICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgKi9cbiAgICBvbkZpZWxkQmx1cihkYXRhKSB7XG4gICAgICAgIGxldCB7b3duZXIsIHBhdHRlcm59ID0gdGhpcztcblxuICAgICAgICByZXR1cm4gb3duZXIudmFsdWUgPT09IHBhdHRlcm4gJiYgKG93bmVyLnZhbHVlID0gJycpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRXZlbnRcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gZGF0YVxuICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgKi9cbiAgICBvbkZpZWxkRm9jdXMoZGF0YSkge1xuICAgICAgICB0aGlzLmZvcm1hdCgpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRXZlbnRcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gZGF0YVxuICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgKi9cbiAgICBvbkZpZWxkS2V5RG93bihkYXRhKSB7XG4gICAgICAgIHRoaXMuYmFjayA9IGRhdGEua2V5ID09PSBcIkJhY2tzcGFjZVwiXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRXZlbnRcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gZGF0YVxuICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgKi9cbiAgICBvbkZpZWxkU2VsZWN0aW9uQ2hhbmdlKGRhdGEpIHtcbiAgICAgICAgbGV0IHNlbCAgPSB0aGlzLnNlbGVjdGlvbixcbiAgICAgICAgICAgIGRTZWwgPSBkYXRhLnNlbGVjdGlvbjtcblxuICAgICAgICAvLyBEbyBub3QgcnVuLCBpZiBpZ25vcmUgc3RhdGUgb3Igc2FtZSBzdGFydCBhbmQgZW5kIGRhdGFcbiAgICAgICAgaWYgKHRoaXMuaWdub3JlU2VsZWN0aW9uIHx8IChkU2VsLnN0YXJ0ID09PSBzZWwuc3RhcnQgJiYgZFNlbC5lbmQgPT09IHNlbC5lbmQpKSB7XG4gICAgICAgICAgICByZXR1cm5cbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuc2VsZWN0aW9uID0gZFNlbDtcbiAgICAgICAgdGhpcy5mb3JtYXQoKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENhbGMgdmFsdWVzIGZvciBmaXJzdCBhbmQgcHJldlxuICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgKi9cbiAgICByZWNhbGNGaXJzdEFuZFByZWYoKSB7XG4gICAgICAgIGxldCBtZSAgICAgICAgICAgICAgID0gdGhpcyxcbiAgICAgICAgICAgIHtwYXR0ZXJuLCBzbG90c30gPSBtZTtcblxuICAgICAgICBtZS5wcmV2ID0gKGogPT4gQXJyYXkuZnJvbShwYXR0ZXJuLCAoYywgaSkgPT4gc2xvdHMuaGFzKGMpID8gaiA9IGkgKyAxIDogaikpKDApO1xuICAgICAgICBtZS5maXJzdCA9IFsuLi5wYXR0ZXJuXS5maW5kSW5kZXgoYyA9PiBzbG90cy5oYXMoYykpO1xuXG4gICAgICAgIG1lLnNlbGVjdGlvbiA9IHtzdGFydDogbWUuZmlyc3QsIGVuZDogbWUuZmlyc3R9O1xuXG4gICAgICAgIG1lLm93bmVyLnZhbHVlICYmIG1lLmZvcm1hdCgpXG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBOZW8uc2V0dXBDbGFzcyhQcmVmaXhGaWVsZCk7XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=