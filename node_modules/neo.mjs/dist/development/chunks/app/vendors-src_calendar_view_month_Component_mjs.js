"use strict";
(self["webpackChunkneo_mjs"] = self["webpackChunkneo_mjs"] || []).push([["vendors-src_calendar_view_month_Component_mjs"],{

/***/ "./src/calendar/view/month/Component.mjs":
/*!***********************************************!*\
  !*** ./src/calendar/view/month/Component.mjs ***!
  \***********************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _component_Base_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../component/Base.mjs */ "./src/component/Base.mjs");
/* harmony import */ var _util_Date_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../util/Date.mjs */ "./src/util/Date.mjs");
/* harmony import */ var _util_Array_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/Array.mjs */ "./src/util/Array.mjs");
/* harmony import */ var _util_VDom_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/VDom.mjs */ "./src/util/VDom.mjs");





const todayDate = new Date();

const today = {
    day  : todayDate.getDate(),
    month: todayDate.getMonth(),
    year : todayDate.getFullYear()
};

/**
 * @class Neo.calendar.view.month.Component
 * @extends Neo.component.Base
 */
class Component extends _component_Base_mjs__WEBPACK_IMPORTED_MODULE_0__["default"] {
    static config = {
        /**
         * @member {String} className='Neo.calendar.view.month.Component'
         * @protected
         */
        className: 'Neo.calendar.view.month.Component',
        /**
         * @member {String[]} baseCls=['neo-calendar-monthcomponent']
         */
        baseCls: ['neo-calendar-monthcomponent'],
        /**
         * @member {Object} bind
         */
        bind: {
            calendarStore: 'stores.calendars',
            currentDate  : data => data.currentDate,
            eventBorder  : data => data.events.border,
            eventStore   : 'stores.events',
            locale       : data => data.locale,
            showWeekends : data => data.showWeekends,
            weekStartDay : data => data.weekStartDay
        },
        /**
         * Bound to the view model
         * @member {Neo.calendar.store.Calendars|null} calendarStore_=null
         */
        calendarStore_: null,
        /**
         * Will get passed from the MainContainer
         * @member {Date|null} currentDate_=null
         * @protected
         */
        currentDate_: null,
        /**
         * The format of the column headers.
         * Valid values are: narrow, short & long
         * @member {String} dayNameFormat_='short'
         */
        dayNameFormat_: 'short',
        /**
         * Bound to the view model
         * @member {String|null} eventBorder_=null
         */
        eventBorder_: null,
        /**
         * Bound to the view model.
         * @member {Neo.calendar.store.Events|null} eventStore_=null
         */
        eventStore_: null,
        /**
         * Internal flag to store the header height in px after getting mounted.
         * Needed for the infinite scrolling
         * @member {Number|null} headerHeight=null
         * @protected
         */
        headerHeight: null,
        /**
         * @member {Intl.DateTimeFormat|null} intlFormat_day=null
         * @protected
         */
        intlFormat_day: null,
        /**
         * @member {Intl.DateTimeFormat|null} intlFormat_month=null
         * @protected
         */
        intlFormat_month: null,
        /**
         * @member {Intl.DateTimeFormat|null} intlFormat_time=null
         * @protected
         */
        intlFormat_time: null,
        /**
         * @member {Boolean} isScrolling=false
         * @protected
         */
        isScrolling: false,
        /**
         * Bound to the view model.
         * @member {String} locale_=Neo.config.locale
         */
        locale_: Neo.config.locale,
        /**
         * The format of the month header names.
         * Valid values are: narrow, short & long
         * @member {String} monthNameFormat_='long'
         */
        monthNameFormat_: 'short',
        /**
         * Internal flag to store if createContent() got called while not being mounted
         * @member {Boolean} needsEventUpdate=false
         * @protected
         */
        needsEventUpdate: false,
        /**
         * @member {Neo.calendar.view.MainContainer|null} owner=null
         * @protected
         */
        owner: null,
        /**
         * @member {String|null} scrollTask=null
         * @protected
         */
        scrollTaskId: null,
        /**
         * Bound to the view model.
         * @member {Boolean} showWeekends_=true
         */
        showWeekends_: true,
        /**
         * @member {Object} timeFormat_={hour:'2-digit',minute:'2-digit'}
         */
        timeFormat_: {hour: '2-digit', minute: '2-digit'},
        /**
         * True to use box shadows for the months while scrolling
         * @member {Boolean} useScrollBoxShadows_=true
         */
        useScrollBoxShadows_: true,
        /**
         * @member {Object} vdom
         */
        vdom:
        {cn: [
            {cls: ['neo-days-header'], cn: [
                {cls: ['neo-static-header'], style: {}, cn: [
                    {tag: 'span', cls: ['neo-month-name'], flag: 'month-name'},
                    {vtype: 'text'}
                ]}
            ]},
            {cls: ['neo-c-m-scrollcontainer']}
        ]},
        /**
         * 0-6 => Sun-Sat
         * Bound to the view model.
         * @member {Number} weekStartDay_=0
         */
        weekStartDay_: 0
    }

    /**
     * @param {Object} config
     */
    construct(config) {
        super.construct(config);

        let me = this;

        me.addDomListeners([
            {dblclick: me.onEventDoubleClick, delegate: 'neo-event', scope: me},
            {wheel   : me.onWheel, scope: me}
        ]);

        if (me.calendarStore.getCount() > 0 && me.eventStore.getCount() > 0) {
            me.needsEventUpdate = true
        }

        me.needsEventUpdate && me.createContent(true);

        me.updateHeader(true)
    }

    /**
     * Triggered after the calendarStore config got changed
     * @param {Neo.calendar.store.Calendars|null} value
     * @param {Neo.calendar.store.Calendars|null} oldValue
     * @protected
     */
    afterSetCalendarStore(value, oldValue) {
        let me = this,

        listeners = {
            load        : me.onCalendarStoreLoad,
            recordChange: me.onCalendarStoreRecordChange,
            scope       : me
        };

        oldValue?.un(listeners);
        value   ?.on(listeners)
    }

    /**
     * Triggered after the currentDate config got changed
     * @param {Date} value
     * @param {Date} oldValue
     * @protected
     */
    afterSetCurrentDate(value, oldValue) {
        let me = this;

        if (me.isConstructed) {
            me.createContent(true);
            me.updateHeader();
            me.afterSetMounted(true, false) // todo: extract the logic into a new method
        }
    }

    /**
     * Triggered after the dayNameFormat config got changed
     * @param {String} value
     * @param {String} oldValue
     * @protected
     */
    afterSetDayNameFormat(value, oldValue) {
        let me = this;

        me.intlFormat_day = new Intl.DateTimeFormat(me.locale, {weekday: value});

        if (oldValue !== undefined) {
            me.updateHeader()
        }
    }

    /**
     * Triggered after the eventBorder config got changed
     * @param {String|null} value
     * @param {String|null} oldValue
     * @protected
     */
    afterSetEventBorder(value, oldValue) {
        let me  = this,
            cls = me.cls;

        oldValue && _util_Array_mjs__WEBPACK_IMPORTED_MODULE_2__["default"].remove(cls, `neo-event-border-${oldValue}`);
        value    && _util_Array_mjs__WEBPACK_IMPORTED_MODULE_2__["default"].add(   cls, `neo-event-border-${value}`);

        me.cls = cls
    }

    /**
     * Triggered after the eventStore config got changed
     * @param {Neo.calendar.store.Events|null} value
     * @param {Neo.calendar.store.Events|null} oldValue
     * @protected
     */
    afterSetEventStore(value, oldValue) {
        let me = this,

        listeners = {
            load        : me.onEventStoreLoad,
            recordChange: me.onEventStoreRecordChange,
            scope       : me
        };

        oldValue?.un(listeners);
        value   ?.on(listeners)
    }

    /**
     * Triggered after the locale config got changed
     * @param {String} value
     * @param {String} oldValue
     * @protected
     */
    afterSetLocale(value, oldValue) {
        if (oldValue) {
            let me = this;

            me.intlFormat_day   = new Intl.DateTimeFormat(value, {weekday: me.dayNameFormat});
            me.intlFormat_month = new Intl.DateTimeFormat(value, {month  : me.monthNameFormat});
            me.intlFormat_time  = new Intl.DateTimeFormat(value, me.timeFormat);

            me.updateMonthNames(true);
            me.updateHeader()
        }
    }

    /**
     * Triggered after the monthNameFormat config got changed
     * @param {String} value
     * @param {String} oldValue
     * @protected
     */
    afterSetMonthNameFormat(value, oldValue) {
        let me = this;

        me.intlFormat_month = new Intl.DateTimeFormat(me.locale, {month: value});

        if (oldValue !== undefined) {
            me.updateMonthNames()
        }
    }

    /**
     * Triggered after the mounted config got changed
     * @param {Boolean} value
     * @param {Boolean} oldValue
     * @protected
     */
    afterSetMounted(value, oldValue) {
        let me = this;

        if (value) {
            if (me.needsEventUpdate) {
                me.createContent();
                me.needsEventUpdate = false;
            }

            setTimeout(() => {
                me.getDomRect([me.vdom.cn[1].id, me.vdom.cn[0].id]).then(data => {
                    me.headerHeight = data[1].height;

                    Neo.main.DomAccess.scrollTo({
                        direction: 'top',
                        id       : me.vdom.cn[1].id,
                        value    : data[0].height - data[1].height
                    });
                })
            }, 100)
        }
    }

    /**
     * Triggered after the showWeekends config got changed
     * @param {Boolean} value
     * @param {Boolean} oldValue
     * @protected
     */
    afterSetShowWeekends(value, oldValue) {
        if (oldValue !== undefined) {
            let me     = this,
                {vdom} = me,
                i, item;

            vdom.cn[1].cn.forEach(row => {
                if (row.flag) {
                    for (i=0; i < 7; i++) {
                        item = row.cn[i];

                        if (item.cls.includes('neo-weekend')) {
                            if (value) {
                                delete item.removeDom
                            } else {
                                item.removeDom = true
                            }
                        }
                    }
                }
            });

            // triggers the vdom update
            me.updateHeader()
        }
    }

    /**
     * Triggered after the timeFormat config got changed
     * @param {Object} value
     * @param {Object} oldValue
     * @protected
     */
    afterSetTimeFormat(value, oldValue) {
        this.intlFormat_time = new Intl.DateTimeFormat(this.locale, value)
    }

    /**
     * Triggered after the useScrollBoxShadows config got changed
     * @param {Boolean} value
     * @param {Boolean} oldValue
     * @protected
     */
    afterSetUseScrollBoxShadows(value, oldValue) {
        _util_Array_mjs__WEBPACK_IMPORTED_MODULE_2__["default"][value ? 'add' : 'remove'](this.vdom.cn[1].cls, 'neo-scroll-shadows');
        this.update()
    }

    /**
     * Triggered after the weekStartDay config got changed
     * @param {Number} value
     * @param {Number} oldValue
     * @protected
     */
    afterSetWeekStartDay(value, oldValue) {
        if (oldValue !== undefined) {
            this.createContent(true);
            this.updateHeader()
        }
    }

    /**
     * Triggered before the dayNameFormat config gets changed
     * @param {String} value
     * @param {String} oldValue
     * @protected
     */
    beforeSetDayNameFormat(value, oldValue) {
        return this.beforeSetEnumValue(value, oldValue, 'dayNameFormat', _util_Date_mjs__WEBPACK_IMPORTED_MODULE_1__["default"].prototype.dayNameFormats)
    }

    /**
     * Triggered before the monthNameFormat config gets changed
     * @param {String} value
     * @param {String} oldValue
     * @protected
     */
    beforeSetMonthNameFormat(value, oldValue) {
        return this.beforeSetEnumValue(value, oldValue, 'monthNameFormat', _util_Date_mjs__WEBPACK_IMPORTED_MODULE_1__["default"].prototype.monthNameFormats)
    }

    /**
     * @param {Boolean} [silent=false]
     */
    createContent(silent=false) {
        let me = this;

        if (!me.mounted) {
            me.needsEventUpdate = true;
        } else {
            let date   = me.currentDate, // cloned
                {vdom} = me,
                i      = 0,
                firstDayOffset, row;

            vdom.cn[1].cn = [];

            firstDayOffset = _util_Date_mjs__WEBPACK_IMPORTED_MODULE_1__["default"].getFirstDayOffset(date, me.weekStartDay);

            date.setDate(1 - firstDayOffset);

            date.setDate(date.getDate() - 6 * 7);

            for (; i < 18; i++) {
                row = me.createWeek(_util_Date_mjs__WEBPACK_IMPORTED_MODULE_1__["default"].clone(date));

                if (row.header) {
                    vdom.cn[1].cn.push(row.header)
                }

                vdom.cn[1].cn.push(row.row);

                date.setDate(date.getDate() + 7)
            }

            me.update()
        }
    }

    /**
     * @param {Date} date
     * @returns {Object}
     */
    createWeek(date) {
        let me                          = this,
            i                           = 0,
            {calendarStore, eventStore} = me,
            header                      = null,
            ymdDate                     = _util_Date_mjs__WEBPACK_IMPORTED_MODULE_1__["default"].convertToyyyymmdd(date),
            calendarRecord, day, dayConfig, dayRecords, recordKey, row, weekDay;

        row = {
            flag: ymdDate,
            cls : ['neo-week'],
            cn  : [],
            id  : `${me.id}__week__${ymdDate}`
        };

        for (; i < 7; i++) {
            day     = date.getDate();
            ymdDate = _util_Date_mjs__WEBPACK_IMPORTED_MODULE_1__["default"].convertToyyyymmdd(date);

            if (day === 1) {
                row.flag = ymdDate; // the first day of a month wins

                header = {
                    cls: ['neo-month-header'],
                    cn : [{
                        cls: ['neo-month-header-content'],
                        cn : [{
                            tag : 'span',
                            cls : ['neo-month-name'],
                            flag: 'month-name',
                            html: me.intlFormat_month.format(date)
                        }, {
                            vtype: 'text',
                            html : ` ${date.getFullYear()}`
                        }]
                    }]
                };
            }

            dayConfig = {
                cls: ['neo-day'],
                id : `${me.id}__day__${ymdDate}`,
                cn : [{
                    cls : ['neo-day-number'],
                    html: day,
                    id : `${me.id}__day_number__${ymdDate}`
                }]
            };

            weekDay = date.getDay();

            if (weekDay === 0 || weekDay === 6) {
                dayConfig.cls.push('neo-weekend');

                if (!me.showWeekends) {
                    dayConfig.removeDom = true;
                }
            }

            if (!dayConfig.removeDom) {
                dayRecords = eventStore.getDayRecords(date);

                dayRecords.forEach(record => {
                    recordKey      = record[eventStore.keyProperty];
                    calendarRecord = calendarStore.get(record.calendarId);

                    if (calendarRecord.active) {
                        dayConfig.cn.push({
                            cls     : ['neo-event', `neo-${calendarRecord.color}`],
                            flag    : recordKey,
                            id      : me.id + '__' + recordKey,
                            tabIndex: -1,

                            cn: [{
                                cls : ['neo-event-title'],
                                html: record.title,
                                id  : me.id + '__title__' + recordKey
                            }, {
                                cls : ['neo-event-time'],
                                html: me.intlFormat_time.format(record.startDate),
                                id  : me.id + '__time__' + recordKey
                            }]
                        });
                    }
                })
            }

            row.cn.push(dayConfig);

            date.setDate(date.getDate() + 1)
        }

        return {header, row}
    }

    /**
     * @param {Object[]} data
     */
    onCalendarStoreLoad(data) {
        this.eventStore.getCount() > 0 && this.createContent()
    }

    /**
     * @param {Object} data
     */
    onCalendarStoreRecordChange(data) {
        this.createContent()
    }

    /**
     * @param {Object} data
     */
    onEventDoubleClick(data) {
        if (this.data.events.enableEdit) {
            let me                   = this,
                {editEventContainer} = me.owner,
                {path}               = data,
                eventNode           = path[0],
                weekNode            = path[2],
                scrollContainerNode = path[3],
                eventVdom           = _util_VDom_mjs__WEBPACK_IMPORTED_MODULE_3__["default"].findVdomChild(me.vdom, eventNode.id).vdom,
                record              = me.eventStore.get(eventVdom.flag),
                style               = editEventContainer.style;

            Object.assign(style, {
                left: `${eventNode.rect.right - weekNode.rect.left + 15}px`,
                top : `${eventNode.rect.top - scrollContainerNode.rect.top + scrollContainerNode.scrollTop - 12}px`,
            });

            editEventContainer.setSilent({
                parentId: path[1].id,
                record,
                style
            });

            editEventContainer.render(true)
        }
    }

    /**
     * @param {Object[]} data
     */
    onEventStoreLoad(data) {
        this.calendarStore.getCount() > 0 && this.createContent()
    }

    /**
     * @param {Object[]} data
     */
    onEventStoreRecordChange(data) {
        this.createContent()
    }

    /**
     * @param {Object} data
     * @param {Object[]} data.oldPath
     * @param {Object[]} data.path
     */
    onFocusChange(data) {
        let {appName}       = this,
            {oldPath, path} = data;

        if (oldPath?.[0]?.cls.includes('neo-event')) {
            Neo.applyDeltas(appName, {id: oldPath[0].id, cls: {remove: ['neo-focus']}})
        }

        if (path?.[0]?.cls.includes('neo-event')) {
            Neo.applyDeltas(appName, {id: path[0].id, cls: {add: ['neo-focus']}})
        }
    }

    /**
     * @param {Object} data
     */
    onWheel(data) {
        if (Math.abs(data.deltaY) > Math.abs(data.deltaX)) {
            let me        = this,
                container = me.vdom.cn[1],
                i         = 0,
                date, len, week;

            // console.log(data.scrollTop, Math.round(data.scrollTop / (data.clientHeight - me.headerHeight) * 6));

            if (data.deltaY > 0 && Math.round(data.scrollTop / (data.clientHeight - me.headerHeight) * 6) > 11) {
                date = new Date(container.cn[container.cn.length - 1].flag);

                date.setDate(date.getDate() - (date.getDay() - me.weekStartDay));

                for (; i < 6; i++) {
                    if (container.cn[1].cls.includes('neo-month-header')) {
                        container.cn.splice(1, 1)
                    }

                    container.cn.shift();

                    date.setDate(date.getDate() + 7);

                    week = me.createWeek(_util_Date_mjs__WEBPACK_IMPORTED_MODULE_1__["default"].clone(date));

                    week.header && container.cn.push(week.header);

                    container.cn.push(week.row)
                }

                me.update()
            }

            else if (data.deltaY < 0 && Math.round(data.scrollTop / (data.clientHeight - me.headerHeight) * 6) < 1) {
                if (container.cn[0].flag) {
                    date = new Date(container.cn[0].flag)
                } else {
                    date = new Date(container.cn[1].flag)
                }

                date.setDate(date.getDate() - (date.getDay() - me.weekStartDay));

                for (; i < 6; i++) {
                    len = container.cn.length;

                    if (container.cn[len - 2].cls.includes('neo-month-header')) {
                        container.cn.splice(len - 2, 1)
                    }

                    container.cn.pop();

                    date.setDate(date.getDate() - 7);

                    week = me.createWeek(_util_Date_mjs__WEBPACK_IMPORTED_MODULE_1__["default"].clone(date));

                    container.cn.unshift(week.row);

                    week.header && container.cn.unshift(week.header)
                }

                me.promiseUpdate(me.vdom).then(() => {
                    Neo.main.DomAccess.scrollTo({
                        direction: 'top',
                        id       : me.vdom.cn[1].id,
                        value    : data.clientHeight - me.headerHeight
                    })
                })
            }

            if (!me.isScrolling) {
                me.isScrolling = true;
                _util_Array_mjs__WEBPACK_IMPORTED_MODULE_2__["default"].add(me.vdom.cn[1].cls, 'neo-is-scrolling');
                me.vdom.cn[0].cn[0].style.opacity = 0;
                me.update()
            }

            me.scrollTaskId && clearTimeout(me.scrollTaskId);

            me.scrollTaskId = setTimeout(me.onWheelEnd.bind(me), 300)
        }
    }

    /**
     *
     */
    onWheelEnd() {
        let me     = this,
            {vdom} = me,
            header = vdom.cn[0].cn[0],
            i      = 6,
            date, flag;

        me.isScrolling = false;

        for (; i < 12; i++) {
            flag = vdom.cn[1].cn[i].flag; // todo: #989 => get the date of the first fully visible row for the header

            if (flag) {
                date = new Date(flag);
                date.setMonth(date.getMonth() + 1);
                header.cn[0].html = me.intlFormat_month.format(date);
                header.cn[1].html = ` ${date.getFullYear()}`;
                break
            }
        }

        _util_Array_mjs__WEBPACK_IMPORTED_MODULE_2__["default"].remove(vdom.cn[1].cls, 'neo-is-scrolling');
        header.style.opacity = 1;
        me.update()

        // todo: #990 => scroll the view to the closest row
    }

    /**
     * @param {Boolean} [create=false]
     */
    updateHeader(create=false) {
        let me     = this,
            date   = me.currentDate, // cloned
            {vdom} = me,
            header = vdom.cn[0].cn[0],
            i      = 1,
            day, node;

        header.cn[0].html = me.intlFormat_month.format(date);
        header.cn[1].html = ` ${date.getFullYear()}`;

        date.setDate(me.currentDate.getDate() - me.currentDate.getDay() + me.weekStartDay);

        for (; i < 8; i++) {
            day = date.getDay();

            if (create) {
                node = {
                    cls : ['neo-day-name'],
                    html: me.intlFormat_day.format(date)
                };

                if (!me.showWeekends && (day === 0 || day === 6)) {
                    node.removeDom = true;
                }

                vdom.cn[0].cn.push(node)
            } else {
                node = vdom.cn[0].cn[i];

                // the method could be called before the header content got created
                if (node) {
                    node.html = me.intlFormat_day.format(date);

                    if (!me.showWeekends && (day === 0 || day === 6)) {
                        node.removeDom = true
                    } else {
                        delete node.removeDom
                    }
                }
            }

            date.setDate(date.getDate() + 1)
        }

        me.update();
    }

    /**
     * @param {Boolean} [silent=false]
     */
    updateMonthNames(silent=false) {
        let me     = this,
            date   = me.currentDate, // cloned
            months = _util_VDom_mjs__WEBPACK_IMPORTED_MODULE_3__["default"].getFlags(me.vdom, 'month-name');

        months.forEach(month => {
            month.html = me.intlFormat_month.format(date);
            date.setMonth(date.getMonth() + 1);
        });

        me.update()
    }
}

Neo.setupClass(Component);

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Component);


/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2h1bmtzL2FwcC92ZW5kb3JzLXNyY19jYWxlbmRhcl92aWV3X21vbnRoX0NvbXBvbmVudF9tanMuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBd0Q7QUFDTDtBQUNDO0FBQ0Q7O0FBRW5EOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsMkRBQWE7QUFDckM7QUFDQTtBQUNBLG9CQUFvQixRQUFRO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLFVBQVU7QUFDOUI7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLFFBQVE7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxvQkFBb0IsbUNBQW1DO0FBQ3ZEO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLFdBQVc7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLFFBQVE7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsYUFBYTtBQUNqQztBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixnQ0FBZ0M7QUFDcEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixhQUFhO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLDBCQUEwQjtBQUM5QztBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQiwwQkFBMEI7QUFDOUM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsMEJBQTBCO0FBQzlDO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLFNBQVM7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixRQUFRO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsUUFBUTtBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixTQUFTO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FB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c0RBQVE7O0FBRTdCO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBOztBQUVBOztBQUVBLGlFQUFlLFNBQVMsRUFBQyIsInNvdXJjZXMiOlsid2VicGFjazovL25lby5tanMvLi9zcmMvY2FsZW5kYXIvdmlldy9tb250aC9Db21wb25lbnQubWpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBCYXNlQ29tcG9uZW50IGZyb20gJy4uLy4uLy4uL2NvbXBvbmVudC9CYXNlLm1qcyc7XG5pbXBvcnQgRGF0ZVV0aWwgICAgICBmcm9tICcuLi8uLi8uLi91dGlsL0RhdGUubWpzJztcbmltcG9ydCBOZW9BcnJheSAgICAgIGZyb20gJy4uLy4uLy4uL3V0aWwvQXJyYXkubWpzJztcbmltcG9ydCBWRG9tVXRpbCAgICAgIGZyb20gJy4uLy4uLy4uL3V0aWwvVkRvbS5tanMnO1xuXG5jb25zdCB0b2RheURhdGUgPSBuZXcgRGF0ZSgpO1xuXG5jb25zdCB0b2RheSA9IHtcbiAgICBkYXkgIDogdG9kYXlEYXRlLmdldERhdGUoKSxcbiAgICBtb250aDogdG9kYXlEYXRlLmdldE1vbnRoKCksXG4gICAgeWVhciA6IHRvZGF5RGF0ZS5nZXRGdWxsWWVhcigpXG59O1xuXG4vKipcbiAqIEBjbGFzcyBOZW8uY2FsZW5kYXIudmlldy5tb250aC5Db21wb25lbnRcbiAqIEBleHRlbmRzIE5lby5jb21wb25lbnQuQmFzZVxuICovXG5jbGFzcyBDb21wb25lbnQgZXh0ZW5kcyBCYXNlQ29tcG9uZW50IHtcbiAgICBzdGF0aWMgY29uZmlnID0ge1xuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7U3RyaW5nfSBjbGFzc05hbWU9J05lby5jYWxlbmRhci52aWV3Lm1vbnRoLkNvbXBvbmVudCdcbiAgICAgICAgICogQHByb3RlY3RlZFxuICAgICAgICAgKi9cbiAgICAgICAgY2xhc3NOYW1lOiAnTmVvLmNhbGVuZGFyLnZpZXcubW9udGguQ29tcG9uZW50JyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge1N0cmluZ1tdfSBiYXNlQ2xzPVsnbmVvLWNhbGVuZGFyLW1vbnRoY29tcG9uZW50J11cbiAgICAgICAgICovXG4gICAgICAgIGJhc2VDbHM6IFsnbmVvLWNhbGVuZGFyLW1vbnRoY29tcG9uZW50J10sXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtPYmplY3R9IGJpbmRcbiAgICAgICAgICovXG4gICAgICAgIGJpbmQ6IHtcbiAgICAgICAgICAgIGNhbGVuZGFyU3RvcmU6ICdzdG9yZXMuY2FsZW5kYXJzJyxcbiAgICAgICAgICAgIGN1cnJlbnREYXRlICA6IGRhdGEgPT4gZGF0YS5jdXJyZW50RGF0ZSxcbiAgICAgICAgICAgIGV2ZW50Qm9yZGVyICA6IGRhdGEgPT4gZGF0YS5ldmVudHMuYm9yZGVyLFxuICAgICAgICAgICAgZXZlbnRTdG9yZSAgIDogJ3N0b3Jlcy5ldmVudHMnLFxuICAgICAgICAgICAgbG9jYWxlICAgICAgIDogZGF0YSA9PiBkYXRhLmxvY2FsZSxcbiAgICAgICAgICAgIHNob3dXZWVrZW5kcyA6IGRhdGEgPT4gZGF0YS5zaG93V2Vla2VuZHMsXG4gICAgICAgICAgICB3ZWVrU3RhcnREYXkgOiBkYXRhID0+IGRhdGEud2Vla1N0YXJ0RGF5XG4gICAgICAgIH0sXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBCb3VuZCB0byB0aGUgdmlldyBtb2RlbFxuICAgICAgICAgKiBAbWVtYmVyIHtOZW8uY2FsZW5kYXIuc3RvcmUuQ2FsZW5kYXJzfG51bGx9IGNhbGVuZGFyU3RvcmVfPW51bGxcbiAgICAgICAgICovXG4gICAgICAgIGNhbGVuZGFyU3RvcmVfOiBudWxsLFxuICAgICAgICAvKipcbiAgICAgICAgICogV2lsbCBnZXQgcGFzc2VkIGZyb20gdGhlIE1haW5Db250YWluZXJcbiAgICAgICAgICogQG1lbWJlciB7RGF0ZXxudWxsfSBjdXJyZW50RGF0ZV89bnVsbFxuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICBjdXJyZW50RGF0ZV86IG51bGwsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgZm9ybWF0IG9mIHRoZSBjb2x1bW4gaGVhZGVycy5cbiAgICAgICAgICogVmFsaWQgdmFsdWVzIGFyZTogbmFycm93LCBzaG9ydCAmIGxvbmdcbiAgICAgICAgICogQG1lbWJlciB7U3RyaW5nfSBkYXlOYW1lRm9ybWF0Xz0nc2hvcnQnXG4gICAgICAgICAqL1xuICAgICAgICBkYXlOYW1lRm9ybWF0XzogJ3Nob3J0JyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEJvdW5kIHRvIHRoZSB2aWV3IG1vZGVsXG4gICAgICAgICAqIEBtZW1iZXIge1N0cmluZ3xudWxsfSBldmVudEJvcmRlcl89bnVsbFxuICAgICAgICAgKi9cbiAgICAgICAgZXZlbnRCb3JkZXJfOiBudWxsLFxuICAgICAgICAvKipcbiAgICAgICAgICogQm91bmQgdG8gdGhlIHZpZXcgbW9kZWwuXG4gICAgICAgICAqIEBtZW1iZXIge05lby5jYWxlbmRhci5zdG9yZS5FdmVudHN8bnVsbH0gZXZlbnRTdG9yZV89bnVsbFxuICAgICAgICAgKi9cbiAgICAgICAgZXZlbnRTdG9yZV86IG51bGwsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbnRlcm5hbCBmbGFnIHRvIHN0b3JlIHRoZSBoZWFkZXIgaGVpZ2h0IGluIHB4IGFmdGVyIGdldHRpbmcgbW91bnRlZC5cbiAgICAgICAgICogTmVlZGVkIGZvciB0aGUgaW5maW5pdGUgc2Nyb2xsaW5nXG4gICAgICAgICAqIEBtZW1iZXIge051bWJlcnxudWxsfSBoZWFkZXJIZWlnaHQ9bnVsbFxuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICBoZWFkZXJIZWlnaHQ6IG51bGwsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtJbnRsLkRhdGVUaW1lRm9ybWF0fG51bGx9IGludGxGb3JtYXRfZGF5PW51bGxcbiAgICAgICAgICogQHByb3RlY3RlZFxuICAgICAgICAgKi9cbiAgICAgICAgaW50bEZvcm1hdF9kYXk6IG51bGwsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtJbnRsLkRhdGVUaW1lRm9ybWF0fG51bGx9IGludGxGb3JtYXRfbW9udGg9bnVsbFxuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICBpbnRsRm9ybWF0X21vbnRoOiBudWxsLFxuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7SW50bC5EYXRlVGltZUZvcm1hdHxudWxsfSBpbnRsRm9ybWF0X3RpbWU9bnVsbFxuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICBpbnRsRm9ybWF0X3RpbWU6IG51bGwsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtCb29sZWFufSBpc1Njcm9sbGluZz1mYWxzZVxuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICBpc1Njcm9sbGluZzogZmFsc2UsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBCb3VuZCB0byB0aGUgdmlldyBtb2RlbC5cbiAgICAgICAgICogQG1lbWJlciB7U3RyaW5nfSBsb2NhbGVfPU5lby5jb25maWcubG9jYWxlXG4gICAgICAgICAqL1xuICAgICAgICBsb2NhbGVfOiBOZW8uY29uZmlnLmxvY2FsZSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBmb3JtYXQgb2YgdGhlIG1vbnRoIGhlYWRlciBuYW1lcy5cbiAgICAgICAgICogVmFsaWQgdmFsdWVzIGFyZTogbmFycm93LCBzaG9ydCAmIGxvbmdcbiAgICAgICAgICogQG1lbWJlciB7U3RyaW5nfSBtb250aE5hbWVGb3JtYXRfPSdsb25nJ1xuICAgICAgICAgKi9cbiAgICAgICAgbW9udGhOYW1lRm9ybWF0XzogJ3Nob3J0JyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEludGVybmFsIGZsYWcgdG8gc3RvcmUgaWYgY3JlYXRlQ29udGVudCgpIGdvdCBjYWxsZWQgd2hpbGUgbm90IGJlaW5nIG1vdW50ZWRcbiAgICAgICAgICogQG1lbWJlciB7Qm9vbGVhbn0gbmVlZHNFdmVudFVwZGF0ZT1mYWxzZVxuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICBuZWVkc0V2ZW50VXBkYXRlOiBmYWxzZSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge05lby5jYWxlbmRhci52aWV3Lk1haW5Db250YWluZXJ8bnVsbH0gb3duZXI9bnVsbFxuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICBvd25lcjogbnVsbCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge1N0cmluZ3xudWxsfSBzY3JvbGxUYXNrPW51bGxcbiAgICAgICAgICogQHByb3RlY3RlZFxuICAgICAgICAgKi9cbiAgICAgICAgc2Nyb2xsVGFza0lkOiBudWxsLFxuICAgICAgICAvKipcbiAgICAgICAgICogQm91bmQgdG8gdGhlIHZpZXcgbW9kZWwuXG4gICAgICAgICAqIEBtZW1iZXIge0Jvb2xlYW59IHNob3dXZWVrZW5kc189dHJ1ZVxuICAgICAgICAgKi9cbiAgICAgICAgc2hvd1dlZWtlbmRzXzogdHJ1ZSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge09iamVjdH0gdGltZUZvcm1hdF89e2hvdXI6JzItZGlnaXQnLG1pbnV0ZTonMi1kaWdpdCd9XG4gICAgICAgICAqL1xuICAgICAgICB0aW1lRm9ybWF0Xzoge2hvdXI6ICcyLWRpZ2l0JywgbWludXRlOiAnMi1kaWdpdCd9LFxuICAgICAgICAvKipcbiAgICAgICAgICogVHJ1ZSB0byB1c2UgYm94IHNoYWRvd3MgZm9yIHRoZSBtb250aHMgd2hpbGUgc2Nyb2xsaW5nXG4gICAgICAgICAqIEBtZW1iZXIge0Jvb2xlYW59IHVzZVNjcm9sbEJveFNoYWRvd3NfPXRydWVcbiAgICAgICAgICovXG4gICAgICAgIHVzZVNjcm9sbEJveFNoYWRvd3NfOiB0cnVlLFxuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7T2JqZWN0fSB2ZG9tXG4gICAgICAgICAqL1xuICAgICAgICB2ZG9tOlxuICAgICAgICB7Y246IFtcbiAgICAgICAgICAgIHtjbHM6IFsnbmVvLWRheXMtaGVhZGVyJ10sIGNuOiBbXG4gICAgICAgICAgICAgICAge2NsczogWyduZW8tc3RhdGljLWhlYWRlciddLCBzdHlsZToge30sIGNuOiBbXG4gICAgICAgICAgICAgICAgICAgIHt0YWc6ICdzcGFuJywgY2xzOiBbJ25lby1tb250aC1uYW1lJ10sIGZsYWc6ICdtb250aC1uYW1lJ30sXG4gICAgICAgICAgICAgICAgICAgIHt2dHlwZTogJ3RleHQnfVxuICAgICAgICAgICAgICAgIF19XG4gICAgICAgICAgICBdfSxcbiAgICAgICAgICAgIHtjbHM6IFsnbmVvLWMtbS1zY3JvbGxjb250YWluZXInXX1cbiAgICAgICAgXX0sXG4gICAgICAgIC8qKlxuICAgICAgICAgKiAwLTYgPT4gU3VuLVNhdFxuICAgICAgICAgKiBCb3VuZCB0byB0aGUgdmlldyBtb2RlbC5cbiAgICAgICAgICogQG1lbWJlciB7TnVtYmVyfSB3ZWVrU3RhcnREYXlfPTBcbiAgICAgICAgICovXG4gICAgICAgIHdlZWtTdGFydERheV86IDBcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gY29uZmlnXG4gICAgICovXG4gICAgY29uc3RydWN0KGNvbmZpZykge1xuICAgICAgICBzdXBlci5jb25zdHJ1Y3QoY29uZmlnKTtcblxuICAgICAgICBsZXQgbWUgPSB0aGlzO1xuXG4gICAgICAgIG1lLmFkZERvbUxpc3RlbmVycyhbXG4gICAgICAgICAgICB7ZGJsY2xpY2s6IG1lLm9uRXZlbnREb3VibGVDbGljaywgZGVsZWdhdGU6ICduZW8tZXZlbnQnLCBzY29wZTogbWV9LFxuICAgICAgICAgICAge3doZWVsICAgOiBtZS5vbldoZWVsLCBzY29wZTogbWV9XG4gICAgICAgIF0pO1xuXG4gICAgICAgIGlmIChtZS5jYWxlbmRhclN0b3JlLmdldENvdW50KCkgPiAwICYmIG1lLmV2ZW50U3RvcmUuZ2V0Q291bnQoKSA+IDApIHtcbiAgICAgICAgICAgIG1lLm5lZWRzRXZlbnRVcGRhdGUgPSB0cnVlXG4gICAgICAgIH1cblxuICAgICAgICBtZS5uZWVkc0V2ZW50VXBkYXRlICYmIG1lLmNyZWF0ZUNvbnRlbnQodHJ1ZSk7XG5cbiAgICAgICAgbWUudXBkYXRlSGVhZGVyKHRydWUpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVHJpZ2dlcmVkIGFmdGVyIHRoZSBjYWxlbmRhclN0b3JlIGNvbmZpZyBnb3QgY2hhbmdlZFxuICAgICAqIEBwYXJhbSB7TmVvLmNhbGVuZGFyLnN0b3JlLkNhbGVuZGFyc3xudWxsfSB2YWx1ZVxuICAgICAqIEBwYXJhbSB7TmVvLmNhbGVuZGFyLnN0b3JlLkNhbGVuZGFyc3xudWxsfSBvbGRWYWx1ZVxuICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgKi9cbiAgICBhZnRlclNldENhbGVuZGFyU3RvcmUodmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgIGxldCBtZSA9IHRoaXMsXG5cbiAgICAgICAgbGlzdGVuZXJzID0ge1xuICAgICAgICAgICAgbG9hZCAgICAgICAgOiBtZS5vbkNhbGVuZGFyU3RvcmVMb2FkLFxuICAgICAgICAgICAgcmVjb3JkQ2hhbmdlOiBtZS5vbkNhbGVuZGFyU3RvcmVSZWNvcmRDaGFuZ2UsXG4gICAgICAgICAgICBzY29wZSAgICAgICA6IG1lXG4gICAgICAgIH07XG5cbiAgICAgICAgb2xkVmFsdWU/LnVuKGxpc3RlbmVycyk7XG4gICAgICAgIHZhbHVlICAgPy5vbihsaXN0ZW5lcnMpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVHJpZ2dlcmVkIGFmdGVyIHRoZSBjdXJyZW50RGF0ZSBjb25maWcgZ290IGNoYW5nZWRcbiAgICAgKiBAcGFyYW0ge0RhdGV9IHZhbHVlXG4gICAgICogQHBhcmFtIHtEYXRlfSBvbGRWYWx1ZVxuICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgKi9cbiAgICBhZnRlclNldEN1cnJlbnREYXRlKHZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICBsZXQgbWUgPSB0aGlzO1xuXG4gICAgICAgIGlmIChtZS5pc0NvbnN0cnVjdGVkKSB7XG4gICAgICAgICAgICBtZS5jcmVhdGVDb250ZW50KHRydWUpO1xuICAgICAgICAgICAgbWUudXBkYXRlSGVhZGVyKCk7XG4gICAgICAgICAgICBtZS5hZnRlclNldE1vdW50ZWQodHJ1ZSwgZmFsc2UpIC8vIHRvZG86IGV4dHJhY3QgdGhlIGxvZ2ljIGludG8gYSBuZXcgbWV0aG9kXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUcmlnZ2VyZWQgYWZ0ZXIgdGhlIGRheU5hbWVGb3JtYXQgY29uZmlnIGdvdCBjaGFuZ2VkXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHZhbHVlXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IG9sZFZhbHVlXG4gICAgICogQHByb3RlY3RlZFxuICAgICAqL1xuICAgIGFmdGVyU2V0RGF5TmFtZUZvcm1hdCh2YWx1ZSwgb2xkVmFsdWUpIHtcbiAgICAgICAgbGV0IG1lID0gdGhpcztcblxuICAgICAgICBtZS5pbnRsRm9ybWF0X2RheSA9IG5ldyBJbnRsLkRhdGVUaW1lRm9ybWF0KG1lLmxvY2FsZSwge3dlZWtkYXk6IHZhbHVlfSk7XG5cbiAgICAgICAgaWYgKG9sZFZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIG1lLnVwZGF0ZUhlYWRlcigpXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUcmlnZ2VyZWQgYWZ0ZXIgdGhlIGV2ZW50Qm9yZGVyIGNvbmZpZyBnb3QgY2hhbmdlZFxuICAgICAqIEBwYXJhbSB7U3RyaW5nfG51bGx9IHZhbHVlXG4gICAgICogQHBhcmFtIHtTdHJpbmd8bnVsbH0gb2xkVmFsdWVcbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICovXG4gICAgYWZ0ZXJTZXRFdmVudEJvcmRlcih2YWx1ZSwgb2xkVmFsdWUpIHtcbiAgICAgICAgbGV0IG1lICA9IHRoaXMsXG4gICAgICAgICAgICBjbHMgPSBtZS5jbHM7XG5cbiAgICAgICAgb2xkVmFsdWUgJiYgTmVvQXJyYXkucmVtb3ZlKGNscywgYG5lby1ldmVudC1ib3JkZXItJHtvbGRWYWx1ZX1gKTtcbiAgICAgICAgdmFsdWUgICAgJiYgTmVvQXJyYXkuYWRkKCAgIGNscywgYG5lby1ldmVudC1ib3JkZXItJHt2YWx1ZX1gKTtcblxuICAgICAgICBtZS5jbHMgPSBjbHNcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUcmlnZ2VyZWQgYWZ0ZXIgdGhlIGV2ZW50U3RvcmUgY29uZmlnIGdvdCBjaGFuZ2VkXG4gICAgICogQHBhcmFtIHtOZW8uY2FsZW5kYXIuc3RvcmUuRXZlbnRzfG51bGx9IHZhbHVlXG4gICAgICogQHBhcmFtIHtOZW8uY2FsZW5kYXIuc3RvcmUuRXZlbnRzfG51bGx9IG9sZFZhbHVlXG4gICAgICogQHByb3RlY3RlZFxuICAgICAqL1xuICAgIGFmdGVyU2V0RXZlbnRTdG9yZSh2YWx1ZSwgb2xkVmFsdWUpIHtcbiAgICAgICAgbGV0IG1lID0gdGhpcyxcblxuICAgICAgICBsaXN0ZW5lcnMgPSB7XG4gICAgICAgICAgICBsb2FkICAgICAgICA6IG1lLm9uRXZlbnRTdG9yZUxvYWQsXG4gICAgICAgICAgICByZWNvcmRDaGFuZ2U6IG1lLm9uRXZlbnRTdG9yZVJlY29yZENoYW5nZSxcbiAgICAgICAgICAgIHNjb3BlICAgICAgIDogbWVcbiAgICAgICAgfTtcblxuICAgICAgICBvbGRWYWx1ZT8udW4obGlzdGVuZXJzKTtcbiAgICAgICAgdmFsdWUgICA/Lm9uKGxpc3RlbmVycylcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUcmlnZ2VyZWQgYWZ0ZXIgdGhlIGxvY2FsZSBjb25maWcgZ290IGNoYW5nZWRcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gdmFsdWVcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gb2xkVmFsdWVcbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICovXG4gICAgYWZ0ZXJTZXRMb2NhbGUodmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgIGlmIChvbGRWYWx1ZSkge1xuICAgICAgICAgICAgbGV0IG1lID0gdGhpcztcblxuICAgICAgICAgICAgbWUuaW50bEZvcm1hdF9kYXkgICA9IG5ldyBJbnRsLkRhdGVUaW1lRm9ybWF0KHZhbHVlLCB7d2Vla2RheTogbWUuZGF5TmFtZUZvcm1hdH0pO1xuICAgICAgICAgICAgbWUuaW50bEZvcm1hdF9tb250aCA9IG5ldyBJbnRsLkRhdGVUaW1lRm9ybWF0KHZhbHVlLCB7bW9udGggIDogbWUubW9udGhOYW1lRm9ybWF0fSk7XG4gICAgICAgICAgICBtZS5pbnRsRm9ybWF0X3RpbWUgID0gbmV3IEludGwuRGF0ZVRpbWVGb3JtYXQodmFsdWUsIG1lLnRpbWVGb3JtYXQpO1xuXG4gICAgICAgICAgICBtZS51cGRhdGVNb250aE5hbWVzKHRydWUpO1xuICAgICAgICAgICAgbWUudXBkYXRlSGVhZGVyKClcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRyaWdnZXJlZCBhZnRlciB0aGUgbW9udGhOYW1lRm9ybWF0IGNvbmZpZyBnb3QgY2hhbmdlZFxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSB2YWx1ZVxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBvbGRWYWx1ZVxuICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgKi9cbiAgICBhZnRlclNldE1vbnRoTmFtZUZvcm1hdCh2YWx1ZSwgb2xkVmFsdWUpIHtcbiAgICAgICAgbGV0IG1lID0gdGhpcztcblxuICAgICAgICBtZS5pbnRsRm9ybWF0X21vbnRoID0gbmV3IEludGwuRGF0ZVRpbWVGb3JtYXQobWUubG9jYWxlLCB7bW9udGg6IHZhbHVlfSk7XG5cbiAgICAgICAgaWYgKG9sZFZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIG1lLnVwZGF0ZU1vbnRoTmFtZXMoKVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVHJpZ2dlcmVkIGFmdGVyIHRoZSBtb3VudGVkIGNvbmZpZyBnb3QgY2hhbmdlZFxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gdmFsdWVcbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IG9sZFZhbHVlXG4gICAgICogQHByb3RlY3RlZFxuICAgICAqL1xuICAgIGFmdGVyU2V0TW91bnRlZCh2YWx1ZSwgb2xkVmFsdWUpIHtcbiAgICAgICAgbGV0IG1lID0gdGhpcztcblxuICAgICAgICBpZiAodmFsdWUpIHtcbiAgICAgICAgICAgIGlmIChtZS5uZWVkc0V2ZW50VXBkYXRlKSB7XG4gICAgICAgICAgICAgICAgbWUuY3JlYXRlQ29udGVudCgpO1xuICAgICAgICAgICAgICAgIG1lLm5lZWRzRXZlbnRVcGRhdGUgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgbWUuZ2V0RG9tUmVjdChbbWUudmRvbS5jblsxXS5pZCwgbWUudmRvbS5jblswXS5pZF0pLnRoZW4oZGF0YSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIG1lLmhlYWRlckhlaWdodCA9IGRhdGFbMV0uaGVpZ2h0O1xuXG4gICAgICAgICAgICAgICAgICAgIE5lby5tYWluLkRvbUFjY2Vzcy5zY3JvbGxUbyh7XG4gICAgICAgICAgICAgICAgICAgICAgICBkaXJlY3Rpb246ICd0b3AnLFxuICAgICAgICAgICAgICAgICAgICAgICAgaWQgICAgICAgOiBtZS52ZG9tLmNuWzFdLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgICAgOiBkYXRhWzBdLmhlaWdodCAtIGRhdGFbMV0uaGVpZ2h0XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9LCAxMDApXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUcmlnZ2VyZWQgYWZ0ZXIgdGhlIHNob3dXZWVrZW5kcyBjb25maWcgZ290IGNoYW5nZWRcbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IHZhbHVlXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBvbGRWYWx1ZVxuICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgKi9cbiAgICBhZnRlclNldFNob3dXZWVrZW5kcyh2YWx1ZSwgb2xkVmFsdWUpIHtcbiAgICAgICAgaWYgKG9sZFZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGxldCBtZSAgICAgPSB0aGlzLFxuICAgICAgICAgICAgICAgIHt2ZG9tfSA9IG1lLFxuICAgICAgICAgICAgICAgIGksIGl0ZW07XG5cbiAgICAgICAgICAgIHZkb20uY25bMV0uY24uZm9yRWFjaChyb3cgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChyb3cuZmxhZykge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGk9MDsgaSA8IDc7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbSA9IHJvdy5jbltpXTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uY2xzLmluY2x1ZGVzKCduZW8td2Vla2VuZCcpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBpdGVtLnJlbW92ZURvbVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0ucmVtb3ZlRG9tID0gdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyB0cmlnZ2VycyB0aGUgdmRvbSB1cGRhdGVcbiAgICAgICAgICAgIG1lLnVwZGF0ZUhlYWRlcigpXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUcmlnZ2VyZWQgYWZ0ZXIgdGhlIHRpbWVGb3JtYXQgY29uZmlnIGdvdCBjaGFuZ2VkXG4gICAgICogQHBhcmFtIHtPYmplY3R9IHZhbHVlXG4gICAgICogQHBhcmFtIHtPYmplY3R9IG9sZFZhbHVlXG4gICAgICogQHByb3RlY3RlZFxuICAgICAqL1xuICAgIGFmdGVyU2V0VGltZUZvcm1hdCh2YWx1ZSwgb2xkVmFsdWUpIHtcbiAgICAgICAgdGhpcy5pbnRsRm9ybWF0X3RpbWUgPSBuZXcgSW50bC5EYXRlVGltZUZvcm1hdCh0aGlzLmxvY2FsZSwgdmFsdWUpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVHJpZ2dlcmVkIGFmdGVyIHRoZSB1c2VTY3JvbGxCb3hTaGFkb3dzIGNvbmZpZyBnb3QgY2hhbmdlZFxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gdmFsdWVcbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IG9sZFZhbHVlXG4gICAgICogQHByb3RlY3RlZFxuICAgICAqL1xuICAgIGFmdGVyU2V0VXNlU2Nyb2xsQm94U2hhZG93cyh2YWx1ZSwgb2xkVmFsdWUpIHtcbiAgICAgICAgTmVvQXJyYXlbdmFsdWUgPyAnYWRkJyA6ICdyZW1vdmUnXSh0aGlzLnZkb20uY25bMV0uY2xzLCAnbmVvLXNjcm9sbC1zaGFkb3dzJyk7XG4gICAgICAgIHRoaXMudXBkYXRlKClcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUcmlnZ2VyZWQgYWZ0ZXIgdGhlIHdlZWtTdGFydERheSBjb25maWcgZ290IGNoYW5nZWRcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gdmFsdWVcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gb2xkVmFsdWVcbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICovXG4gICAgYWZ0ZXJTZXRXZWVrU3RhcnREYXkodmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgIGlmIChvbGRWYWx1ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmNyZWF0ZUNvbnRlbnQodHJ1ZSk7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZUhlYWRlcigpXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUcmlnZ2VyZWQgYmVmb3JlIHRoZSBkYXlOYW1lRm9ybWF0IGNvbmZpZyBnZXRzIGNoYW5nZWRcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gdmFsdWVcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gb2xkVmFsdWVcbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICovXG4gICAgYmVmb3JlU2V0RGF5TmFtZUZvcm1hdCh2YWx1ZSwgb2xkVmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYmVmb3JlU2V0RW51bVZhbHVlKHZhbHVlLCBvbGRWYWx1ZSwgJ2RheU5hbWVGb3JtYXQnLCBEYXRlVXRpbC5wcm90b3R5cGUuZGF5TmFtZUZvcm1hdHMpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVHJpZ2dlcmVkIGJlZm9yZSB0aGUgbW9udGhOYW1lRm9ybWF0IGNvbmZpZyBnZXRzIGNoYW5nZWRcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gdmFsdWVcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gb2xkVmFsdWVcbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICovXG4gICAgYmVmb3JlU2V0TW9udGhOYW1lRm9ybWF0KHZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5iZWZvcmVTZXRFbnVtVmFsdWUodmFsdWUsIG9sZFZhbHVlLCAnbW9udGhOYW1lRm9ybWF0JywgRGF0ZVV0aWwucHJvdG90eXBlLm1vbnRoTmFtZUZvcm1hdHMpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBbc2lsZW50PWZhbHNlXVxuICAgICAqL1xuICAgIGNyZWF0ZUNvbnRlbnQoc2lsZW50PWZhbHNlKSB7XG4gICAgICAgIGxldCBtZSA9IHRoaXM7XG5cbiAgICAgICAgaWYgKCFtZS5tb3VudGVkKSB7XG4gICAgICAgICAgICBtZS5uZWVkc0V2ZW50VXBkYXRlID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGxldCBkYXRlICAgPSBtZS5jdXJyZW50RGF0ZSwgLy8gY2xvbmVkXG4gICAgICAgICAgICAgICAge3Zkb219ID0gbWUsXG4gICAgICAgICAgICAgICAgaSAgICAgID0gMCxcbiAgICAgICAgICAgICAgICBmaXJzdERheU9mZnNldCwgcm93O1xuXG4gICAgICAgICAgICB2ZG9tLmNuWzFdLmNuID0gW107XG5cbiAgICAgICAgICAgIGZpcnN0RGF5T2Zmc2V0ID0gRGF0ZVV0aWwuZ2V0Rmlyc3REYXlPZmZzZXQoZGF0ZSwgbWUud2Vla1N0YXJ0RGF5KTtcblxuICAgICAgICAgICAgZGF0ZS5zZXREYXRlKDEgLSBmaXJzdERheU9mZnNldCk7XG5cbiAgICAgICAgICAgIGRhdGUuc2V0RGF0ZShkYXRlLmdldERhdGUoKSAtIDYgKiA3KTtcblxuICAgICAgICAgICAgZm9yICg7IGkgPCAxODsgaSsrKSB7XG4gICAgICAgICAgICAgICAgcm93ID0gbWUuY3JlYXRlV2VlayhEYXRlVXRpbC5jbG9uZShkYXRlKSk7XG5cbiAgICAgICAgICAgICAgICBpZiAocm93LmhlYWRlcikge1xuICAgICAgICAgICAgICAgICAgICB2ZG9tLmNuWzFdLmNuLnB1c2gocm93LmhlYWRlcilcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2ZG9tLmNuWzFdLmNuLnB1c2gocm93LnJvdyk7XG5cbiAgICAgICAgICAgICAgICBkYXRlLnNldERhdGUoZGF0ZS5nZXREYXRlKCkgKyA3KVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBtZS51cGRhdGUoKVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtEYXRlfSBkYXRlXG4gICAgICogQHJldHVybnMge09iamVjdH1cbiAgICAgKi9cbiAgICBjcmVhdGVXZWVrKGRhdGUpIHtcbiAgICAgICAgbGV0IG1lICAgICAgICAgICAgICAgICAgICAgICAgICA9IHRoaXMsXG4gICAgICAgICAgICBpICAgICAgICAgICAgICAgICAgICAgICAgICAgPSAwLFxuICAgICAgICAgICAge2NhbGVuZGFyU3RvcmUsIGV2ZW50U3RvcmV9ID0gbWUsXG4gICAgICAgICAgICBoZWFkZXIgICAgICAgICAgICAgICAgICAgICAgPSBudWxsLFxuICAgICAgICAgICAgeW1kRGF0ZSAgICAgICAgICAgICAgICAgICAgID0gRGF0ZVV0aWwuY29udmVydFRveXl5eW1tZGQoZGF0ZSksXG4gICAgICAgICAgICBjYWxlbmRhclJlY29yZCwgZGF5LCBkYXlDb25maWcsIGRheVJlY29yZHMsIHJlY29yZEtleSwgcm93LCB3ZWVrRGF5O1xuXG4gICAgICAgIHJvdyA9IHtcbiAgICAgICAgICAgIGZsYWc6IHltZERhdGUsXG4gICAgICAgICAgICBjbHMgOiBbJ25lby13ZWVrJ10sXG4gICAgICAgICAgICBjbiAgOiBbXSxcbiAgICAgICAgICAgIGlkICA6IGAke21lLmlkfV9fd2Vla19fJHt5bWREYXRlfWBcbiAgICAgICAgfTtcblxuICAgICAgICBmb3IgKDsgaSA8IDc7IGkrKykge1xuICAgICAgICAgICAgZGF5ICAgICA9IGRhdGUuZ2V0RGF0ZSgpO1xuICAgICAgICAgICAgeW1kRGF0ZSA9IERhdGVVdGlsLmNvbnZlcnRUb3l5eXltbWRkKGRhdGUpO1xuXG4gICAgICAgICAgICBpZiAoZGF5ID09PSAxKSB7XG4gICAgICAgICAgICAgICAgcm93LmZsYWcgPSB5bWREYXRlOyAvLyB0aGUgZmlyc3QgZGF5IG9mIGEgbW9udGggd2luc1xuXG4gICAgICAgICAgICAgICAgaGVhZGVyID0ge1xuICAgICAgICAgICAgICAgICAgICBjbHM6IFsnbmVvLW1vbnRoLWhlYWRlciddLFxuICAgICAgICAgICAgICAgICAgICBjbiA6IFt7XG4gICAgICAgICAgICAgICAgICAgICAgICBjbHM6IFsnbmVvLW1vbnRoLWhlYWRlci1jb250ZW50J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBjbiA6IFt7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFnIDogJ3NwYW4nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNscyA6IFsnbmVvLW1vbnRoLW5hbWUnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbGFnOiAnbW9udGgtbmFtZScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaHRtbDogbWUuaW50bEZvcm1hdF9tb250aC5mb3JtYXQoZGF0ZSlcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2dHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGh0bWwgOiBgICR7ZGF0ZS5nZXRGdWxsWWVhcigpfWBcbiAgICAgICAgICAgICAgICAgICAgICAgIH1dXG4gICAgICAgICAgICAgICAgICAgIH1dXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZGF5Q29uZmlnID0ge1xuICAgICAgICAgICAgICAgIGNsczogWyduZW8tZGF5J10sXG4gICAgICAgICAgICAgICAgaWQgOiBgJHttZS5pZH1fX2RheV9fJHt5bWREYXRlfWAsXG4gICAgICAgICAgICAgICAgY24gOiBbe1xuICAgICAgICAgICAgICAgICAgICBjbHMgOiBbJ25lby1kYXktbnVtYmVyJ10sXG4gICAgICAgICAgICAgICAgICAgIGh0bWw6IGRheSxcbiAgICAgICAgICAgICAgICAgICAgaWQgOiBgJHttZS5pZH1fX2RheV9udW1iZXJfXyR7eW1kRGF0ZX1gXG4gICAgICAgICAgICAgICAgfV1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHdlZWtEYXkgPSBkYXRlLmdldERheSgpO1xuXG4gICAgICAgICAgICBpZiAod2Vla0RheSA9PT0gMCB8fCB3ZWVrRGF5ID09PSA2KSB7XG4gICAgICAgICAgICAgICAgZGF5Q29uZmlnLmNscy5wdXNoKCduZW8td2Vla2VuZCcpO1xuXG4gICAgICAgICAgICAgICAgaWYgKCFtZS5zaG93V2Vla2VuZHMpIHtcbiAgICAgICAgICAgICAgICAgICAgZGF5Q29uZmlnLnJlbW92ZURvbSA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIWRheUNvbmZpZy5yZW1vdmVEb20pIHtcbiAgICAgICAgICAgICAgICBkYXlSZWNvcmRzID0gZXZlbnRTdG9yZS5nZXREYXlSZWNvcmRzKGRhdGUpO1xuXG4gICAgICAgICAgICAgICAgZGF5UmVjb3Jkcy5mb3JFYWNoKHJlY29yZCA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJlY29yZEtleSAgICAgID0gcmVjb3JkW2V2ZW50U3RvcmUua2V5UHJvcGVydHldO1xuICAgICAgICAgICAgICAgICAgICBjYWxlbmRhclJlY29yZCA9IGNhbGVuZGFyU3RvcmUuZ2V0KHJlY29yZC5jYWxlbmRhcklkKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoY2FsZW5kYXJSZWNvcmQuYWN0aXZlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXlDb25maWcuY24ucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xzICAgICA6IFsnbmVvLWV2ZW50JywgYG5lby0ke2NhbGVuZGFyUmVjb3JkLmNvbG9yfWBdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZsYWcgICAgOiByZWNvcmRLZXksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQgICAgICA6IG1lLmlkICsgJ19fJyArIHJlY29yZEtleSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJJbmRleDogLTEsXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbjogW3tcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xzIDogWyduZW8tZXZlbnQtdGl0bGUnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaHRtbDogcmVjb3JkLnRpdGxlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZCAgOiBtZS5pZCArICdfX3RpdGxlX18nICsgcmVjb3JkS2V5XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbHMgOiBbJ25lby1ldmVudC10aW1lJ10sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGh0bWw6IG1lLmludGxGb3JtYXRfdGltZS5mb3JtYXQocmVjb3JkLnN0YXJ0RGF0ZSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkICA6IG1lLmlkICsgJ19fdGltZV9fJyArIHJlY29yZEtleVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1dXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJvdy5jbi5wdXNoKGRheUNvbmZpZyk7XG5cbiAgICAgICAgICAgIGRhdGUuc2V0RGF0ZShkYXRlLmdldERhdGUoKSArIDEpXG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4ge2hlYWRlciwgcm93fVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0W119IGRhdGFcbiAgICAgKi9cbiAgICBvbkNhbGVuZGFyU3RvcmVMb2FkKGRhdGEpIHtcbiAgICAgICAgdGhpcy5ldmVudFN0b3JlLmdldENvdW50KCkgPiAwICYmIHRoaXMuY3JlYXRlQ29udGVudCgpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGRhdGFcbiAgICAgKi9cbiAgICBvbkNhbGVuZGFyU3RvcmVSZWNvcmRDaGFuZ2UoZGF0YSkge1xuICAgICAgICB0aGlzLmNyZWF0ZUNvbnRlbnQoKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhXG4gICAgICovXG4gICAgb25FdmVudERvdWJsZUNsaWNrKGRhdGEpIHtcbiAgICAgICAgaWYgKHRoaXMuZGF0YS5ldmVudHMuZW5hYmxlRWRpdCkge1xuICAgICAgICAgICAgbGV0IG1lICAgICAgICAgICAgICAgICAgID0gdGhpcyxcbiAgICAgICAgICAgICAgICB7ZWRpdEV2ZW50Q29udGFpbmVyfSA9IG1lLm93bmVyLFxuICAgICAgICAgICAgICAgIHtwYXRofSAgICAgICAgICAgICAgID0gZGF0YSxcbiAgICAgICAgICAgICAgICBldmVudE5vZGUgICAgICAgICAgID0gcGF0aFswXSxcbiAgICAgICAgICAgICAgICB3ZWVrTm9kZSAgICAgICAgICAgID0gcGF0aFsyXSxcbiAgICAgICAgICAgICAgICBzY3JvbGxDb250YWluZXJOb2RlID0gcGF0aFszXSxcbiAgICAgICAgICAgICAgICBldmVudFZkb20gICAgICAgICAgID0gVkRvbVV0aWwuZmluZFZkb21DaGlsZChtZS52ZG9tLCBldmVudE5vZGUuaWQpLnZkb20sXG4gICAgICAgICAgICAgICAgcmVjb3JkICAgICAgICAgICAgICA9IG1lLmV2ZW50U3RvcmUuZ2V0KGV2ZW50VmRvbS5mbGFnKSxcbiAgICAgICAgICAgICAgICBzdHlsZSAgICAgICAgICAgICAgID0gZWRpdEV2ZW50Q29udGFpbmVyLnN0eWxlO1xuXG4gICAgICAgICAgICBPYmplY3QuYXNzaWduKHN0eWxlLCB7XG4gICAgICAgICAgICAgICAgbGVmdDogYCR7ZXZlbnROb2RlLnJlY3QucmlnaHQgLSB3ZWVrTm9kZS5yZWN0LmxlZnQgKyAxNX1weGAsXG4gICAgICAgICAgICAgICAgdG9wIDogYCR7ZXZlbnROb2RlLnJlY3QudG9wIC0gc2Nyb2xsQ29udGFpbmVyTm9kZS5yZWN0LnRvcCArIHNjcm9sbENvbnRhaW5lck5vZGUuc2Nyb2xsVG9wIC0gMTJ9cHhgLFxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGVkaXRFdmVudENvbnRhaW5lci5zZXRTaWxlbnQoe1xuICAgICAgICAgICAgICAgIHBhcmVudElkOiBwYXRoWzFdLmlkLFxuICAgICAgICAgICAgICAgIHJlY29yZCxcbiAgICAgICAgICAgICAgICBzdHlsZVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGVkaXRFdmVudENvbnRhaW5lci5yZW5kZXIodHJ1ZSlcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0W119IGRhdGFcbiAgICAgKi9cbiAgICBvbkV2ZW50U3RvcmVMb2FkKGRhdGEpIHtcbiAgICAgICAgdGhpcy5jYWxlbmRhclN0b3JlLmdldENvdW50KCkgPiAwICYmIHRoaXMuY3JlYXRlQ29udGVudCgpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtPYmplY3RbXX0gZGF0YVxuICAgICAqL1xuICAgIG9uRXZlbnRTdG9yZVJlY29yZENoYW5nZShkYXRhKSB7XG4gICAgICAgIHRoaXMuY3JlYXRlQ29udGVudCgpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGRhdGFcbiAgICAgKiBAcGFyYW0ge09iamVjdFtdfSBkYXRhLm9sZFBhdGhcbiAgICAgKiBAcGFyYW0ge09iamVjdFtdfSBkYXRhLnBhdGhcbiAgICAgKi9cbiAgICBvbkZvY3VzQ2hhbmdlKGRhdGEpIHtcbiAgICAgICAgbGV0IHthcHBOYW1lfSAgICAgICA9IHRoaXMsXG4gICAgICAgICAgICB7b2xkUGF0aCwgcGF0aH0gPSBkYXRhO1xuXG4gICAgICAgIGlmIChvbGRQYXRoPy5bMF0/LmNscy5pbmNsdWRlcygnbmVvLWV2ZW50JykpIHtcbiAgICAgICAgICAgIE5lby5hcHBseURlbHRhcyhhcHBOYW1lLCB7aWQ6IG9sZFBhdGhbMF0uaWQsIGNsczoge3JlbW92ZTogWyduZW8tZm9jdXMnXX19KVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHBhdGg/LlswXT8uY2xzLmluY2x1ZGVzKCduZW8tZXZlbnQnKSkge1xuICAgICAgICAgICAgTmVvLmFwcGx5RGVsdGFzKGFwcE5hbWUsIHtpZDogcGF0aFswXS5pZCwgY2xzOiB7YWRkOiBbJ25lby1mb2N1cyddfX0pXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gZGF0YVxuICAgICAqL1xuICAgIG9uV2hlZWwoZGF0YSkge1xuICAgICAgICBpZiAoTWF0aC5hYnMoZGF0YS5kZWx0YVkpID4gTWF0aC5hYnMoZGF0YS5kZWx0YVgpKSB7XG4gICAgICAgICAgICBsZXQgbWUgICAgICAgID0gdGhpcyxcbiAgICAgICAgICAgICAgICBjb250YWluZXIgPSBtZS52ZG9tLmNuWzFdLFxuICAgICAgICAgICAgICAgIGkgICAgICAgICA9IDAsXG4gICAgICAgICAgICAgICAgZGF0ZSwgbGVuLCB3ZWVrO1xuXG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhkYXRhLnNjcm9sbFRvcCwgTWF0aC5yb3VuZChkYXRhLnNjcm9sbFRvcCAvIChkYXRhLmNsaWVudEhlaWdodCAtIG1lLmhlYWRlckhlaWdodCkgKiA2KSk7XG5cbiAgICAgICAgICAgIGlmIChkYXRhLmRlbHRhWSA+IDAgJiYgTWF0aC5yb3VuZChkYXRhLnNjcm9sbFRvcCAvIChkYXRhLmNsaWVudEhlaWdodCAtIG1lLmhlYWRlckhlaWdodCkgKiA2KSA+IDExKSB7XG4gICAgICAgICAgICAgICAgZGF0ZSA9IG5ldyBEYXRlKGNvbnRhaW5lci5jbltjb250YWluZXIuY24ubGVuZ3RoIC0gMV0uZmxhZyk7XG5cbiAgICAgICAgICAgICAgICBkYXRlLnNldERhdGUoZGF0ZS5nZXREYXRlKCkgLSAoZGF0ZS5nZXREYXkoKSAtIG1lLndlZWtTdGFydERheSkpO1xuXG4gICAgICAgICAgICAgICAgZm9yICg7IGkgPCA2OyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnRhaW5lci5jblsxXS5jbHMuaW5jbHVkZXMoJ25lby1tb250aC1oZWFkZXInKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyLmNuLnNwbGljZSgxLCAxKVxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyLmNuLnNoaWZ0KCk7XG5cbiAgICAgICAgICAgICAgICAgICAgZGF0ZS5zZXREYXRlKGRhdGUuZ2V0RGF0ZSgpICsgNyk7XG5cbiAgICAgICAgICAgICAgICAgICAgd2VlayA9IG1lLmNyZWF0ZVdlZWsoRGF0ZVV0aWwuY2xvbmUoZGF0ZSkpO1xuXG4gICAgICAgICAgICAgICAgICAgIHdlZWsuaGVhZGVyICYmIGNvbnRhaW5lci5jbi5wdXNoKHdlZWsuaGVhZGVyKTtcblxuICAgICAgICAgICAgICAgICAgICBjb250YWluZXIuY24ucHVzaCh3ZWVrLnJvdylcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBtZS51cGRhdGUoKVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBlbHNlIGlmIChkYXRhLmRlbHRhWSA8IDAgJiYgTWF0aC5yb3VuZChkYXRhLnNjcm9sbFRvcCAvIChkYXRhLmNsaWVudEhlaWdodCAtIG1lLmhlYWRlckhlaWdodCkgKiA2KSA8IDEpIHtcbiAgICAgICAgICAgICAgICBpZiAoY29udGFpbmVyLmNuWzBdLmZsYWcpIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0ZSA9IG5ldyBEYXRlKGNvbnRhaW5lci5jblswXS5mbGFnKVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGUgPSBuZXcgRGF0ZShjb250YWluZXIuY25bMV0uZmxhZylcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBkYXRlLnNldERhdGUoZGF0ZS5nZXREYXRlKCkgLSAoZGF0ZS5nZXREYXkoKSAtIG1lLndlZWtTdGFydERheSkpO1xuXG4gICAgICAgICAgICAgICAgZm9yICg7IGkgPCA2OyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgbGVuID0gY29udGFpbmVyLmNuLmxlbmd0aDtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoY29udGFpbmVyLmNuW2xlbiAtIDJdLmNscy5pbmNsdWRlcygnbmVvLW1vbnRoLWhlYWRlcicpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250YWluZXIuY24uc3BsaWNlKGxlbiAtIDIsIDEpXG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBjb250YWluZXIuY24ucG9wKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgZGF0ZS5zZXREYXRlKGRhdGUuZ2V0RGF0ZSgpIC0gNyk7XG5cbiAgICAgICAgICAgICAgICAgICAgd2VlayA9IG1lLmNyZWF0ZVdlZWsoRGF0ZVV0aWwuY2xvbmUoZGF0ZSkpO1xuXG4gICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lci5jbi51bnNoaWZ0KHdlZWsucm93KTtcblxuICAgICAgICAgICAgICAgICAgICB3ZWVrLmhlYWRlciAmJiBjb250YWluZXIuY24udW5zaGlmdCh3ZWVrLmhlYWRlcilcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBtZS5wcm9taXNlVXBkYXRlKG1lLnZkb20pLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBOZW8ubWFpbi5Eb21BY2Nlc3Muc2Nyb2xsVG8oe1xuICAgICAgICAgICAgICAgICAgICAgICAgZGlyZWN0aW9uOiAndG9wJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkICAgICAgIDogbWUudmRvbS5jblsxXS5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlICAgIDogZGF0YS5jbGllbnRIZWlnaHQgLSBtZS5oZWFkZXJIZWlnaHRcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIW1lLmlzU2Nyb2xsaW5nKSB7XG4gICAgICAgICAgICAgICAgbWUuaXNTY3JvbGxpbmcgPSB0cnVlO1xuICAgICAgICAgICAgICAgIE5lb0FycmF5LmFkZChtZS52ZG9tLmNuWzFdLmNscywgJ25lby1pcy1zY3JvbGxpbmcnKTtcbiAgICAgICAgICAgICAgICBtZS52ZG9tLmNuWzBdLmNuWzBdLnN0eWxlLm9wYWNpdHkgPSAwO1xuICAgICAgICAgICAgICAgIG1lLnVwZGF0ZSgpXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIG1lLnNjcm9sbFRhc2tJZCAmJiBjbGVhclRpbWVvdXQobWUuc2Nyb2xsVGFza0lkKTtcblxuICAgICAgICAgICAgbWUuc2Nyb2xsVGFza0lkID0gc2V0VGltZW91dChtZS5vbldoZWVsRW5kLmJpbmQobWUpLCAzMDApXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqL1xuICAgIG9uV2hlZWxFbmQoKSB7XG4gICAgICAgIGxldCBtZSAgICAgPSB0aGlzLFxuICAgICAgICAgICAge3Zkb219ID0gbWUsXG4gICAgICAgICAgICBoZWFkZXIgPSB2ZG9tLmNuWzBdLmNuWzBdLFxuICAgICAgICAgICAgaSAgICAgID0gNixcbiAgICAgICAgICAgIGRhdGUsIGZsYWc7XG5cbiAgICAgICAgbWUuaXNTY3JvbGxpbmcgPSBmYWxzZTtcblxuICAgICAgICBmb3IgKDsgaSA8IDEyOyBpKyspIHtcbiAgICAgICAgICAgIGZsYWcgPSB2ZG9tLmNuWzFdLmNuW2ldLmZsYWc7IC8vIHRvZG86ICM5ODkgPT4gZ2V0IHRoZSBkYXRlIG9mIHRoZSBmaXJzdCBmdWxseSB2aXNpYmxlIHJvdyBmb3IgdGhlIGhlYWRlclxuXG4gICAgICAgICAgICBpZiAoZmxhZykge1xuICAgICAgICAgICAgICAgIGRhdGUgPSBuZXcgRGF0ZShmbGFnKTtcbiAgICAgICAgICAgICAgICBkYXRlLnNldE1vbnRoKGRhdGUuZ2V0TW9udGgoKSArIDEpO1xuICAgICAgICAgICAgICAgIGhlYWRlci5jblswXS5odG1sID0gbWUuaW50bEZvcm1hdF9tb250aC5mb3JtYXQoZGF0ZSk7XG4gICAgICAgICAgICAgICAgaGVhZGVyLmNuWzFdLmh0bWwgPSBgICR7ZGF0ZS5nZXRGdWxsWWVhcigpfWA7XG4gICAgICAgICAgICAgICAgYnJlYWtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIE5lb0FycmF5LnJlbW92ZSh2ZG9tLmNuWzFdLmNscywgJ25lby1pcy1zY3JvbGxpbmcnKTtcbiAgICAgICAgaGVhZGVyLnN0eWxlLm9wYWNpdHkgPSAxO1xuICAgICAgICBtZS51cGRhdGUoKVxuXG4gICAgICAgIC8vIHRvZG86ICM5OTAgPT4gc2Nyb2xsIHRoZSB2aWV3IHRvIHRoZSBjbG9zZXN0IHJvd1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW2NyZWF0ZT1mYWxzZV1cbiAgICAgKi9cbiAgICB1cGRhdGVIZWFkZXIoY3JlYXRlPWZhbHNlKSB7XG4gICAgICAgIGxldCBtZSAgICAgPSB0aGlzLFxuICAgICAgICAgICAgZGF0ZSAgID0gbWUuY3VycmVudERhdGUsIC8vIGNsb25lZFxuICAgICAgICAgICAge3Zkb219ID0gbWUsXG4gICAgICAgICAgICBoZWFkZXIgPSB2ZG9tLmNuWzBdLmNuWzBdLFxuICAgICAgICAgICAgaSAgICAgID0gMSxcbiAgICAgICAgICAgIGRheSwgbm9kZTtcblxuICAgICAgICBoZWFkZXIuY25bMF0uaHRtbCA9IG1lLmludGxGb3JtYXRfbW9udGguZm9ybWF0KGRhdGUpO1xuICAgICAgICBoZWFkZXIuY25bMV0uaHRtbCA9IGAgJHtkYXRlLmdldEZ1bGxZZWFyKCl9YDtcblxuICAgICAgICBkYXRlLnNldERhdGUobWUuY3VycmVudERhdGUuZ2V0RGF0ZSgpIC0gbWUuY3VycmVudERhdGUuZ2V0RGF5KCkgKyBtZS53ZWVrU3RhcnREYXkpO1xuXG4gICAgICAgIGZvciAoOyBpIDwgODsgaSsrKSB7XG4gICAgICAgICAgICBkYXkgPSBkYXRlLmdldERheSgpO1xuXG4gICAgICAgICAgICBpZiAoY3JlYXRlKSB7XG4gICAgICAgICAgICAgICAgbm9kZSA9IHtcbiAgICAgICAgICAgICAgICAgICAgY2xzIDogWyduZW8tZGF5LW5hbWUnXSxcbiAgICAgICAgICAgICAgICAgICAgaHRtbDogbWUuaW50bEZvcm1hdF9kYXkuZm9ybWF0KGRhdGUpXG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIGlmICghbWUuc2hvd1dlZWtlbmRzICYmIChkYXkgPT09IDAgfHwgZGF5ID09PSA2KSkge1xuICAgICAgICAgICAgICAgICAgICBub2RlLnJlbW92ZURvbSA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmRvbS5jblswXS5jbi5wdXNoKG5vZGUpXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIG5vZGUgPSB2ZG9tLmNuWzBdLmNuW2ldO1xuXG4gICAgICAgICAgICAgICAgLy8gdGhlIG1ldGhvZCBjb3VsZCBiZSBjYWxsZWQgYmVmb3JlIHRoZSBoZWFkZXIgY29udGVudCBnb3QgY3JlYXRlZFxuICAgICAgICAgICAgICAgIGlmIChub2RlKSB7XG4gICAgICAgICAgICAgICAgICAgIG5vZGUuaHRtbCA9IG1lLmludGxGb3JtYXRfZGF5LmZvcm1hdChkYXRlKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoIW1lLnNob3dXZWVrZW5kcyAmJiAoZGF5ID09PSAwIHx8IGRheSA9PT0gNikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUucmVtb3ZlRG9tID0gdHJ1ZVxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIG5vZGUucmVtb3ZlRG9tXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGRhdGUuc2V0RGF0ZShkYXRlLmdldERhdGUoKSArIDEpXG4gICAgICAgIH1cblxuICAgICAgICBtZS51cGRhdGUoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtzaWxlbnQ9ZmFsc2VdXG4gICAgICovXG4gICAgdXBkYXRlTW9udGhOYW1lcyhzaWxlbnQ9ZmFsc2UpIHtcbiAgICAgICAgbGV0IG1lICAgICA9IHRoaXMsXG4gICAgICAgICAgICBkYXRlICAgPSBtZS5jdXJyZW50RGF0ZSwgLy8gY2xvbmVkXG4gICAgICAgICAgICBtb250aHMgPSBWRG9tVXRpbC5nZXRGbGFncyhtZS52ZG9tLCAnbW9udGgtbmFtZScpO1xuXG4gICAgICAgIG1vbnRocy5mb3JFYWNoKG1vbnRoID0+IHtcbiAgICAgICAgICAgIG1vbnRoLmh0bWwgPSBtZS5pbnRsRm9ybWF0X21vbnRoLmZvcm1hdChkYXRlKTtcbiAgICAgICAgICAgIGRhdGUuc2V0TW9udGgoZGF0ZS5nZXRNb250aCgpICsgMSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIG1lLnVwZGF0ZSgpXG4gICAgfVxufVxuXG5OZW8uc2V0dXBDbGFzcyhDb21wb25lbnQpO1xuXG5leHBvcnQgZGVmYXVsdCBDb21wb25lbnQ7XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=