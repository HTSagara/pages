"use strict";
(self["webpackChunkneo_mjs"] = self["webpackChunkneo_mjs"] || []).push([["vendors-src_menu_List_mjs"],{

/***/ "./src/menu/List.mjs":
/*!***************************!*\
  !*** ./src/menu/List.mjs ***!
  \***************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _list_Base_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../list/Base.mjs */ "./src/list/Base.mjs");
/* harmony import */ var _selection_menu_ListModel_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../selection/menu/ListModel.mjs */ "./src/selection/menu/ListModel.mjs");
/* harmony import */ var _util_Array_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../util/Array.mjs */ "./src/util/Array.mjs");
/* harmony import */ var _Store_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./Store.mjs */ "./src/menu/Store.mjs");





/**
 * @class Neo.menu.List
 * @extends Neo.list.Base
 */
class List extends _list_Base_mjs__WEBPACK_IMPORTED_MODULE_0__["default"] {
    static config = {
        /**
         * @member {String} className='Neo.menu.List'
         * @protected
         */
        className: 'Neo.menu.List',
        /**
         * @member {String} ntype='menu-list'
         * @protected
         */
        ntype: 'menu-list',
        /**
         * Read only. We are storing the currently visible subMenu instance.
         * @member {Neo.menu.List|Neo.menu.Panel|null} activeSubMenu=null
         */
        activeSubMenu: null,
        /**
         * @member {String[]} baseCls=['neo-menu-list','neo-list']
         */
        baseCls: ['neo-menu-list', 'neo-list'],
        /**
         * True will add 'neo-floating' to the instance cls list.
         * @member {Boolean} floating_=false
         */
        floating_: false,
        /**
         * setTimeout() id after a focus-leave event.
         * @member {Number|null} focusTimeoutId=null
         * @protected
         */
        focusTimeoutId: null,
        /**
         * Hides a floating list on leaf item click, in case it has a parentComponent
         * @member {Boolean} hideOnLeafItemClick=true
         */
        hideOnLeafItemClick: true,
        /**
         * Optionally pass menu.Store data directly
         * @member {Object[]|null} items_=null
         */
        items_: null,
        /**
         * Internal flag.
         * Sub-menus will bubble of focus changes to the top level.
         * @member {Boolean} menuFocus_=false
         * @protected
         */
        menuFocus_: false,
        /**
         * Internal flag.
         * True for a top level menu, false for sub-menus.
         * @member {Boolean} isRoot=true
         * @protected
         */
        isRoot: true,
        /**
         * Storing the list item index of the parent menu in case it exists.
         * @member {Number} parentIndex=0
         * @protected
         */
        parentIndex: 0,
        /**
         * Storing a reference to the parent menu in case it exists.
         * @member {Neo.menu.List|Neo.menu.Panel|null} parentMenu=null
         * @protected
         */
        parentMenu: null,
        /**
         * Value for the list.Base selectionModel_ config
         * @member {Neo.selection.menu.ListModel} selectionModel=ListModel
         */
        selectionModel: _selection_menu_ListModel_mjs__WEBPACK_IMPORTED_MODULE_1__["default"],
        /**
         * Value for the list.Base store_ config
         * @member {Neo.menu.Store} store=Store
         */
        store: _Store_mjs__WEBPACK_IMPORTED_MODULE_3__["default"],
        /**
         * The distance in px between a menu and a child menu
         * See: https://github.com/neomjs/neo/issues/2569
         * @member {Number} subMenuGap=0
         */
        subMenuGap: 0,
        /**
         * Storing childMenus by record keyProperty
         * @member {Object} subMenuMap=null
         * @protected
         */
        subMenuMap: null,
        /**
         * We are applying a z-index style which is 1 number higher to each sub-menu
         * @member {Number} zIndex_=100
         */
        zIndex_: 100,
        /**
         * @member {Object} _vdom
         */
        _vdom:
        {tag: 'ul', tabIndex: -1, cn: []}
    }

    /**
     * If the menu is floating, it will anchor itself to the parentRect
     * @member {Neo.component.Base|null} parentComponent=null
     */
    parentComponent = null

    /**
     * Triggered after the floating config got changed
     * @param {Object[]} value
     * @param {Object[]} oldValue
     * @protected
     */
    afterSetFloating(value, oldValue) {
        let cls = this.cls;

        _util_Array_mjs__WEBPACK_IMPORTED_MODULE_2__["default"][value ? 'add' : 'remove'](cls, 'neo-floating');
        this.cls = cls
    }

    /**
     * Triggered after the items config got changed
     * @param {Object[]} value
     * @param {Object[]} oldValue
     * @protected
     */
    afterSetItems(value, oldValue) {
        let store = this.store;

        oldValue && store.remove(oldValue);
        value    && store.add(value)
    }

    /**
     * Triggered after the menuFocus config got changed
     * @param {Boolean} value
     * @param {Boolean} oldValue
     * @protected
     */
    afterSetMenuFocus(value, oldValue) {
        if (oldValue !== undefined) {
            let me = this;

            if (me.isRoot) {
                if (!value) {
                    me.focusTimeoutId = setTimeout(() => {
                        me[me.floating ? 'unmount' : 'hideSubMenu']();
                    }, 20);
                } else {
                    clearTimeout(me.focusTimeoutId);
                    me.focusTimeoutId = null;
                }
            } else {
                // bubble the focus change upwards
                me.parentMenu.menuFocus = value;
            }
        }
    }

    /**
     * Triggered after the mounted config got changed
     * @param {Boolean} value
     * @param {Boolean} oldValue
     * @protected
     */
    afterSetMounted(value, oldValue) {
        super.afterSetMounted(value, oldValue);

        let me           = this,
            id           = me.id,
            parentId     = me.parentComponent?.id;

        if (parentId) {
            if (value) {
                Neo.main.addon.ScrollSync.register({
                    sourceId: parentId,
                    targetId: id
                });

                !me.parentMenu && me.getDomRect([id, parentId]).then(rects => {
                    let style = me.style || {};

                    style.left = `${rects[1].right - rects[0].width}px`;
                    style.top  = `${rects[1].bottom + 1}px`;

                    me.style = style
                })
            } else if (oldValue !== undefined) {
                Neo.main.addon.ScrollSync.unregister({
                    sourceId: parentId,
                    targetId: id
                })
            }
        }
    }

    /**
     * Triggered after the zIndex config got changed
     * @param {Number} value
     * @param {Number} oldValue
     * @protected
     */
    afterSetZIndex(value, oldValue) {
        this.style = {...this.style, zIndex: value}
    }

    /**
     * Override this method for custom renderers
     * @param {Object} record
     * @param {Number} index
     * @returns {Object|Object[]|String} Either a config object to assign to the item, a vdom cn array or a html string
     */
    createItemContent(record, index) {
        let me      = this,
            iconCls = record.iconCls,
            id      = record[me.store.keyProperty],
            vdomCn  = [{tag: 'span', cls: ['neo-content'], html: record[me.displayField]}];

        if (iconCls && iconCls !== '') {
            vdomCn.unshift({tag: 'i', cls: ['neo-menu-icon', 'neo-icon', iconCls], id: me.getIconId(id)});
        }

        if (me.hasChildren(record)) {
            vdomCn.push({tag: 'i', cls: ['neo-arrow-icon', 'neo-icon', 'fas fa-chevron-right'], id: me.getArrowIconId(id)});
        }

        return vdomCn
    }

    /**
     *
     */
    destroy(...args) {
        let me            = this,
            activeSubMenu = me.activeSubMenu,
            subMenuMap    = me.subMenuMap;

        me.store.destroy();

        activeSubMenu?.unmount();

        Object.entries(subMenuMap).forEach(([key, value]) => {
            value.destroy();
            subMenuMap[key] = null
        });

        super.destroy(...args)
    }

    /**
     * @param {Number|String} recordId
     * @returns {String}
     */
    getArrowIconId(recordId) {
        return `${this.id}__arrow_icon__${recordId}`
    }

    /**
     * @param {Number|String} recordId
     * @returns {String}
     */
    getIconId(recordId) {
        return `${this.id}__icon__${recordId}`
    }

    /**
     * recordIds can be Numbers, so we do need a prefix
     * @param {Number|String} recordId
     * @returns {String}
     */
    getMenuMapId(recordId) {
        return `menu__${recordId}`
    }

    /**
     * Checks if a record has items
     * @param {Object} record
     * @returns {Boolean}
     */
    hasChildren(record) {
        return Array.isArray(record.items) && record.items.length > 0
    }

    /**
     *
     */
    hideSubMenu() {
        let me            = this,
            activeSubMenu = me.activeSubMenu;

        if (activeSubMenu) {
            activeSubMenu.unmount();
            me.activeSubMenu = null
        }
    }

    /**
     * @param {Object} data
     * @param {Object[]} data.path
     */
    onFocusEnter(data) {
        this.menuFocus = true
    }

    /**
     * @param {Object} data
     * @param {Object[]} data.oldPath
     */
    onFocusLeave(data) {
        let insideParent = false,
            parentId     = this.parentComponent?.id,
            item;

        if (parentId) {
            for (item of data.oldPath) {
                if (item.id === parentId) {
                    insideParent = true;
                    break;
                }
            }
        }

        if (!insideParent) {
            this.menuFocus = false
        }
    }

    /**
     * @param {Object} node
     * @param {Object} data
     */
    onItemClick(node, data) {
        super.onItemClick(node, data);

        let me     = this,
            record = data.record;

        record.handler?.call(me, record);

        if (me.hideOnLeafItemClick && !record.items) {
            me.unmount()
        }
    }

    /**
     * @param {String} nodeId
     */
    onKeyDownEnter(nodeId) {
        if (nodeId) {
            let me       = this,
                recordId = me.getItemRecordId(nodeId),
                record   = me.store.get(recordId),
                submenu;

            record.handler?.call(me, record);

            if (me.hideOnLeafItemClick && !record.items) {
                me.unmount()
            }

            if (record.items) {
                submenu = me.subMenuMap[me.getMenuMapId(recordId)];

                if (submenu) {
                    me.toggleSubMenu(nodeId, record)
                }
            }
        }
    }

    /**
     * @param {Object} data
     */
    onKeyDownEscape(data) {
        this.floating && this.unmount()
    }

    /**
     * @param {String[]} items
     */
    onSelect(items) {
        let me       = this,
            nodeId   = items[0],
            recordId = me.getItemRecordId(nodeId),
            record   = me.store.get(recordId);

        if (me.activeSubMenu !== me.subMenuMap?.[me.getMenuMapId(recordId)]) {
            me.hideSubMenu();
            me.hasChildren(record) && me.showSubMenu(nodeId, record)
        }
    }

    /**
     * @param {String} nodeId
     * @param {Object} record
     */
    showSubMenu(nodeId, record) {
        let me           = this,
            store        = me.store,
            recordId     = record[store.keyProperty],
            subMenuMap   = me.subMenuMap || {},
            subMenuMapId = me.getMenuMapId(recordId),
            subMenu      = subMenuMap[subMenuMapId],
            menuStyle, style;

        me.getDomRect(nodeId).then(rect => {
            style = {
                left: `${rect.right + me.subMenuGap}px`,
                top : `${rect.top - 1}px` // minus the border
            };

            if (subMenu) {
                menuStyle = subMenu.style;

                Object.assign(menuStyle, style);

                subMenu.setSilent({style: menuStyle})
            } else {
                subMenuMap[subMenuMapId] = subMenu = Neo.create({
                    module         : List,
                    appName        : me.appName,
                    displayField   : me.displayField,
                    floating       : true,
                    items          : record.items,
                    isRoot         : false,
                    parentComponent: me.parentComponent,
                    parentId       : Neo.apps[me.appName].mainView.id,
                    parentIndex    : store.indexOf(record),
                    parentMenu     : me,
                    style,
                    zIndex         : me.zIndex + 1
                })
            }

            me.activeSubMenu = subMenu;
            me.subMenuMap    = subMenuMap;

            subMenu.render(true)
        });
    }

    /**
     * @param {String} nodeId
     * @param {Object} record
     */
    toggleSubMenu(nodeId, record) {
        let me       = this,
            recordId = record[me.getKeyProperty()],
            submenu  = me.subMenuMap[me.getMenuMapId(recordId)];

        if (!submenu?.mounted) {
            me.showSubMenu(nodeId, record)
        } else {
            me.hideSubMenu()
        }
    }

    /**
     *
     */
    unmount() {
        this.selectionModel.deselectAll(true); // silent update
        this.hideSubMenu();

        super.unmount()
    }
}

Neo.applyClassConfig(List);

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (List);


/***/ }),

/***/ "./src/menu/Model.mjs":
/*!****************************!*\
  !*** ./src/menu/Model.mjs ***!
  \****************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _src_data_Model_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../src/data/Model.mjs */ "./src/data/Model.mjs");


/**
 * @class Neo.menu.Model
 * @extends Neo.data.Model
 */
class Model extends _src_data_Model_mjs__WEBPACK_IMPORTED_MODULE_0__["default"] {
    static config = {
        /**
         * @member {String} className='Neo.menu.Model'
         * @protected
         */
        className: 'Neo.menu.Model',
        /**
         * @member {String} keyProperty='id'
         */
        keyProperty: 'id',
        /**
         * @member {Object[]} fields
         */
        fields: [{
            name: 'handler',
            type: 'Function'
        }, {
            name: 'iconCls',
            type: 'String'
        }, {
            name: 'id',
            type: 'Integer'
        }, {
            name: 'items', // optional
            type: 'Array'
        }, {
            name: 'text',
            type: 'String'
        }]
    }
}

Neo.applyClassConfig(Model);

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Model);


/***/ }),

/***/ "./src/menu/Store.mjs":
/*!****************************!*\
  !*** ./src/menu/Store.mjs ***!
  \****************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _Model_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./Model.mjs */ "./src/menu/Model.mjs");
/* harmony import */ var _src_data_Store_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../src/data/Store.mjs */ "./src/data/Store.mjs");



/**
 * @class Neo.menu.Store
 * @extends Neo.data.Store
 */
class Store extends _src_data_Store_mjs__WEBPACK_IMPORTED_MODULE_1__["default"] {
    static config = {
        /**
         * @member {String} className='Neo.menu.Store'
         * @protected
         */
        className: 'Neo.menu.Store',
        /**
         * @member {Neo.menu.Model} model=Model
         */
        model: _Model_mjs__WEBPACK_IMPORTED_MODULE_0__["default"]
    }
}

Neo.applyClassConfig(Store);

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Store);


/***/ }),

/***/ "./src/selection/menu/ListModel.mjs":
/*!******************************************!*\
  !*** ./src/selection/menu/ListModel.mjs ***!
  \******************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _ListModel_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../ListModel.mjs */ "./src/selection/ListModel.mjs");


/**
 * @class Neo.selection.menu.ListModel
 * @extends Neo.selection.ListModel
 */
class ListModel extends _ListModel_mjs__WEBPACK_IMPORTED_MODULE_0__["default"] {
    static config = {
        /**
         * @member {String} className='Neo.selection.menu.ListModel'
         * @protected
         */
        className: 'Neo.selection.menu.ListModel',
        /**
         * @member {String} ntype='selection-menu-listmodel'
         * @protected
         */
        ntype: 'selection-menu-listmodel'
    }

    /**
     * @param {Object} data
     */
    onKeyDownEscape(data) {
        this.view.onKeyDownEscape(data)
    }

    /**
     * @param {Object} data
     */
    onKeyDownLeft(data) {
        let view       = this.view,
            parentMenu = view.parentMenu;

        if (parentMenu) {
            view.hideSubMenu();
            view.selectionModel.deselectAll();
            parentMenu.selectionModel.selectAt(view.parentIndex)
        }
    }

    /**
     * @param {Object} data
     */
    onKeyDownRight(data) {
        let activeSubMenu = this.view.activeSubMenu;

        if (activeSubMenu) {
            activeSubMenu.selectionModel.selectAt(0)
        }
    }
}

Neo.applyClassConfig(ListModel);

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ListModel);


/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q0Esb0JBQW9CLDJEQUFTO0FBQzdCO0FBQ0E7QUFDQSxvQkFBb0IsUUFBUTtBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixnQkFBZ0I7QUFDcEM7QUFDQSxlQUFlLGtEQUFLO0FBQ3BCO0FBQ0E7O0FBRUE7O0FBRUEsaUVBQWUsS0FBSyxFQUFDOzs7Ozs7Ozs7Ozs7Ozs7O0FDdkJ3Qjs7QUFFN0M7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0Isc0RBQWE7QUFDckM7QUFDQTtBQUNBLG9CQUFvQixRQUFRO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLFFBQVE7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxlQUFlLFFBQVE7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxlQUFlLFFBQVE7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsZUFBZSxRQUFRO0FBQ3ZCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBLGlFQUFlLFNBQVMsRUFBQyIsInNvdXJjZXMiOlsid2VicGFjazovL25lby5tanMvLi9zcmMvbWVudS9MaXN0Lm1qcyIsIndlYnBhY2s6Ly9uZW8ubWpzLy4vc3JjL21lbnUvTW9kZWwubWpzIiwid2VicGFjazovL25lby5tanMvLi9zcmMvbWVudS9TdG9yZS5tanMiLCJ3ZWJwYWNrOi8vbmVvLm1qcy8uL3NyYy9zZWxlY3Rpb24vbWVudS9MaXN0TW9kZWwubWpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBCYXNlTGlzdCAgZnJvbSAnLi4vbGlzdC9CYXNlLm1qcyc7XG5pbXBvcnQgTGlzdE1vZGVsIGZyb20gJy4uL3NlbGVjdGlvbi9tZW51L0xpc3RNb2RlbC5tanMnO1xuaW1wb3J0IE5lb0FycmF5ICBmcm9tICcuLi91dGlsL0FycmF5Lm1qcyc7XG5pbXBvcnQgU3RvcmUgICAgIGZyb20gJy4vU3RvcmUubWpzJztcblxuLyoqXG4gKiBAY2xhc3MgTmVvLm1lbnUuTGlzdFxuICogQGV4dGVuZHMgTmVvLmxpc3QuQmFzZVxuICovXG5jbGFzcyBMaXN0IGV4dGVuZHMgQmFzZUxpc3Qge1xuICAgIHN0YXRpYyBjb25maWcgPSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtTdHJpbmd9IGNsYXNzTmFtZT0nTmVvLm1lbnUuTGlzdCdcbiAgICAgICAgICogQHByb3RlY3RlZFxuICAgICAgICAgKi9cbiAgICAgICAgY2xhc3NOYW1lOiAnTmVvLm1lbnUuTGlzdCcsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtTdHJpbmd9IG50eXBlPSdtZW51LWxpc3QnXG4gICAgICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgICAgICovXG4gICAgICAgIG50eXBlOiAnbWVudS1saXN0JyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJlYWQgb25seS4gV2UgYXJlIHN0b3JpbmcgdGhlIGN1cnJlbnRseSB2aXNpYmxlIHN1Yk1lbnUgaW5zdGFuY2UuXG4gICAgICAgICAqIEBtZW1iZXIge05lby5tZW51Lkxpc3R8TmVvLm1lbnUuUGFuZWx8bnVsbH0gYWN0aXZlU3ViTWVudT1udWxsXG4gICAgICAgICAqL1xuICAgICAgICBhY3RpdmVTdWJNZW51OiBudWxsLFxuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7U3RyaW5nW119IGJhc2VDbHM9WyduZW8tbWVudS1saXN0JywnbmVvLWxpc3QnXVxuICAgICAgICAgKi9cbiAgICAgICAgYmFzZUNsczogWyduZW8tbWVudS1saXN0JywgJ25lby1saXN0J10sXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUcnVlIHdpbGwgYWRkICduZW8tZmxvYXRpbmcnIHRvIHRoZSBpbnN0YW5jZSBjbHMgbGlzdC5cbiAgICAgICAgICogQG1lbWJlciB7Qm9vbGVhbn0gZmxvYXRpbmdfPWZhbHNlXG4gICAgICAgICAqL1xuICAgICAgICBmbG9hdGluZ186IGZhbHNlLFxuICAgICAgICAvKipcbiAgICAgICAgICogc2V0VGltZW91dCgpIGlkIGFmdGVyIGEgZm9jdXMtbGVhdmUgZXZlbnQuXG4gICAgICAgICAqIEBtZW1iZXIge051bWJlcnxudWxsfSBmb2N1c1RpbWVvdXRJZD1udWxsXG4gICAgICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgICAgICovXG4gICAgICAgIGZvY3VzVGltZW91dElkOiBudWxsLFxuICAgICAgICAvKipcbiAgICAgICAgICogSGlkZXMgYSBmbG9hdGluZyBsaXN0IG9uIGxlYWYgaXRlbSBjbGljaywgaW4gY2FzZSBpdCBoYXMgYSBwYXJlbnRDb21wb25lbnRcbiAgICAgICAgICogQG1lbWJlciB7Qm9vbGVhbn0gaGlkZU9uTGVhZkl0ZW1DbGljaz10cnVlXG4gICAgICAgICAqL1xuICAgICAgICBoaWRlT25MZWFmSXRlbUNsaWNrOiB0cnVlLFxuICAgICAgICAvKipcbiAgICAgICAgICogT3B0aW9uYWxseSBwYXNzIG1lbnUuU3RvcmUgZGF0YSBkaXJlY3RseVxuICAgICAgICAgKiBAbWVtYmVyIHtPYmplY3RbXXxudWxsfSBpdGVtc189bnVsbFxuICAgICAgICAgKi9cbiAgICAgICAgaXRlbXNfOiBudWxsLFxuICAgICAgICAvKipcbiAgICAgICAgICogSW50ZXJuYWwgZmxhZy5cbiAgICAgICAgICogU3ViLW1lbnVzIHdpbGwgYnViYmxlIG9mIGZvY3VzIGNoYW5nZXMgdG8gdGhlIHRvcCBsZXZlbC5cbiAgICAgICAgICogQG1lbWJlciB7Qm9vbGVhbn0gbWVudUZvY3VzXz1mYWxzZVxuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICBtZW51Rm9jdXNfOiBmYWxzZSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEludGVybmFsIGZsYWcuXG4gICAgICAgICAqIFRydWUgZm9yIGEgdG9wIGxldmVsIG1lbnUsIGZhbHNlIGZvciBzdWItbWVudXMuXG4gICAgICAgICAqIEBtZW1iZXIge0Jvb2xlYW59IGlzUm9vdD10cnVlXG4gICAgICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgICAgICovXG4gICAgICAgIGlzUm9vdDogdHJ1ZSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFN0b3JpbmcgdGhlIGxpc3QgaXRlbSBpbmRleCBvZiB0aGUgcGFyZW50IG1lbnUgaW4gY2FzZSBpdCBleGlzdHMuXG4gICAgICAgICAqIEBtZW1iZXIge051bWJlcn0gcGFyZW50SW5kZXg9MFxuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICBwYXJlbnRJbmRleDogMCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFN0b3JpbmcgYSByZWZlcmVuY2UgdG8gdGhlIHBhcmVudCBtZW51IGluIGNhc2UgaXQgZXhpc3RzLlxuICAgICAgICAgKiBAbWVtYmVyIHtOZW8ubWVudS5MaXN0fE5lby5tZW51LlBhbmVsfG51bGx9IHBhcmVudE1lbnU9bnVsbFxuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICBwYXJlbnRNZW51OiBudWxsLFxuICAgICAgICAvKipcbiAgICAgICAgICogVmFsdWUgZm9yIHRoZSBsaXN0LkJhc2Ugc2VsZWN0aW9uTW9kZWxfIGNvbmZpZ1xuICAgICAgICAgKiBAbWVtYmVyIHtOZW8uc2VsZWN0aW9uLm1lbnUuTGlzdE1vZGVsfSBzZWxlY3Rpb25Nb2RlbD1MaXN0TW9kZWxcbiAgICAgICAgICovXG4gICAgICAgIHNlbGVjdGlvbk1vZGVsOiBMaXN0TW9kZWwsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBWYWx1ZSBmb3IgdGhlIGxpc3QuQmFzZSBzdG9yZV8gY29uZmlnXG4gICAgICAgICAqIEBtZW1iZXIge05lby5tZW51LlN0b3JlfSBzdG9yZT1TdG9yZVxuICAgICAgICAgKi9cbiAgICAgICAgc3RvcmU6IFN0b3JlLFxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGRpc3RhbmNlIGluIHB4IGJldHdlZW4gYSBtZW51IGFuZCBhIGNoaWxkIG1lbnVcbiAgICAgICAgICogU2VlOiBodHRwczovL2dpdGh1Yi5jb20vbmVvbWpzL25lby9pc3N1ZXMvMjU2OVxuICAgICAgICAgKiBAbWVtYmVyIHtOdW1iZXJ9IHN1Yk1lbnVHYXA9MFxuICAgICAgICAgKi9cbiAgICAgICAgc3ViTWVudUdhcDogMCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFN0b3JpbmcgY2hpbGRNZW51cyBieSByZWNvcmQga2V5UHJvcGVydHlcbiAgICAgICAgICogQG1lbWJlciB7T2JqZWN0fSBzdWJNZW51TWFwPW51bGxcbiAgICAgICAgICogQHByb3RlY3RlZFxuICAgICAgICAgKi9cbiAgICAgICAgc3ViTWVudU1hcDogbnVsbCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFdlIGFyZSBhcHBseWluZyBhIHotaW5kZXggc3R5bGUgd2hpY2ggaXMgMSBudW1iZXIgaGlnaGVyIHRvIGVhY2ggc3ViLW1lbnVcbiAgICAgICAgICogQG1lbWJlciB7TnVtYmVyfSB6SW5kZXhfPTEwMFxuICAgICAgICAgKi9cbiAgICAgICAgekluZGV4XzogMTAwLFxuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7T2JqZWN0fSBfdmRvbVxuICAgICAgICAgKi9cbiAgICAgICAgX3Zkb206XG4gICAgICAgIHt0YWc6ICd1bCcsIHRhYkluZGV4OiAtMSwgY246IFtdfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIElmIHRoZSBtZW51IGlzIGZsb2F0aW5nLCBpdCB3aWxsIGFuY2hvciBpdHNlbGYgdG8gdGhlIHBhcmVudFJlY3RcbiAgICAgKiBAbWVtYmVyIHtOZW8uY29tcG9uZW50LkJhc2V8bnVsbH0gcGFyZW50Q29tcG9uZW50PW51bGxcbiAgICAgKi9cbiAgICBwYXJlbnRDb21wb25lbnQgPSBudWxsXG5cbiAgICAvKipcbiAgICAgKiBUcmlnZ2VyZWQgYWZ0ZXIgdGhlIGZsb2F0aW5nIGNvbmZpZyBnb3QgY2hhbmdlZFxuICAgICAqIEBwYXJhbSB7T2JqZWN0W119IHZhbHVlXG4gICAgICogQHBhcmFtIHtPYmplY3RbXX0gb2xkVmFsdWVcbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICovXG4gICAgYWZ0ZXJTZXRGbG9hdGluZyh2YWx1ZSwgb2xkVmFsdWUpIHtcbiAgICAgICAgbGV0IGNscyA9IHRoaXMuY2xzO1xuXG4gICAgICAgIE5lb0FycmF5W3ZhbHVlID8gJ2FkZCcgOiAncmVtb3ZlJ10oY2xzLCAnbmVvLWZsb2F0aW5nJyk7XG4gICAgICAgIHRoaXMuY2xzID0gY2xzXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVHJpZ2dlcmVkIGFmdGVyIHRoZSBpdGVtcyBjb25maWcgZ290IGNoYW5nZWRcbiAgICAgKiBAcGFyYW0ge09iamVjdFtdfSB2YWx1ZVxuICAgICAqIEBwYXJhbSB7T2JqZWN0W119IG9sZFZhbHVlXG4gICAgICogQHByb3RlY3RlZFxuICAgICAqL1xuICAgIGFmdGVyU2V0SXRlbXModmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgIGxldCBzdG9yZSA9IHRoaXMuc3RvcmU7XG5cbiAgICAgICAgb2xkVmFsdWUgJiYgc3RvcmUucmVtb3ZlKG9sZFZhbHVlKTtcbiAgICAgICAgdmFsdWUgICAgJiYgc3RvcmUuYWRkKHZhbHVlKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRyaWdnZXJlZCBhZnRlciB0aGUgbWVudUZvY3VzIGNvbmZpZyBnb3QgY2hhbmdlZFxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gdmFsdWVcbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IG9sZFZhbHVlXG4gICAgICogQHByb3RlY3RlZFxuICAgICAqL1xuICAgIGFmdGVyU2V0TWVudUZvY3VzKHZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICBpZiAob2xkVmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgbGV0IG1lID0gdGhpcztcblxuICAgICAgICAgICAgaWYgKG1lLmlzUm9vdCkge1xuICAgICAgICAgICAgICAgIGlmICghdmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgbWUuZm9jdXNUaW1lb3V0SWQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lW21lLmZsb2F0aW5nID8gJ3VubW91bnQnIDogJ2hpZGVTdWJNZW51J10oKTtcbiAgICAgICAgICAgICAgICAgICAgfSwgMjApO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dChtZS5mb2N1c1RpbWVvdXRJZCk7XG4gICAgICAgICAgICAgICAgICAgIG1lLmZvY3VzVGltZW91dElkID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIGJ1YmJsZSB0aGUgZm9jdXMgY2hhbmdlIHVwd2FyZHNcbiAgICAgICAgICAgICAgICBtZS5wYXJlbnRNZW51Lm1lbnVGb2N1cyA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVHJpZ2dlcmVkIGFmdGVyIHRoZSBtb3VudGVkIGNvbmZpZyBnb3QgY2hhbmdlZFxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gdmFsdWVcbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IG9sZFZhbHVlXG4gICAgICogQHByb3RlY3RlZFxuICAgICAqL1xuICAgIGFmdGVyU2V0TW91bnRlZCh2YWx1ZSwgb2xkVmFsdWUpIHtcbiAgICAgICAgc3VwZXIuYWZ0ZXJTZXRNb3VudGVkKHZhbHVlLCBvbGRWYWx1ZSk7XG5cbiAgICAgICAgbGV0IG1lICAgICAgICAgICA9IHRoaXMsXG4gICAgICAgICAgICBpZCAgICAgICAgICAgPSBtZS5pZCxcbiAgICAgICAgICAgIHBhcmVudElkICAgICA9IG1lLnBhcmVudENvbXBvbmVudD8uaWQ7XG5cbiAgICAgICAgaWYgKHBhcmVudElkKSB7XG4gICAgICAgICAgICBpZiAodmFsdWUpIHtcbiAgICAgICAgICAgICAgICBOZW8ubWFpbi5hZGRvbi5TY3JvbGxTeW5jLnJlZ2lzdGVyKHtcbiAgICAgICAgICAgICAgICAgICAgc291cmNlSWQ6IHBhcmVudElkLFxuICAgICAgICAgICAgICAgICAgICB0YXJnZXRJZDogaWRcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICFtZS5wYXJlbnRNZW51ICYmIG1lLmdldERvbVJlY3QoW2lkLCBwYXJlbnRJZF0pLnRoZW4ocmVjdHMgPT4ge1xuICAgICAgICAgICAgICAgICAgICBsZXQgc3R5bGUgPSBtZS5zdHlsZSB8fCB7fTtcblxuICAgICAgICAgICAgICAgICAgICBzdHlsZS5sZWZ0ID0gYCR7cmVjdHNbMV0ucmlnaHQgLSByZWN0c1swXS53aWR0aH1weGA7XG4gICAgICAgICAgICAgICAgICAgIHN0eWxlLnRvcCAgPSBgJHtyZWN0c1sxXS5ib3R0b20gKyAxfXB4YDtcblxuICAgICAgICAgICAgICAgICAgICBtZS5zdHlsZSA9IHN0eWxlXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0gZWxzZSBpZiAob2xkVmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIE5lby5tYWluLmFkZG9uLlNjcm9sbFN5bmMudW5yZWdpc3Rlcih7XG4gICAgICAgICAgICAgICAgICAgIHNvdXJjZUlkOiBwYXJlbnRJZCxcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0SWQ6IGlkXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRyaWdnZXJlZCBhZnRlciB0aGUgekluZGV4IGNvbmZpZyBnb3QgY2hhbmdlZFxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSB2YWx1ZVxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBvbGRWYWx1ZVxuICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgKi9cbiAgICBhZnRlclNldFpJbmRleCh2YWx1ZSwgb2xkVmFsdWUpIHtcbiAgICAgICAgdGhpcy5zdHlsZSA9IHsuLi50aGlzLnN0eWxlLCB6SW5kZXg6IHZhbHVlfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIE92ZXJyaWRlIHRoaXMgbWV0aG9kIGZvciBjdXN0b20gcmVuZGVyZXJzXG4gICAgICogQHBhcmFtIHtPYmplY3R9IHJlY29yZFxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBpbmRleFxuICAgICAqIEByZXR1cm5zIHtPYmplY3R8T2JqZWN0W118U3RyaW5nfSBFaXRoZXIgYSBjb25maWcgb2JqZWN0IHRvIGFzc2lnbiB0byB0aGUgaXRlbSwgYSB2ZG9tIGNuIGFycmF5IG9yIGEgaHRtbCBzdHJpbmdcbiAgICAgKi9cbiAgICBjcmVhdGVJdGVtQ29udGVudChyZWNvcmQsIGluZGV4KSB7XG4gICAgICAgIGxldCBtZSAgICAgID0gdGhpcyxcbiAgICAgICAgICAgIGljb25DbHMgPSByZWNvcmQuaWNvbkNscyxcbiAgICAgICAgICAgIGlkICAgICAgPSByZWNvcmRbbWUuc3RvcmUua2V5UHJvcGVydHldLFxuICAgICAgICAgICAgdmRvbUNuICA9IFt7dGFnOiAnc3BhbicsIGNsczogWyduZW8tY29udGVudCddLCBodG1sOiByZWNvcmRbbWUuZGlzcGxheUZpZWxkXX1dO1xuXG4gICAgICAgIGlmIChpY29uQ2xzICYmIGljb25DbHMgIT09ICcnKSB7XG4gICAgICAgICAgICB2ZG9tQ24udW5zaGlmdCh7dGFnOiAnaScsIGNsczogWyduZW8tbWVudS1pY29uJywgJ25lby1pY29uJywgaWNvbkNsc10sIGlkOiBtZS5nZXRJY29uSWQoaWQpfSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAobWUuaGFzQ2hpbGRyZW4ocmVjb3JkKSkge1xuICAgICAgICAgICAgdmRvbUNuLnB1c2goe3RhZzogJ2knLCBjbHM6IFsnbmVvLWFycm93LWljb24nLCAnbmVvLWljb24nLCAnZmFzIGZhLWNoZXZyb24tcmlnaHQnXSwgaWQ6IG1lLmdldEFycm93SWNvbklkKGlkKX0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHZkb21DblxuICAgIH1cblxuICAgIC8qKlxuICAgICAqXG4gICAgICovXG4gICAgZGVzdHJveSguLi5hcmdzKSB7XG4gICAgICAgIGxldCBtZSAgICAgICAgICAgID0gdGhpcyxcbiAgICAgICAgICAgIGFjdGl2ZVN1Yk1lbnUgPSBtZS5hY3RpdmVTdWJNZW51LFxuICAgICAgICAgICAgc3ViTWVudU1hcCAgICA9IG1lLnN1Yk1lbnVNYXA7XG5cbiAgICAgICAgbWUuc3RvcmUuZGVzdHJveSgpO1xuXG4gICAgICAgIGFjdGl2ZVN1Yk1lbnU/LnVubW91bnQoKTtcblxuICAgICAgICBPYmplY3QuZW50cmllcyhzdWJNZW51TWFwKS5mb3JFYWNoKChba2V5LCB2YWx1ZV0pID0+IHtcbiAgICAgICAgICAgIHZhbHVlLmRlc3Ryb3koKTtcbiAgICAgICAgICAgIHN1Yk1lbnVNYXBba2V5XSA9IG51bGxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgc3VwZXIuZGVzdHJveSguLi5hcmdzKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfFN0cmluZ30gcmVjb3JkSWRcbiAgICAgKiBAcmV0dXJucyB7U3RyaW5nfVxuICAgICAqL1xuICAgIGdldEFycm93SWNvbklkKHJlY29yZElkKSB7XG4gICAgICAgIHJldHVybiBgJHt0aGlzLmlkfV9fYXJyb3dfaWNvbl9fJHtyZWNvcmRJZH1gXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtOdW1iZXJ8U3RyaW5nfSByZWNvcmRJZFxuICAgICAqIEByZXR1cm5zIHtTdHJpbmd9XG4gICAgICovXG4gICAgZ2V0SWNvbklkKHJlY29yZElkKSB7XG4gICAgICAgIHJldHVybiBgJHt0aGlzLmlkfV9faWNvbl9fJHtyZWNvcmRJZH1gXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogcmVjb3JkSWRzIGNhbiBiZSBOdW1iZXJzLCBzbyB3ZSBkbyBuZWVkIGEgcHJlZml4XG4gICAgICogQHBhcmFtIHtOdW1iZXJ8U3RyaW5nfSByZWNvcmRJZFxuICAgICAqIEByZXR1cm5zIHtTdHJpbmd9XG4gICAgICovXG4gICAgZ2V0TWVudU1hcElkKHJlY29yZElkKSB7XG4gICAgICAgIHJldHVybiBgbWVudV9fJHtyZWNvcmRJZH1gXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2tzIGlmIGEgcmVjb3JkIGhhcyBpdGVtc1xuICAgICAqIEBwYXJhbSB7T2JqZWN0fSByZWNvcmRcbiAgICAgKiBAcmV0dXJucyB7Qm9vbGVhbn1cbiAgICAgKi9cbiAgICBoYXNDaGlsZHJlbihyZWNvcmQpIHtcbiAgICAgICAgcmV0dXJuIEFycmF5LmlzQXJyYXkocmVjb3JkLml0ZW1zKSAmJiByZWNvcmQuaXRlbXMubGVuZ3RoID4gMFxuICAgIH1cblxuICAgIC8qKlxuICAgICAqXG4gICAgICovXG4gICAgaGlkZVN1Yk1lbnUoKSB7XG4gICAgICAgIGxldCBtZSAgICAgICAgICAgID0gdGhpcyxcbiAgICAgICAgICAgIGFjdGl2ZVN1Yk1lbnUgPSBtZS5hY3RpdmVTdWJNZW51O1xuXG4gICAgICAgIGlmIChhY3RpdmVTdWJNZW51KSB7XG4gICAgICAgICAgICBhY3RpdmVTdWJNZW51LnVubW91bnQoKTtcbiAgICAgICAgICAgIG1lLmFjdGl2ZVN1Yk1lbnUgPSBudWxsXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gZGF0YVxuICAgICAqIEBwYXJhbSB7T2JqZWN0W119IGRhdGEucGF0aFxuICAgICAqL1xuICAgIG9uRm9jdXNFbnRlcihkYXRhKSB7XG4gICAgICAgIHRoaXMubWVudUZvY3VzID0gdHJ1ZVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhXG4gICAgICogQHBhcmFtIHtPYmplY3RbXX0gZGF0YS5vbGRQYXRoXG4gICAgICovXG4gICAgb25Gb2N1c0xlYXZlKGRhdGEpIHtcbiAgICAgICAgbGV0IGluc2lkZVBhcmVudCA9IGZhbHNlLFxuICAgICAgICAgICAgcGFyZW50SWQgICAgID0gdGhpcy5wYXJlbnRDb21wb25lbnQ/LmlkLFxuICAgICAgICAgICAgaXRlbTtcblxuICAgICAgICBpZiAocGFyZW50SWQpIHtcbiAgICAgICAgICAgIGZvciAoaXRlbSBvZiBkYXRhLm9sZFBhdGgpIHtcbiAgICAgICAgICAgICAgICBpZiAoaXRlbS5pZCA9PT0gcGFyZW50SWQpIHtcbiAgICAgICAgICAgICAgICAgICAgaW5zaWRlUGFyZW50ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFpbnNpZGVQYXJlbnQpIHtcbiAgICAgICAgICAgIHRoaXMubWVudUZvY3VzID0gZmFsc2VcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBub2RlXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGRhdGFcbiAgICAgKi9cbiAgICBvbkl0ZW1DbGljayhub2RlLCBkYXRhKSB7XG4gICAgICAgIHN1cGVyLm9uSXRlbUNsaWNrKG5vZGUsIGRhdGEpO1xuXG4gICAgICAgIGxldCBtZSAgICAgPSB0aGlzLFxuICAgICAgICAgICAgcmVjb3JkID0gZGF0YS5yZWNvcmQ7XG5cbiAgICAgICAgcmVjb3JkLmhhbmRsZXI/LmNhbGwobWUsIHJlY29yZCk7XG5cbiAgICAgICAgaWYgKG1lLmhpZGVPbkxlYWZJdGVtQ2xpY2sgJiYgIXJlY29yZC5pdGVtcykge1xuICAgICAgICAgICAgbWUudW5tb3VudCgpXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gbm9kZUlkXG4gICAgICovXG4gICAgb25LZXlEb3duRW50ZXIobm9kZUlkKSB7XG4gICAgICAgIGlmIChub2RlSWQpIHtcbiAgICAgICAgICAgIGxldCBtZSAgICAgICA9IHRoaXMsXG4gICAgICAgICAgICAgICAgcmVjb3JkSWQgPSBtZS5nZXRJdGVtUmVjb3JkSWQobm9kZUlkKSxcbiAgICAgICAgICAgICAgICByZWNvcmQgICA9IG1lLnN0b3JlLmdldChyZWNvcmRJZCksXG4gICAgICAgICAgICAgICAgc3VibWVudTtcblxuICAgICAgICAgICAgcmVjb3JkLmhhbmRsZXI/LmNhbGwobWUsIHJlY29yZCk7XG5cbiAgICAgICAgICAgIGlmIChtZS5oaWRlT25MZWFmSXRlbUNsaWNrICYmICFyZWNvcmQuaXRlbXMpIHtcbiAgICAgICAgICAgICAgICBtZS51bm1vdW50KClcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHJlY29yZC5pdGVtcykge1xuICAgICAgICAgICAgICAgIHN1Ym1lbnUgPSBtZS5zdWJNZW51TWFwW21lLmdldE1lbnVNYXBJZChyZWNvcmRJZCldO1xuXG4gICAgICAgICAgICAgICAgaWYgKHN1Ym1lbnUpIHtcbiAgICAgICAgICAgICAgICAgICAgbWUudG9nZ2xlU3ViTWVudShub2RlSWQsIHJlY29yZClcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gZGF0YVxuICAgICAqL1xuICAgIG9uS2V5RG93bkVzY2FwZShkYXRhKSB7XG4gICAgICAgIHRoaXMuZmxvYXRpbmcgJiYgdGhpcy51bm1vdW50KClcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge1N0cmluZ1tdfSBpdGVtc1xuICAgICAqL1xuICAgIG9uU2VsZWN0KGl0ZW1zKSB7XG4gICAgICAgIGxldCBtZSAgICAgICA9IHRoaXMsXG4gICAgICAgICAgICBub2RlSWQgICA9IGl0ZW1zWzBdLFxuICAgICAgICAgICAgcmVjb3JkSWQgPSBtZS5nZXRJdGVtUmVjb3JkSWQobm9kZUlkKSxcbiAgICAgICAgICAgIHJlY29yZCAgID0gbWUuc3RvcmUuZ2V0KHJlY29yZElkKTtcblxuICAgICAgICBpZiAobWUuYWN0aXZlU3ViTWVudSAhPT0gbWUuc3ViTWVudU1hcD8uW21lLmdldE1lbnVNYXBJZChyZWNvcmRJZCldKSB7XG4gICAgICAgICAgICBtZS5oaWRlU3ViTWVudSgpO1xuICAgICAgICAgICAgbWUuaGFzQ2hpbGRyZW4ocmVjb3JkKSAmJiBtZS5zaG93U3ViTWVudShub2RlSWQsIHJlY29yZClcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBub2RlSWRcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gcmVjb3JkXG4gICAgICovXG4gICAgc2hvd1N1Yk1lbnUobm9kZUlkLCByZWNvcmQpIHtcbiAgICAgICAgbGV0IG1lICAgICAgICAgICA9IHRoaXMsXG4gICAgICAgICAgICBzdG9yZSAgICAgICAgPSBtZS5zdG9yZSxcbiAgICAgICAgICAgIHJlY29yZElkICAgICA9IHJlY29yZFtzdG9yZS5rZXlQcm9wZXJ0eV0sXG4gICAgICAgICAgICBzdWJNZW51TWFwICAgPSBtZS5zdWJNZW51TWFwIHx8IHt9LFxuICAgICAgICAgICAgc3ViTWVudU1hcElkID0gbWUuZ2V0TWVudU1hcElkKHJlY29yZElkKSxcbiAgICAgICAgICAgIHN1Yk1lbnUgICAgICA9IHN1Yk1lbnVNYXBbc3ViTWVudU1hcElkXSxcbiAgICAgICAgICAgIG1lbnVTdHlsZSwgc3R5bGU7XG5cbiAgICAgICAgbWUuZ2V0RG9tUmVjdChub2RlSWQpLnRoZW4ocmVjdCA9PiB7XG4gICAgICAgICAgICBzdHlsZSA9IHtcbiAgICAgICAgICAgICAgICBsZWZ0OiBgJHtyZWN0LnJpZ2h0ICsgbWUuc3ViTWVudUdhcH1weGAsXG4gICAgICAgICAgICAgICAgdG9wIDogYCR7cmVjdC50b3AgLSAxfXB4YCAvLyBtaW51cyB0aGUgYm9yZGVyXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZiAoc3ViTWVudSkge1xuICAgICAgICAgICAgICAgIG1lbnVTdHlsZSA9IHN1Yk1lbnUuc3R5bGU7XG5cbiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKG1lbnVTdHlsZSwgc3R5bGUpO1xuXG4gICAgICAgICAgICAgICAgc3ViTWVudS5zZXRTaWxlbnQoe3N0eWxlOiBtZW51U3R5bGV9KVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBzdWJNZW51TWFwW3N1Yk1lbnVNYXBJZF0gPSBzdWJNZW51ID0gTmVvLmNyZWF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIG1vZHVsZSAgICAgICAgIDogTGlzdCxcbiAgICAgICAgICAgICAgICAgICAgYXBwTmFtZSAgICAgICAgOiBtZS5hcHBOYW1lLFxuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5RmllbGQgICA6IG1lLmRpc3BsYXlGaWVsZCxcbiAgICAgICAgICAgICAgICAgICAgZmxvYXRpbmcgICAgICAgOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBpdGVtcyAgICAgICAgICA6IHJlY29yZC5pdGVtcyxcbiAgICAgICAgICAgICAgICAgICAgaXNSb290ICAgICAgICAgOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgcGFyZW50Q29tcG9uZW50OiBtZS5wYXJlbnRDb21wb25lbnQsXG4gICAgICAgICAgICAgICAgICAgIHBhcmVudElkICAgICAgIDogTmVvLmFwcHNbbWUuYXBwTmFtZV0ubWFpblZpZXcuaWQsXG4gICAgICAgICAgICAgICAgICAgIHBhcmVudEluZGV4ICAgIDogc3RvcmUuaW5kZXhPZihyZWNvcmQpLFxuICAgICAgICAgICAgICAgICAgICBwYXJlbnRNZW51ICAgICA6IG1lLFxuICAgICAgICAgICAgICAgICAgICBzdHlsZSxcbiAgICAgICAgICAgICAgICAgICAgekluZGV4ICAgICAgICAgOiBtZS56SW5kZXggKyAxXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbWUuYWN0aXZlU3ViTWVudSA9IHN1Yk1lbnU7XG4gICAgICAgICAgICBtZS5zdWJNZW51TWFwICAgID0gc3ViTWVudU1hcDtcblxuICAgICAgICAgICAgc3ViTWVudS5yZW5kZXIodHJ1ZSlcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IG5vZGVJZFxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSByZWNvcmRcbiAgICAgKi9cbiAgICB0b2dnbGVTdWJNZW51KG5vZGVJZCwgcmVjb3JkKSB7XG4gICAgICAgIGxldCBtZSAgICAgICA9IHRoaXMsXG4gICAgICAgICAgICByZWNvcmRJZCA9IHJlY29yZFttZS5nZXRLZXlQcm9wZXJ0eSgpXSxcbiAgICAgICAgICAgIHN1Ym1lbnUgID0gbWUuc3ViTWVudU1hcFttZS5nZXRNZW51TWFwSWQocmVjb3JkSWQpXTtcblxuICAgICAgICBpZiAoIXN1Ym1lbnU/Lm1vdW50ZWQpIHtcbiAgICAgICAgICAgIG1lLnNob3dTdWJNZW51KG5vZGVJZCwgcmVjb3JkKVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbWUuaGlkZVN1Yk1lbnUoKVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKi9cbiAgICB1bm1vdW50KCkge1xuICAgICAgICB0aGlzLnNlbGVjdGlvbk1vZGVsLmRlc2VsZWN0QWxsKHRydWUpOyAvLyBzaWxlbnQgdXBkYXRlXG4gICAgICAgIHRoaXMuaGlkZVN1Yk1lbnUoKTtcblxuICAgICAgICBzdXBlci51bm1vdW50KClcbiAgICB9XG59XG5cbk5lby5hcHBseUNsYXNzQ29uZmlnKExpc3QpO1xuXG5leHBvcnQgZGVmYXVsdCBMaXN0O1xuIiwiaW1wb3J0IEJhc2VNb2RlbCBmcm9tICcuLi8uLi9zcmMvZGF0YS9Nb2RlbC5tanMnO1xuXG4vKipcbiAqIEBjbGFzcyBOZW8ubWVudS5Nb2RlbFxuICogQGV4dGVuZHMgTmVvLmRhdGEuTW9kZWxcbiAqL1xuY2xhc3MgTW9kZWwgZXh0ZW5kcyBCYXNlTW9kZWwge1xuICAgIHN0YXRpYyBjb25maWcgPSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtTdHJpbmd9IGNsYXNzTmFtZT0nTmVvLm1lbnUuTW9kZWwnXG4gICAgICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgICAgICovXG4gICAgICAgIGNsYXNzTmFtZTogJ05lby5tZW51Lk1vZGVsJyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge1N0cmluZ30ga2V5UHJvcGVydHk9J2lkJ1xuICAgICAgICAgKi9cbiAgICAgICAga2V5UHJvcGVydHk6ICdpZCcsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtPYmplY3RbXX0gZmllbGRzXG4gICAgICAgICAqL1xuICAgICAgICBmaWVsZHM6IFt7XG4gICAgICAgICAgICBuYW1lOiAnaGFuZGxlcicsXG4gICAgICAgICAgICB0eXBlOiAnRnVuY3Rpb24nXG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIG5hbWU6ICdpY29uQ2xzJyxcbiAgICAgICAgICAgIHR5cGU6ICdTdHJpbmcnXG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIG5hbWU6ICdpZCcsXG4gICAgICAgICAgICB0eXBlOiAnSW50ZWdlcidcbiAgICAgICAgfSwge1xuICAgICAgICAgICAgbmFtZTogJ2l0ZW1zJywgLy8gb3B0aW9uYWxcbiAgICAgICAgICAgIHR5cGU6ICdBcnJheSdcbiAgICAgICAgfSwge1xuICAgICAgICAgICAgbmFtZTogJ3RleHQnLFxuICAgICAgICAgICAgdHlwZTogJ1N0cmluZydcbiAgICAgICAgfV1cbiAgICB9XG59XG5cbk5lby5hcHBseUNsYXNzQ29uZmlnKE1vZGVsKTtcblxuZXhwb3J0IGRlZmF1bHQgTW9kZWw7XG4iLCJpbXBvcnQgTW9kZWwgICAgIGZyb20gJy4vTW9kZWwubWpzJztcbmltcG9ydCBCYXNlU3RvcmUgZnJvbSAnLi4vLi4vc3JjL2RhdGEvU3RvcmUubWpzJztcblxuLyoqXG4gKiBAY2xhc3MgTmVvLm1lbnUuU3RvcmVcbiAqIEBleHRlbmRzIE5lby5kYXRhLlN0b3JlXG4gKi9cbmNsYXNzIFN0b3JlIGV4dGVuZHMgQmFzZVN0b3JlIHtcbiAgICBzdGF0aWMgY29uZmlnID0ge1xuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7U3RyaW5nfSBjbGFzc05hbWU9J05lby5tZW51LlN0b3JlJ1xuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICBjbGFzc05hbWU6ICdOZW8ubWVudS5TdG9yZScsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtOZW8ubWVudS5Nb2RlbH0gbW9kZWw9TW9kZWxcbiAgICAgICAgICovXG4gICAgICAgIG1vZGVsOiBNb2RlbFxuICAgIH1cbn1cblxuTmVvLmFwcGx5Q2xhc3NDb25maWcoU3RvcmUpO1xuXG5leHBvcnQgZGVmYXVsdCBTdG9yZTtcbiIsImltcG9ydCBCYXNlTGlzdE1vZGVsIGZyb20gJy4uL0xpc3RNb2RlbC5tanMnO1xuXG4vKipcbiAqIEBjbGFzcyBOZW8uc2VsZWN0aW9uLm1lbnUuTGlzdE1vZGVsXG4gKiBAZXh0ZW5kcyBOZW8uc2VsZWN0aW9uLkxpc3RNb2RlbFxuICovXG5jbGFzcyBMaXN0TW9kZWwgZXh0ZW5kcyBCYXNlTGlzdE1vZGVsIHtcbiAgICBzdGF0aWMgY29uZmlnID0ge1xuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7U3RyaW5nfSBjbGFzc05hbWU9J05lby5zZWxlY3Rpb24ubWVudS5MaXN0TW9kZWwnXG4gICAgICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgICAgICovXG4gICAgICAgIGNsYXNzTmFtZTogJ05lby5zZWxlY3Rpb24ubWVudS5MaXN0TW9kZWwnLFxuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7U3RyaW5nfSBudHlwZT0nc2VsZWN0aW9uLW1lbnUtbGlzdG1vZGVsJ1xuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICBudHlwZTogJ3NlbGVjdGlvbi1tZW51LWxpc3Rtb2RlbCdcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gZGF0YVxuICAgICAqL1xuICAgIG9uS2V5RG93bkVzY2FwZShkYXRhKSB7XG4gICAgICAgIHRoaXMudmlldy5vbktleURvd25Fc2NhcGUoZGF0YSlcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gZGF0YVxuICAgICAqL1xuICAgIG9uS2V5RG93bkxlZnQoZGF0YSkge1xuICAgICAgICBsZXQgdmlldyAgICAgICA9IHRoaXMudmlldyxcbiAgICAgICAgICAgIHBhcmVudE1lbnUgPSB2aWV3LnBhcmVudE1lbnU7XG5cbiAgICAgICAgaWYgKHBhcmVudE1lbnUpIHtcbiAgICAgICAgICAgIHZpZXcuaGlkZVN1Yk1lbnUoKTtcbiAgICAgICAgICAgIHZpZXcuc2VsZWN0aW9uTW9kZWwuZGVzZWxlY3RBbGwoKTtcbiAgICAgICAgICAgIHBhcmVudE1lbnUuc2VsZWN0aW9uTW9kZWwuc2VsZWN0QXQodmlldy5wYXJlbnRJbmRleClcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhXG4gICAgICovXG4gICAgb25LZXlEb3duUmlnaHQoZGF0YSkge1xuICAgICAgICBsZXQgYWN0aXZlU3ViTWVudSA9IHRoaXMudmlldy5hY3RpdmVTdWJNZW51O1xuXG4gICAgICAgIGlmIChhY3RpdmVTdWJNZW51KSB7XG4gICAgICAgICAgICBhY3RpdmVTdWJNZW51LnNlbGVjdGlvbk1vZGVsLnNlbGVjdEF0KDApXG4gICAgICAgIH1cbiAgICB9XG59XG5cbk5lby5hcHBseUNsYXNzQ29uZmlnKExpc3RNb2RlbCk7XG5cbmV4cG9ydCBkZWZhdWx0IExpc3RNb2RlbDtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==