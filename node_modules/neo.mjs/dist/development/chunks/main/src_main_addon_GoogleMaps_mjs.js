"use strict";
(self["webpackChunkneo_mjs"] = self["webpackChunkneo_mjs"] || []).push([["src_main_addon_GoogleMaps_mjs"],{

/***/ "./src/main/addon/Base.mjs":
/*!*********************************!*\
  !*** ./src/main/addon/Base.mjs ***!
  \*********************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _core_Base_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../core/Base.mjs */ "./src/core/Base.mjs");


/**
 * Base class for main thread addons
 * @class Neo.main.addon.Base
 * @extends Neo.core.Base
 */
class Base extends _core_Base_mjs__WEBPACK_IMPORTED_MODULE_0__["default"] {
    static config = {
        /**
         * @member {String} className='Neo.main.addon.Base'
         * @protected
         */
        className: 'Neo.main.addon.Base',
        /**
         * An identifier for core.Base to get handled like singletons for remote method access
         * @member {Boolean} isMainThreadAddon=true
         * @protected
         */
        isMainThreadAddon: true
    }
}

Neo.setupClass(Base);

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Base);


/***/ }),

/***/ "./src/main/addon/GoogleMaps.mjs":
/*!***************************************!*\
  !*** ./src/main/addon/GoogleMaps.mjs ***!
  \***************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _Base_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./Base.mjs */ "./src/main/addon/Base.mjs");
/* harmony import */ var _DomAccess_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../DomAccess.mjs */ "./src/main/DomAccess.mjs");
/* harmony import */ var _DomEvents_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../DomEvents.mjs */ "./src/main/DomEvents.mjs");
/* harmony import */ var _core_Observable_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../core/Observable.mjs */ "./src/core/Observable.mjs");





/**
 * @class Neo.main.addon.GoogleMaps
 * @extends Neo.main.addon.Base
 */
class GoogleMaps extends _Base_mjs__WEBPACK_IMPORTED_MODULE_0__["default"] {
    static config = {
        /**
         * @member {String} className='Neo.main.addon.GoogleMaps'
         * @protected
         */
        className: 'Neo.main.addon.GoogleMaps',
        /**
         * @member {Neo.core.Base[]} mixins=[Observable]
         */
        mixins: [_core_Observable_mjs__WEBPACK_IMPORTED_MODULE_3__["default"]],
        /**
         * @member {Object} remote
         * @protected
         */
        remote: {
            app: [
                'addMarker',
                'create',
                'destroyMarkers',
                'geocode',
                'hideMarker',
                'panTo',
                'removeMap',
                'removeMarker',
                'setCenter',
                'setZoom',
                'showMarker'
            ]
        }
    }

    /**
     * @member {google.maps.Geocoder|null} maps=null
     */
    geoCoder = null
    /**
     * @member {Object} maps={}
     */
    maps = {}
    /**
     * @member {Object} markers={}
     */
    markers = {}

    /**
     * @param {Object} config
     */
    construct(config) {
        super.construct(config);
        this.loadApi()
    }

    /**
     * @param {Object} data
     * @param {Object} [data.anchorPoint] x & y
     * @param {String} [data.icon]
     * @param {String} data.id
     * @param {String} [data.label]
     * @param {String} data.mapId
     * @param {Object} data.position
     * @param {String} [data.title]
     */
    addMarker(data) {
        let me      = this,
            {mapId} = data,
            listenerId, marker;

        if (!me.maps[mapId]) {
            listenerId = me.on('mapCreated', id => {
                if (mapId === id) {
                    me.un(listenerId);
                    me.addMarker(data)
                }
            })
        } else {
            Neo.ns(`${mapId}`, true, me.markers);

            me.markers[mapId][data.id] = marker = new google.maps.Marker({
                icon    : data.icon,
                label   : data.label,
                map     : me.maps[mapId],
                neoId   : data.id, // custom property
                neoMapId: mapId,   // custom property
                position: data.position,
                title   : data.title,
            });

            marker.addListener('click', me.onMarkerClick.bind(me, marker))
        }
    }

    /**
     * @param {Object} data
     * @param {Object} data.center
     * @param {Boolean} data.fullscreenControl
     * @param {String} data.id
     * @param {Object} data.mapOptions // Pass any options which are not explicitly defined here
     * @param {Number} data.maxZoom
     * @param {Number} data.minZoom
     * @param {Number} data.zoom
     * @param {Boolean} data.zoomControl
     */
    create(data) {
        let me   = this,
            {id} = data,
            map;

        me.maps[id] = map = new google.maps.Map(_DomAccess_mjs__WEBPACK_IMPORTED_MODULE_1__["default"].getElement(id), {
            center           : data.center,
            fullscreenControl: data.fullscreenControl,
            maxZoom          : data.maxZoom,
            minZoom          : data.minZoom,
            zoom             : data.zoom,
            zoomControl      : data.zoomControl,
            ...data.mapOptions
        });

        map.addListener('zoom_changed', me.onMapZoomChange.bind(me, map, id));

        me.fire('mapCreated', id)
    }

    /**
     * Destroys all markers for the specified map ID.
     * @param {Object} data
     * @param {String} data.mapId
     */
    destroyMarkers(data) {
        let me      = this,
            markers = me.markers[data.mapId] || {};

        Object.values(markers).forEach(marker => marker.setMap(null));
        delete me.markers[data.mapId]
    }

    /**
     * Use either address, location or placeId
     * @param {Object} data
     * @param {String} data.address
     * @param {Object} data.location
     * @param {String} data.placeId
     * @returns {Object}
     */
    async geocode(data) {
        let me = this,
            response;

        if (!me.geoCoder) {
            me.geoCoder = new google.maps.Geocoder()
        }

        response = await me.geoCoder.geocode(data);

        return JSON.parse(JSON.stringify(response))
    }

    /**
     * @param {Object} data
     * @param {String} data.id
     * @param {String} data.mapId
     */
    hideMarker(data) {
        this.markers[data.mapId][data.id].setMap(null)
    }

    /**
     * @protected
     */
    loadApi() {
        let key = Neo.config.googleMapsApiKey,
            url = ' https://maps.googleapis.com/maps/api/js';

        _DomAccess_mjs__WEBPACK_IMPORTED_MODULE_1__["default"].loadScript(`${url}?key=${key}&v=weekly&callback=Neo.emptyFn`).then(() => {
            console.log('GoogleMaps API loaded')
        })
    }

    /**
     * @param {google.maps.Map} map
     * @param {String} mapId
     */
    onMapZoomChange(map, mapId) {
        _DomEvents_mjs__WEBPACK_IMPORTED_MODULE_2__["default"].sendMessageToApp({
            id   : mapId,
            path : [{cls: [], id: mapId}],
            type : 'googleMapZoomChange',
            value: map.zoom
        })
    }

    /**
     * @param {google.maps.Marker} marker
     * @param {Object} event
     * @param {Object} event.domEvent
     */
    onMarkerClick(marker, event) {
        let transformedEvent = _DomEvents_mjs__WEBPACK_IMPORTED_MODULE_2__["default"].getMouseEventData(event.domEvent);

        _DomEvents_mjs__WEBPACK_IMPORTED_MODULE_2__["default"].sendMessageToApp({
            id      : marker.neoId,
            path    : [{cls: [], id: marker.neoMapId}],
            type    : 'googleMarkerClick',
            domEvent: transformedEvent
        })
    }

    /**
     * @param data
     * @param {String} data.mapId
     * @param {Object} data.position
     */
    panTo(data) {
        this.maps[data.mapId].panTo(data.position)
    }

    /**
     * @param {Object} data
     * @param {String} data.mapId
     */
    removeMap(data) {
        delete this.maps[data.mapId];
        delete this.markers[data.mapId]
    }

    /**
     * @param {Object} data
     * @param {String} data.id
     * @param {String} data.mapId
     */
    removeMarker(data) {
        let markers = this.markers[data.mapId];

        markers[data.id].setMap(null);
        delete markers[data.id]
    }

    /**
     * @param {Object} data
     * @param {String} data.id
     * @param {Object} data.value
     */
    setCenter(data) {
        this.maps[data.id].setCenter(data.value)
    }

    /**
     * @param {Object} data
     * @param {String} data.id
     * @param {Number} data.value
     */
    setZoom(data) {
        this.maps[data.id].setZoom(data.value)
    }

    /**
     * @param {Object} data
     * @param {String} data.id
     * @param {String} data.mapId
     */
    showMarker(data) {
        this.markers[data.mapId][data.id].setMap(this.maps[data.mapId])
    }
}

Neo.setupClass(GoogleMaps);

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (GoogleMaps);


/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2h1bmtzL21haW4vc3JjX21haW5fYWRkb25fR29vZ2xlTWFwc19tanMuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBMkM7O0FBRTNDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUIsc0RBQVE7QUFDM0I7QUFDQTtBQUNBLG9CQUFvQixRQUFRO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsU0FBUztBQUM3QjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBLGlFQUFlLElBQUksRUFBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQ3pCZ0I7QUFDTTtBQUNBO0FBQ1M7O0FBRW5EO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCLGlEQUFJO0FBQzdCO0FBQ0E7QUFDQSxvQkFBb0IsUUFBUTtBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixpQkFBaUI7QUFDckM7QUFDQSxpQkFBaUIsNERBQVU7QUFDM0I7QUFDQSxvQkFBb0IsUUFBUTtBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxnQkFBZ0IsMkJBQTJCO0FBQzNDO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixRQUFRO0FBQ3hCO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixRQUFRO0FBQ3hCO0FBQ0E7O0FBRUE7QUFDQSxlQUFlLFFBQVE7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLGVBQWUsUUFBUTtBQUN2QixlQUFlLFFBQVE7QUFDdkIsZUFBZSxRQUFRO0FBQ3ZCLGVBQWUsUUFBUTtBQUN2QixlQUFlLFFBQVE7QUFDdkIsZUFBZSxRQUFRO0FBQ3ZCLGVBQWUsUUFBUTtBQUN2QixlQUFlLFFBQVE7QUFDdkI7QUFDQTtBQUNBO0FBQ0EsYUFBYSxPQUFPO0FBQ3BCOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixVQUFVO0FBQ1Ysc0JBQXNCLE1BQU07O0FBRTVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLGVBQWUsUUFBUTtBQUN2QixlQUFlLFFBQVE7QUFDdkIsZUFBZSxTQUFTO0FBQ3hCLGVBQWUsUUFBUTtBQUN2QixlQUFlLFFBQVE7QUFDdkIsZUFBZSxRQUFRO0FBQ3ZCLGVBQWUsUUFBUTtBQUN2QixlQUFlLFFBQVE7QUFDdkIsZUFBZSxTQUFTO0FBQ3hCO0FBQ0E7QUFDQTtBQUNBLGFBQWEsSUFBSTtBQUNqQjs7QUFFQSxnREFBZ0Qsc0RBQVM7QUFDekQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGVBQWUsUUFBUTtBQUN2QixlQUFlLFFBQVE7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxlQUFlLFFBQVE7QUFDdkIsZUFBZSxRQUFRO0FBQ3ZCLGVBQWUsUUFBUTtBQUN2QixlQUFlLFFBQVE7QUFDdkIsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsZUFBZSxRQUFRO0FBQ3ZCLGVBQWUsUUFBUTtBQUN2QixlQUFlLFFBQVE7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLFFBQVEsc0RBQVMsZUFBZSxJQUFJLE9BQU8sSUFBSTtBQUMvQztBQUNBLFNBQVM7QUFDVDs7QUFFQTtBQUNBLGVBQWUsaUJBQWlCO0FBQ2hDLGVBQWUsUUFBUTtBQUN2QjtBQUNBO0FBQ0EsUUFBUSxzREFBUztBQUNqQjtBQUNBLHFCQUFxQixtQkFBbUI7QUFDeEM7QUFDQTtBQUNBLFNBQVM7QUFDVDs7QUFFQTtBQUNBLGVBQWUsb0JBQW9CO0FBQ25DLGVBQWUsUUFBUTtBQUN2QixlQUFlLFFBQVE7QUFDdkI7QUFDQTtBQUNBLCtCQUErQixzREFBUzs7QUFFeEMsUUFBUSxzREFBUztBQUNqQjtBQUNBLHdCQUF3Qiw2QkFBNkI7QUFDckQ7QUFDQTtBQUNBLFNBQVM7QUFDVDs7QUFFQTtBQUNBO0FBQ0EsZUFBZSxRQUFRO0FBQ3ZCLGVBQWUsUUFBUTtBQUN2QjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLGVBQWUsUUFBUTtBQUN2QixlQUFlLFFBQVE7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLGVBQWUsUUFBUTtBQUN2QixlQUFlLFFBQVE7QUFDdkIsZUFBZSxRQUFRO0FBQ3ZCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxlQUFlLFFBQVE7QUFDdkIsZUFBZSxRQUFRO0FBQ3ZCLGVBQWUsUUFBUTtBQUN2QjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLGVBQWUsUUFBUTtBQUN2QixlQUFlLFFBQVE7QUFDdkIsZUFBZSxRQUFRO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsZUFBZSxRQUFRO0FBQ3ZCLGVBQWUsUUFBUTtBQUN2QixlQUFlLFFBQVE7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQSxpRUFBZSxVQUFVLEVBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9uZW8ubWpzLy4vc3JjL21haW4vYWRkb24vQmFzZS5tanMiLCJ3ZWJwYWNrOi8vbmVvLm1qcy8uL3NyYy9tYWluL2FkZG9uL0dvb2dsZU1hcHMubWpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBDb3JlQmFzZSBmcm9tICcuLi8uLi9jb3JlL0Jhc2UubWpzJztcblxuLyoqXG4gKiBCYXNlIGNsYXNzIGZvciBtYWluIHRocmVhZCBhZGRvbnNcbiAqIEBjbGFzcyBOZW8ubWFpbi5hZGRvbi5CYXNlXG4gKiBAZXh0ZW5kcyBOZW8uY29yZS5CYXNlXG4gKi9cbmNsYXNzIEJhc2UgZXh0ZW5kcyBDb3JlQmFzZSB7XG4gICAgc3RhdGljIGNvbmZpZyA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBtZW1iZXIge1N0cmluZ30gY2xhc3NOYW1lPSdOZW8ubWFpbi5hZGRvbi5CYXNlJ1xuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICBjbGFzc05hbWU6ICdOZW8ubWFpbi5hZGRvbi5CYXNlJyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEFuIGlkZW50aWZpZXIgZm9yIGNvcmUuQmFzZSB0byBnZXQgaGFuZGxlZCBsaWtlIHNpbmdsZXRvbnMgZm9yIHJlbW90ZSBtZXRob2QgYWNjZXNzXG4gICAgICAgICAqIEBtZW1iZXIge0Jvb2xlYW59IGlzTWFpblRocmVhZEFkZG9uPXRydWVcbiAgICAgICAgICogQHByb3RlY3RlZFxuICAgICAgICAgKi9cbiAgICAgICAgaXNNYWluVGhyZWFkQWRkb246IHRydWVcbiAgICB9XG59XG5cbk5lby5zZXR1cENsYXNzKEJhc2UpO1xuXG5leHBvcnQgZGVmYXVsdCBCYXNlO1xuIiwiaW1wb3J0IEJhc2UgICAgICAgZnJvbSAnLi9CYXNlLm1qcyc7XG5pbXBvcnQgRG9tQWNjZXNzICBmcm9tICcuLi9Eb21BY2Nlc3MubWpzJztcbmltcG9ydCBEb21FdmVudHMgIGZyb20gJy4uL0RvbUV2ZW50cy5tanMnO1xuaW1wb3J0IE9ic2VydmFibGUgZnJvbSAnLi4vLi4vY29yZS9PYnNlcnZhYmxlLm1qcyc7XG5cbi8qKlxuICogQGNsYXNzIE5lby5tYWluLmFkZG9uLkdvb2dsZU1hcHNcbiAqIEBleHRlbmRzIE5lby5tYWluLmFkZG9uLkJhc2VcbiAqL1xuY2xhc3MgR29vZ2xlTWFwcyBleHRlbmRzIEJhc2Uge1xuICAgIHN0YXRpYyBjb25maWcgPSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtTdHJpbmd9IGNsYXNzTmFtZT0nTmVvLm1haW4uYWRkb24uR29vZ2xlTWFwcydcbiAgICAgICAgICogQHByb3RlY3RlZFxuICAgICAgICAgKi9cbiAgICAgICAgY2xhc3NOYW1lOiAnTmVvLm1haW4uYWRkb24uR29vZ2xlTWFwcycsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAbWVtYmVyIHtOZW8uY29yZS5CYXNlW119IG1peGlucz1bT2JzZXJ2YWJsZV1cbiAgICAgICAgICovXG4gICAgICAgIG1peGluczogW09ic2VydmFibGVdLFxuICAgICAgICAvKipcbiAgICAgICAgICogQG1lbWJlciB7T2JqZWN0fSByZW1vdGVcbiAgICAgICAgICogQHByb3RlY3RlZFxuICAgICAgICAgKi9cbiAgICAgICAgcmVtb3RlOiB7XG4gICAgICAgICAgICBhcHA6IFtcbiAgICAgICAgICAgICAgICAnYWRkTWFya2VyJyxcbiAgICAgICAgICAgICAgICAnY3JlYXRlJyxcbiAgICAgICAgICAgICAgICAnZGVzdHJveU1hcmtlcnMnLFxuICAgICAgICAgICAgICAgICdnZW9jb2RlJyxcbiAgICAgICAgICAgICAgICAnaGlkZU1hcmtlcicsXG4gICAgICAgICAgICAgICAgJ3BhblRvJyxcbiAgICAgICAgICAgICAgICAncmVtb3ZlTWFwJyxcbiAgICAgICAgICAgICAgICAncmVtb3ZlTWFya2VyJyxcbiAgICAgICAgICAgICAgICAnc2V0Q2VudGVyJyxcbiAgICAgICAgICAgICAgICAnc2V0Wm9vbScsXG4gICAgICAgICAgICAgICAgJ3Nob3dNYXJrZXInXG4gICAgICAgICAgICBdXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAbWVtYmVyIHtnb29nbGUubWFwcy5HZW9jb2RlcnxudWxsfSBtYXBzPW51bGxcbiAgICAgKi9cbiAgICBnZW9Db2RlciA9IG51bGxcbiAgICAvKipcbiAgICAgKiBAbWVtYmVyIHtPYmplY3R9IG1hcHM9e31cbiAgICAgKi9cbiAgICBtYXBzID0ge31cbiAgICAvKipcbiAgICAgKiBAbWVtYmVyIHtPYmplY3R9IG1hcmtlcnM9e31cbiAgICAgKi9cbiAgICBtYXJrZXJzID0ge31cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjb25maWdcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3QoY29uZmlnKSB7XG4gICAgICAgIHN1cGVyLmNvbnN0cnVjdChjb25maWcpO1xuICAgICAgICB0aGlzLmxvYWRBcGkoKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhXG4gICAgICogQHBhcmFtIHtPYmplY3R9IFtkYXRhLmFuY2hvclBvaW50XSB4ICYgeVxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbZGF0YS5pY29uXVxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBkYXRhLmlkXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFtkYXRhLmxhYmVsXVxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBkYXRhLm1hcElkXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGRhdGEucG9zaXRpb25cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW2RhdGEudGl0bGVdXG4gICAgICovXG4gICAgYWRkTWFya2VyKGRhdGEpIHtcbiAgICAgICAgbGV0IG1lICAgICAgPSB0aGlzLFxuICAgICAgICAgICAge21hcElkfSA9IGRhdGEsXG4gICAgICAgICAgICBsaXN0ZW5lcklkLCBtYXJrZXI7XG5cbiAgICAgICAgaWYgKCFtZS5tYXBzW21hcElkXSkge1xuICAgICAgICAgICAgbGlzdGVuZXJJZCA9IG1lLm9uKCdtYXBDcmVhdGVkJywgaWQgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChtYXBJZCA9PT0gaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgbWUudW4obGlzdGVuZXJJZCk7XG4gICAgICAgICAgICAgICAgICAgIG1lLmFkZE1hcmtlcihkYXRhKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBOZW8ubnMoYCR7bWFwSWR9YCwgdHJ1ZSwgbWUubWFya2Vycyk7XG5cbiAgICAgICAgICAgIG1lLm1hcmtlcnNbbWFwSWRdW2RhdGEuaWRdID0gbWFya2VyID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XG4gICAgICAgICAgICAgICAgaWNvbiAgICA6IGRhdGEuaWNvbixcbiAgICAgICAgICAgICAgICBsYWJlbCAgIDogZGF0YS5sYWJlbCxcbiAgICAgICAgICAgICAgICBtYXAgICAgIDogbWUubWFwc1ttYXBJZF0sXG4gICAgICAgICAgICAgICAgbmVvSWQgICA6IGRhdGEuaWQsIC8vIGN1c3RvbSBwcm9wZXJ0eVxuICAgICAgICAgICAgICAgIG5lb01hcElkOiBtYXBJZCwgICAvLyBjdXN0b20gcHJvcGVydHlcbiAgICAgICAgICAgICAgICBwb3NpdGlvbjogZGF0YS5wb3NpdGlvbixcbiAgICAgICAgICAgICAgICB0aXRsZSAgIDogZGF0YS50aXRsZSxcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBtYXJrZXIuYWRkTGlzdGVuZXIoJ2NsaWNrJywgbWUub25NYXJrZXJDbGljay5iaW5kKG1lLCBtYXJrZXIpKVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGRhdGFcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gZGF0YS5jZW50ZXJcbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IGRhdGEuZnVsbHNjcmVlbkNvbnRyb2xcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gZGF0YS5pZFxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhLm1hcE9wdGlvbnMgLy8gUGFzcyBhbnkgb3B0aW9ucyB3aGljaCBhcmUgbm90IGV4cGxpY2l0bHkgZGVmaW5lZCBoZXJlXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IGRhdGEubWF4Wm9vbVxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBkYXRhLm1pblpvb21cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gZGF0YS56b29tXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBkYXRhLnpvb21Db250cm9sXG4gICAgICovXG4gICAgY3JlYXRlKGRhdGEpIHtcbiAgICAgICAgbGV0IG1lICAgPSB0aGlzLFxuICAgICAgICAgICAge2lkfSA9IGRhdGEsXG4gICAgICAgICAgICBtYXA7XG5cbiAgICAgICAgbWUubWFwc1tpZF0gPSBtYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKERvbUFjY2Vzcy5nZXRFbGVtZW50KGlkKSwge1xuICAgICAgICAgICAgY2VudGVyICAgICAgICAgICA6IGRhdGEuY2VudGVyLFxuICAgICAgICAgICAgZnVsbHNjcmVlbkNvbnRyb2w6IGRhdGEuZnVsbHNjcmVlbkNvbnRyb2wsXG4gICAgICAgICAgICBtYXhab29tICAgICAgICAgIDogZGF0YS5tYXhab29tLFxuICAgICAgICAgICAgbWluWm9vbSAgICAgICAgICA6IGRhdGEubWluWm9vbSxcbiAgICAgICAgICAgIHpvb20gICAgICAgICAgICAgOiBkYXRhLnpvb20sXG4gICAgICAgICAgICB6b29tQ29udHJvbCAgICAgIDogZGF0YS56b29tQ29udHJvbCxcbiAgICAgICAgICAgIC4uLmRhdGEubWFwT3B0aW9uc1xuICAgICAgICB9KTtcblxuICAgICAgICBtYXAuYWRkTGlzdGVuZXIoJ3pvb21fY2hhbmdlZCcsIG1lLm9uTWFwWm9vbUNoYW5nZS5iaW5kKG1lLCBtYXAsIGlkKSk7XG5cbiAgICAgICAgbWUuZmlyZSgnbWFwQ3JlYXRlZCcsIGlkKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIERlc3Ryb3lzIGFsbCBtYXJrZXJzIGZvciB0aGUgc3BlY2lmaWVkIG1hcCBJRC5cbiAgICAgKiBAcGFyYW0ge09iamVjdH0gZGF0YVxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBkYXRhLm1hcElkXG4gICAgICovXG4gICAgZGVzdHJveU1hcmtlcnMoZGF0YSkge1xuICAgICAgICBsZXQgbWUgICAgICA9IHRoaXMsXG4gICAgICAgICAgICBtYXJrZXJzID0gbWUubWFya2Vyc1tkYXRhLm1hcElkXSB8fCB7fTtcblxuICAgICAgICBPYmplY3QudmFsdWVzKG1hcmtlcnMpLmZvckVhY2gobWFya2VyID0+IG1hcmtlci5zZXRNYXAobnVsbCkpO1xuICAgICAgICBkZWxldGUgbWUubWFya2Vyc1tkYXRhLm1hcElkXVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFVzZSBlaXRoZXIgYWRkcmVzcywgbG9jYXRpb24gb3IgcGxhY2VJZFxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IGRhdGEuYWRkcmVzc1xuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhLmxvY2F0aW9uXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IGRhdGEucGxhY2VJZFxuICAgICAqIEByZXR1cm5zIHtPYmplY3R9XG4gICAgICovXG4gICAgYXN5bmMgZ2VvY29kZShkYXRhKSB7XG4gICAgICAgIGxldCBtZSA9IHRoaXMsXG4gICAgICAgICAgICByZXNwb25zZTtcblxuICAgICAgICBpZiAoIW1lLmdlb0NvZGVyKSB7XG4gICAgICAgICAgICBtZS5nZW9Db2RlciA9IG5ldyBnb29nbGUubWFwcy5HZW9jb2RlcigpXG4gICAgICAgIH1cblxuICAgICAgICByZXNwb25zZSA9IGF3YWl0IG1lLmdlb0NvZGVyLmdlb2NvZGUoZGF0YSk7XG5cbiAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkocmVzcG9uc2UpKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IGRhdGEuaWRcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gZGF0YS5tYXBJZFxuICAgICAqL1xuICAgIGhpZGVNYXJrZXIoZGF0YSkge1xuICAgICAgICB0aGlzLm1hcmtlcnNbZGF0YS5tYXBJZF1bZGF0YS5pZF0uc2V0TWFwKG51bGwpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHByb3RlY3RlZFxuICAgICAqL1xuICAgIGxvYWRBcGkoKSB7XG4gICAgICAgIGxldCBrZXkgPSBOZW8uY29uZmlnLmdvb2dsZU1hcHNBcGlLZXksXG4gICAgICAgICAgICB1cmwgPSAnIGh0dHBzOi8vbWFwcy5nb29nbGVhcGlzLmNvbS9tYXBzL2FwaS9qcyc7XG5cbiAgICAgICAgRG9tQWNjZXNzLmxvYWRTY3JpcHQoYCR7dXJsfT9rZXk9JHtrZXl9JnY9d2Vla2x5JmNhbGxiYWNrPU5lby5lbXB0eUZuYCkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnR29vZ2xlTWFwcyBBUEkgbG9hZGVkJylcbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge2dvb2dsZS5tYXBzLk1hcH0gbWFwXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IG1hcElkXG4gICAgICovXG4gICAgb25NYXBab29tQ2hhbmdlKG1hcCwgbWFwSWQpIHtcbiAgICAgICAgRG9tRXZlbnRzLnNlbmRNZXNzYWdlVG9BcHAoe1xuICAgICAgICAgICAgaWQgICA6IG1hcElkLFxuICAgICAgICAgICAgcGF0aCA6IFt7Y2xzOiBbXSwgaWQ6IG1hcElkfV0sXG4gICAgICAgICAgICB0eXBlIDogJ2dvb2dsZU1hcFpvb21DaGFuZ2UnLFxuICAgICAgICAgICAgdmFsdWU6IG1hcC56b29tXG4gICAgICAgIH0pXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtnb29nbGUubWFwcy5NYXJrZXJ9IG1hcmtlclxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBldmVudFxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBldmVudC5kb21FdmVudFxuICAgICAqL1xuICAgIG9uTWFya2VyQ2xpY2sobWFya2VyLCBldmVudCkge1xuICAgICAgICBsZXQgdHJhbnNmb3JtZWRFdmVudCA9IERvbUV2ZW50cy5nZXRNb3VzZUV2ZW50RGF0YShldmVudC5kb21FdmVudCk7XG5cbiAgICAgICAgRG9tRXZlbnRzLnNlbmRNZXNzYWdlVG9BcHAoe1xuICAgICAgICAgICAgaWQgICAgICA6IG1hcmtlci5uZW9JZCxcbiAgICAgICAgICAgIHBhdGggICAgOiBbe2NsczogW10sIGlkOiBtYXJrZXIubmVvTWFwSWR9XSxcbiAgICAgICAgICAgIHR5cGUgICAgOiAnZ29vZ2xlTWFya2VyQ2xpY2snLFxuICAgICAgICAgICAgZG9tRXZlbnQ6IHRyYW5zZm9ybWVkRXZlbnRcbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0gZGF0YVxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBkYXRhLm1hcElkXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGRhdGEucG9zaXRpb25cbiAgICAgKi9cbiAgICBwYW5UbyhkYXRhKSB7XG4gICAgICAgIHRoaXMubWFwc1tkYXRhLm1hcElkXS5wYW5UbyhkYXRhLnBvc2l0aW9uKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IGRhdGEubWFwSWRcbiAgICAgKi9cbiAgICByZW1vdmVNYXAoZGF0YSkge1xuICAgICAgICBkZWxldGUgdGhpcy5tYXBzW2RhdGEubWFwSWRdO1xuICAgICAgICBkZWxldGUgdGhpcy5tYXJrZXJzW2RhdGEubWFwSWRdXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGRhdGFcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gZGF0YS5pZFxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBkYXRhLm1hcElkXG4gICAgICovXG4gICAgcmVtb3ZlTWFya2VyKGRhdGEpIHtcbiAgICAgICAgbGV0IG1hcmtlcnMgPSB0aGlzLm1hcmtlcnNbZGF0YS5tYXBJZF07XG5cbiAgICAgICAgbWFya2Vyc1tkYXRhLmlkXS5zZXRNYXAobnVsbCk7XG4gICAgICAgIGRlbGV0ZSBtYXJrZXJzW2RhdGEuaWRdXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGRhdGFcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gZGF0YS5pZFxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhLnZhbHVlXG4gICAgICovXG4gICAgc2V0Q2VudGVyKGRhdGEpIHtcbiAgICAgICAgdGhpcy5tYXBzW2RhdGEuaWRdLnNldENlbnRlcihkYXRhLnZhbHVlKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IGRhdGEuaWRcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gZGF0YS52YWx1ZVxuICAgICAqL1xuICAgIHNldFpvb20oZGF0YSkge1xuICAgICAgICB0aGlzLm1hcHNbZGF0YS5pZF0uc2V0Wm9vbShkYXRhLnZhbHVlKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IGRhdGEuaWRcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gZGF0YS5tYXBJZFxuICAgICAqL1xuICAgIHNob3dNYXJrZXIoZGF0YSkge1xuICAgICAgICB0aGlzLm1hcmtlcnNbZGF0YS5tYXBJZF1bZGF0YS5pZF0uc2V0TWFwKHRoaXMubWFwc1tkYXRhLm1hcElkXSlcbiAgICB9XG59XG5cbk5lby5zZXR1cENsYXNzKEdvb2dsZU1hcHMpO1xuXG5leHBvcnQgZGVmYXVsdCBHb29nbGVNYXBzO1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9